"use strict";(self.webpackChunkcelestianote=self.webpackChunkcelestianote||[]).push([[792],{866:(e,t,o)=>{var n=o(922),i=o(437),a=o(24),s=o(411),r=o(880),l=o(977),c=o(92);console.log("THREE.REVISION:",n.sPf);const d=document.getElementById("sceneCanvas"),p=new i.JeP({canvas:d,antialias:!0,preserveDrawingBuffer:!0,alpha:!0});p.setClearColor(0,0),p.autoClear=!1,p.setSize(window.innerWidth,window.innerHeight),p.outputColorSpace=n.er$,document.body.appendChild(p.domElement);const u=new s.a0;u.domElement.classList.add("css3d-renderer"),u.setSize(window.innerWidth,window.innerHeight),u.domElement.style.position="absolute",u.domElement.style.top=0,document.body.appendChild(u.domElement);const m=new n.Z58,y=new n.ubm(75,window.innerWidth/window.innerHeight,.1,100);y.position.set(0,1.6,5);const h=new n.Z58,g=new n.qUd(-window.innerWidth/2,window.innerWidth/2,window.innerHeight/2,-window.innerHeight/2,.1,100);g.position.z=10;const w=new n.$p8(16777215,1.5);m.add(w);const f=new n.Tap,v=f.load("./Model/markup_ARROW.png"),P=f.load("./Model/markup_WASD.png"),M=f.load("./Model/Mouse.png"),b=f.load("./Model/Mouse_Arrow.png"),x=new n.RoJ({map:v,transparent:!0,opacity:1}),q=new n.kxk(x);q.scale.set(160,120,1),q.position.set(-window.innerWidth/2+20,-window.innerHeight/2+20,1),h.add(q);const I=new n.RoJ({map:M,transparent:!0,opacity:1}),A=new n.kxk(I);A.scale.set(70,70,1),A.position.set(-window.innerWidth/2+130,-window.innerHeight/2+40,1),h.add(A);const S=new n.RoJ({map:b,transparent:!0,opacity:1}),z=new n.kxk(S);z.scale.set(50,50,1),z.position.set(-window.innerWidth/2+130,-window.innerHeight/2+40,1),h.add(z);let C=!1;function E(){q.position.set(g.left+90,g.bottom+70,1)}setInterval((()=>{x.map=C?P:v,x.needsUpdate=!0,C=!C}),1e3);let O,T=null,k=null;function L(e=!1){if(T)return;let t,o;k=e?"center":"left",e?(t=(g.left+g.right)/2,o=g.bottom+45):(t=g.left+230,o=g.bottom+45),A.position.set(t,o,1),z.position.set(t+50,o+20,1),A.material.rotation=0,z.material.rotation=-Math.PI/16,T=r.Ay.timeline({repeat:-1,yoyo:!0,ease:"circ.inOut",defaults:{duration:2}}),T.to(A.position,{x:t+70,y:o+40},0),T.to(A.material,{rotation:-Math.PI/16},0),T.to(z.position,{x:t,y:o+5},0),T.to(z.material,{rotation:3*Math.PI/5},0)}function B(){T&&(T.kill(),T=null,A.material.rotation=0,z.material.rotaation=-Math.PI/16,E())}L(),(new c.B).load("./Model/FloorModel/floor.glb",(function(e){O=e.scene,O.scale.set(.25,.25,.25),O.position.set(0,0,5),m.add(O),console.log("âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†")}),void 0,(function(e){console.error("âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",e)}));const W=[{position:new n.Pq0(2.8,0,6),rotation:new n.O9p(0,Math.PI/5,-Math.PI/5),scale:new n.Pq0(.125,.125,.125)},{position:new n.Pq0(-2.9,0,4),rotation:new n.O9p(-Math.PI/4,Math.PI/9,0),scale:new n.Pq0(.1,.1,.1)},{position:new n.Pq0(1.5,0,7),rotation:new n.O9p(0,Math.PI/3,-Math.PI/6),scale:new n.Pq0(.125,.125,.125)},{position:new n.Pq0(-2.5,0,6.5),rotation:new n.O9p(0,-Math.PI/2,Math.PI/5),scale:new n.Pq0(.11,.11,.11)},{position:new n.Pq0(.5,0,6),rotation:new n.O9p(-Math.PI/7,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.04,.04,.04)},{position:new n.Pq0(.23,0,4),rotation:new n.O9p(-Math.PI/3,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.05,.05,.05)},{position:new n.Pq0(2.2,0,1.7),rotation:new n.O9p(-Math.PI/7,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.08,.08,.08)},{position:new n.Pq0(-2.2,0,2.6),rotation:new n.O9p(-2*Math.PI/5,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.06,.06,.06)},{position:new n.Pq0(-2.5,0,7.1),rotation:new n.O9p(-Math.PI/8,-Math.PI/3,Math.PI/3),scale:new n.Pq0(.05,.05,.05)},{position:new n.Pq0(-1.2,0,6.1),rotation:new n.O9p(-Math.PI/7,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.05,.05,.05)},{position:new n.Pq0(2.2,0,7.5),rotation:new n.O9p(-Math.PI/6,-Math.PI/7,-Math.PI/5),scale:new n.Pq0(.05,.05,.05)},{position:new n.Pq0(1,0,8.5),rotation:new n.O9p(-Math.PI/7,-Math.PI/4,Math.PI/8),scale:new n.Pq0(.08,.08,.08)},{position:new n.Pq0(-.9,0,6.3),rotation:new n.O9p(-Math.PI/7,-Math.PI/2,Math.PI/3),scale:new n.Pq0(.07,.07,.07)},{position:new n.Pq0(-1,0,8),rotation:new n.O9p(0,-Math.PI/3,3*Math.PI/8),scale:new n.Pq0(.17,.17,.17)},{position:new n.Pq0(-.4,0,7.6),rotation:new n.O9p(0,-Math.PI/3,Math.PI/4),scale:new n.Pq0(.09,.09,.09)},{position:new n.Pq0(-.5,0,1.5),rotation:new n.O9p(Math.PI/4,Math.PI/7,0),scale:new n.Pq0(.1,.1,.1)}],R=[];let H,D,_,$;(new c.B).load("./Model/StarRightModel/StarRight.glb",(function(e){const t=e.scene;W.forEach((e=>{const o=t.clone(!0);o.position.copy(e.position),o.rotation.copy(e.rotation),o.scale.copy(e.scale),o.traverse((e=>{e.isMesh&&e.material&&(e.material=e.material.clone(),e.material.color=new n.Q1f(11184810))})),m.add(o),R.push(o)}))})),(new c.B).load("./Model/AmpModel/amp.glb",(function(e){H=e.scene,H.scale.set(.24,.24,.24),H.position.set(-2,0,7.3),H.rotation.y=4*Math.PI/5,m.add(H),N(H),console.log("âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†")}),void 0,(function(e){console.error("âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",e)})),(new c.B).load("./Model/TitleModel/Title.glb",(function(e){D=e.scene,D.scale.set(.5,.5,.5),D.position.set(2.5,0,4),D.rotation.y=-Math.PI/3,m.add(D),N(D),console.log("âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†")}),void 0,(function(e){console.error("âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",e)})),(new c.B).load("./Model/MicModel/mic.glb",(function(e){_=e.scene,_.scale.set(.12,.11,.12),_.position.set(.8,0,2),_.rotation.y=-Math.PI/8,m.add(_),N(_),console.log("âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†"),X=_,J.visible=!0,Z.innerHTML='\n      <p style="text-align: center; margin: 0px;">\n        Select Music<br>\n        â‡©\n      </p>\n    ',Z.style.opacity=0,r.Ay.to(Z,{opacity:1,duration:.6}),console.log("mic world position:",_.position),console.log("clickHereObj position:",J.position)}),void 0,(function(e){console.error("âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",e)})),(new c.B).load("./Model/TeleScopeModel/Telescope.glb",(function(e){$=e.scene,$.scale.set(.5,.5,.5),$.position.set(-1.5,0,2.4),$.rotation.y=Math.PI,m.add($),N($),console.log("âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†")}),void 0,(function(e){console.error("âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",e)}));const F=4;let U=0;function N(e){Ee.push(e),U++,U===F&&(function(){Oe.length=0;for(const e of Ee){if(!e)continue;const t=(new n.NRn).setFromObject(e);Oe.push(t)}}(),console.log("âœ… ã™ã¹ã¦ã®ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº† â†’ è¡çªãƒœãƒƒã‚¯ã‚¹åˆæœŸåŒ–"))}const j=document.getElementById("hologramBillboard"),Y=new s.on(j);j.style.display="block",Y.scale.set(.005,.005,.005),Y.visible=!1,m.add(Y);const Q=document.getElementById("ampMessageBillboard"),V=new s.on(Q);Q.style.display="block",V.scale.set(.005,.005,.005),V.visible=!1,m.add(V);const G=document.createElement("div");G.id="clickHereContainer";const Z=document.createElement("div");Z.id="clickHerePrompt",G.appendChild(Z);const J=new s.on(G);Z.style.display="block",J.scale.set(.01,.01,.01),J.position.set(0,0,0),m.add(J);let X=null;function K(){X=$,J.visible=!0,Z.innerHTML='\n      <p style="text-align: center; margin: 0px;">\n        Click Here<br>\n        â‡©\n      </p>\n    ',Z.style.opacity=0,r.Ay.to(Z,{opacity:1,duration:.6,onComplete:()=>{We=!0}})}const ee=new a.N(y,p.domElement);ee.enableDamping=!0,ee.dampingFactor=.07,ee.enabled=!0,ee.enablePan=!1,ee.enableZoom=!1,ee.target.set(0,1.6,4.9);const te=y.position.clone(),oe=y.quaternion.clone(),ne=ee.target.clone();console.log(ne),console.log(y.position),console.log("åˆæœŸã®ã‚«ãƒ¡ãƒ©Quaternion:",oe);let ie,ae="init",se=!1;function re(e){const t=document.getElementById("fadeOverlay");t.style.pointerEvents="auto",t.style.opacity="1",setTimeout((()=>e&&e()),1e3)}function le(e){const t=document.getElementById("fadeOverlay");t.style.opacity="0",setTimeout((()=>{t.style.pointerEvents="none",e&&e()}),1e3)}function ce(){ie&&m.remove(ie);const e=new n.Gu$(80,64,64),t=new n.V9B({color:1052704,side:n.hsX,transparent:!0,opacity:1,depthWrite:!1,depthTest:!0});ie=new n.eaF(e,t),ie.renderOrder=-1,ie.frustumCulled=!1,m.add(ie);const o=new n.LoY,i=[],a=[],s=new n.Q1f;for(let e=0;e<1500;e++){const e=49.5,t=2*Math.random()*Math.PI,o=Math.acos(2*Math.random()-1),n=e*Math.sin(o)*Math.cos(t),r=e*Math.sin(o)*Math.sin(t),l=e*Math.cos(o);i.push(n,r,l),s.setHSL(Math.random(),1,.7+.3*Math.random()),a.push(s.r,s.g,s.b)}o.setAttribute("position",new n.qtW(i,3)),o.setAttribute("color",new n.qtW(a,3));const l=new n.BH$({size:.2,vertexColors:!0,transparent:!0,opacity:.8}),c=new n.ONl(o,l);return ie.add(c),r.Ay.to(l,{opacity:.3+.5*Math.random(),duration:2+2*Math.random(),yoyo:!0,repeat:-1,ease:"sine.inOut"}),console.log("ğŸŒŒ æ˜Ÿç©ºãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ"),c.name="starSphere",c}ce();class de{constructor(e){this.player=new l.ai(e),this.listeners={},this.videoReady=!1,this.songReady=!1,this.song=null,this._holoSliderTimeUpdateRegistered=!1,this.loopOnEnd=!1,this.player.addListener({onAppReady:e=>{console.log("TextAlive App Ready"),this.appReady=!0,this._emit("appready",e);let t=null,o=0;this.player.addListener({onTimeUpdate:e=>{if(!this.player.video)return;this._emit("timeupdate",e);const i=this.player.video.duration||0;if(!He)return;if(this.loopOnEnd&&ue.forEach(((t,n)=>{if(!t.returned&&t.startTime>o&&e>=t.startTime){console.log(`  â†³ æˆ»ã™æ˜Ÿç¾¤ idx=${n} phrase="${t.text}" startTime=${t.startTime}`);const e=this.player.video.findPhrase(t.startTime),o=(e?.endTime||t.startTime+4e3)-t.startTime,i=me(t.text,t.startTime,t.center,o);ue[n]={...t,...i,returned:!0}}})),o=e,"exploringStars"!==ae)return;const a=this.player.video.findPhrase(e);a&&a.startTime!==t&&(t=a.startTime,console.log(a.text),function(e,t){console.log("â–¶ onNewPhrase:",e.text,"at",t);const o=e.startTime,i=(e.endTime||o+4e3)-o,a=me(e.text,t,null,i);(function(e,t=25){console.log("ğŸ’¥ spawnExplosionStars called at",e);const o=[],i=[],a=[],s=[],l=new n.Q1f;for(let r=0;r<t;r++){const t=30,r=new n.Pq0((Math.random()-.5)*t,(Math.random()-.5)*t,(Math.random()-.5)*t),c=(new n.Pq0).copy(e),d=(new n.Pq0).copy(e).add(r);o.push(c.x,c.y,c.z),i.push(d.x,d.y,d.z),l.setHSL(Math.random(),.6,.6+.3*Math.random()),a.push(l.r,l.g,l.b),s.push(.4+.6*Math.random())}const c=new n.LoY;c.setAttribute("position",new n.qtW(o,3)),c.setAttribute("aTarget",new n.qtW(i,3)),c.setAttribute("aColor",new n.qtW(a,3)),c.setAttribute("aSize",new n.qtW(s,1));const d=new n.BKk({transparent:!0,depthTest:!0,depthWrite:!1,blending:n.EZo,vertexColors:!0,uniforms:{uTime:{value:0},uFlicker:{value:0},uOpacity:{value:1}},vertexShader:"\n      attribute vec3 aTarget;\n      attribute vec3 aColor;\n      attribute float aSize;\n      varying vec3 vColor;\n      uniform float uTime;\n      uniform float uFlicker;\n      void main() {\n        vec3 newPos = mix(position, aTarget, uTime);\n        vec4 mvPosition = modelViewMatrix * vec4(newPos, 1.0);\n        gl_Position = projectionMatrix * mvPosition;\n        float flick = 0.1 + 0.3 * sin(uFlicker + aSize * 5.0);\n        float pointSize = aSize * (300.0 / abs(mvPosition.z)) * flick;\n        gl_PointSize = floor(pointSize) + 0.5;\n        vColor = aColor;\n      }\n    ",fragmentShader:"\n      varying vec3 vColor;\n      uniform float uOpacity;\n      void main() {\n        float d = distance(gl_PointCoord, vec2(0.5));\n        float alpha = smoothstep(0.5, 0.4, d) * uOpacity;\n        //if (alpha < 0.01) discard;\n        gl_FragColor = vec4(vColor, alpha);\n      }\n    "}),p=new n.ONl(c,d);p.renderOrder=888,p.frustumCulled=!1,fe.add(p),r.Ay.to(d.uniforms.uTime,{value:1,duration:1,ease:"power2.out"}),r.Ay.to(d.uniforms.uFlicker,{value:2*Math.PI,duration:2,repeat:-1,ease:"linear"})})(a.center),function(e){if(0!==ve.length)for(let t=0;t<4;t++){const t=ve[Math.floor(Math.random()*ve.length)],o=new n.bdM(1,1),i=new n.V9B({map:t,transparent:!0,opacity:0,depthWrite:!1,depthTest:!0,blending:n.EZo,side:n.$EB}),a=new n.eaF(o,i);a.renderOrder=777,a.frustumCulled=!1;const s=50,l=new n.Pq0((Math.random()-.5)*s,(Math.random()-.5)*s,(Math.random()-.5)*s);a.position.copy(e).add(l);const c=10+10*Math.random();a.scale.set(c,c,1),a.userData.lookAtCamera=!0,fe.add(a),r.Ay.to(i,{opacity:.15+.3*Math.random(),duration:1.5,ease:"power2.out"}),r.Ay.to(a.scale,{x:c+8,y:c+8,duration:3,ease:"sine.inOut"})}else console.warn("ğŸŒŒ nebula textures not yet loaded")}(a.center),a.returned=!1,ue.push(a),console.log("   â†’ allLyricData length:",ue.length)}(a,e)),i&&e>=i-100&&(console.log("æ›²çµ‚äº†æ¤œå‡º"),"exploringStars"===ae&&(re((()=>{!function(){if("exploringStars"!==ae)return;ae="resettingCamera",se=!0,ee.enabled=!1,ee.minPolarAngle=Math.PI/4,ee.maxPolarAngle=Math.PI,y.position.copy(te),y.quaternion.copy(oe);const e=new n.Pq0(0,0,-.01);e.applyQuaternion(y.quaternion).add(y.position),ee.target.copy(e),ee.update(),se=!1,console.log("ã‚«ãƒ¡ãƒ©ã®åˆæœŸçŠ¶æ…‹ã¸ã®ãƒªã‚»ãƒƒãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ")}(),$&&($.visible=!0),document.getElementById("vignetteOverlay").style.opacity="0",ae="viewing",q.visible=!0,A.visible=!0,A.material.opacity=1,z.visible=!0,z.material.opacity=1,B(),L(),ee.enabled=!0,le(),t=null})),this.loopOnEnd=!0))}})},onVideoReady:async e=>{console.log("ğŸ¬ Video Ready",e),this.videoReady=!0;const t=this.player.data.song;let o=0;for(;!t?.name&&o++<10;)console.log("æ›²æƒ…å ±ã‚’å¾…æ©Ÿä¸­...",o),await this._sleep(100);t?.name?(this.songReady=!0,this.song=t,console.log("æ›²å:",t.name)):console.warn("æ›²æƒ…å ±å–å¾—ã«å¤±æ•—"),this._emit("videoready",e)},onPlay:()=>this._emit("play"),onPause:()=>{console.log("â¸ onPause");const e=this.player.timer.position,t=this.player.video?.duration||0;if(this.loopOnEnd&&t&&e>=t-200)return console.log("âº çµ‚äº†ç›´å¾Œã®pauseæ¤œå‡º â†’ å†ç”Ÿå†é–‹"),ue.forEach((e=>e.returned=!1)),void this.restartCurrentSong();this._emit("pause")},onStop:()=>{this._emit("stop")}})}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}_emit(e,t){(this.listeners[e]||[]).forEach((e=>e(t)))}_sleep(e){return new Promise((t=>setTimeout(t,e)))}async loadSong(e){try{console.log("loadSong é–‹å§‹:",e.url),this.player&&this.player.isPlaying&&this.player.requestStop()}catch(e){console.warn("loadSong: stopå¤±æ•—ï¼ˆç„¡è¦–ï¼‰",e.name,e.message)}this.videoReady=!1,this.songReady=!1,this.song=null;try{await this.player.createFromSongUrl(e.url,{video:{beatId:e.beatId,chordId:e.chordId,repetitiveSegmentId:e.repetitiveSegmentId,lyricId:e.lyricId,lyricDiffId:e.lyricDiffId}})}catch(e){throw console.error("createFromSongUrl: ã‚¨ãƒ©ãƒ¼",e.name,e.message),e}let t=0;for(;!this.videoReady&&t++<10;)await this._sleep(300);if(!this.videoReady)throw new Error("videoReady ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ");return!0}async safePlay(e=!0){try{if(!this.player.mediaElement)return void console.warn("mediaElement ãŒæœªå®šç¾©ã§ã™");if(console.log("safePlay å®Ÿè¡Œé–‹å§‹"),this.player.mediaElement.paused)try{this.player.requestPlay()}catch(e){if("AbortError"!==e.name)throw e;console.warn("AbortError: play() ãŒä¸­æ–­ã•ã‚Œã¾ã—ãŸã€‚pause() ãŒå‰²ã‚Šè¾¼ã‚“ã å¯èƒ½æ€§")}if(await this._sleep(200),!this.player.isPlaying&&e){console.warn("å†è©¦è¡Œ: requestPlay");try{this.player.requestPlay()}catch(e){"AbortError"===e.name?console.warn("å†è©¦è¡Œã§ã‚‚ AbortError:",e.message):console.warn("å†è©¦è¡Œã‚‚ä¸­æ–­:",e)}}}catch(e){console.error("requestPlay å®Œå…¨å¤±æ•—",e)}}async safePause(){try{this.player.requestPause()}catch(e){console.error("requestPause ã‚¨ãƒ©ãƒ¼",e)}}async safeStop(){try{this.player.requestStop()}catch(e){console.error("requestStop ã‚¨ãƒ©ãƒ¼",e)}}getPlayer(){return this.player}getCurrentSong(){return this.song}get isPlaying(){return this.player.isPlaying}restartCurrentSong(){this.player&&this.player.video&&(this.player.requestMediaSeek(0),setTimeout((()=>{this.safePlay()}),500))}}const pe=new n.YJl;pe.position.set(0,0,0),pe.rotation.set(0,0,0),pe.scale.set(1,1,1),m.add(pe);const ue=[];function me(e,t,o=null,i=4e3){const a=ue.find((o=>o.text===e&&o.startTime===t));a&&function(e){if(e.constellationLines){const t=e.constellationLines.material;r.Ay.to(t,{opacity:0,duration:1,ease:"power2.out",onComplete:()=>{m.remove(e.constellationLines),e.constellationLines.geometry.dispose(),e.constellationLines.material.dispose(),e.constellationLines=null}})}if(e.points&&e.keepIndices){const t=e.points.geometry.getAttribute("position"),o=e.points.geometry.getAttribute("aSize"),i=e.points.material;e.keepIndices.forEach((e=>{const i=new n.Pq0(t.getX(e),t.getY(e),t.getZ(e)),a=new n.Pq0(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize().multiplyScalar(2+4*Math.random()),s=i.clone().add(a);if(r.Ay.to(i,{x:s.x,y:s.y,z:s.z,duration:1.2,ease:"power2.out",onUpdate:()=>{t.setXYZ(e,i.x,i.y,i.z),t.needsUpdate=!0}}),o){const t={value:o.getX(e)};r.Ay.to(t,{value:0,duration:1.2,onUpdate:()=>{o.setX(e,t.value),o.needsUpdate=!0}})}})),r.Ay.to(i.uniforms.uOpacity,{value:0,duration:1.2,ease:"power2.out",onComplete:()=>{pe.remove(e.points),e.points.geometry.dispose(),e.points.material.dispose(),e.points=null}})}}(a);const s=Math.max(i/1e3,1.5),l=function(e,{canvasSize:t=1024,xStep:o=1,yStep:i=1,threshold:a=128,font:s='bold 48px "Noto Sans JP", Meiryo, sans-serif',scale:r=120}={}){const l=document.createElement("canvas");l.width=l.height=t;const c=l.getContext("2d");c.clearRect(0,0,t,t),c.fillStyle="white",c.font=s,c.textAlign="center",c.textBaseline="middle",c.fillText(e,t/2,t/2);const d=c.getImageData(0,0,t,t).data,p=[];for(let e=0;e<t;e+=i)for(let n=0;n<t;n+=o)d[4*(e*t+n)+3]>a&&p.push({x:n,y:e});let u=0,m=0;p.forEach((({x:e,y:t})=>{u+=e,m+=t}));const y=u/p.length,h=m/p.length;return p.map((({x:e,y:o})=>{const i=(e-y)/t*r,a=(h-o)/t*r,s=1.5*(Math.random()-.5);return new n.Pq0(i,a,s)}))}(e,{canvasSize:1024,xStep:1,yStep:1,scale:120,font:'bold 48px "Noto Sans JP", Meiryo'}),c=new n.Pq0;y.getWorldDirection(c);const d=55+5*Math.random(),p=y.position.clone().add(c.clone().multiplyScalar(d)),u=o||p,h=function(e){const t=new n.Pq0;y.getWorldDirection(t);const o=(new n.Pq0).crossVectors(t,y.up).normalize(),i=[...Array(e.length).keys()].sort(((t,o)=>e[t].x-e[o].x)),a=e[i[0]],s=e[i[i.length-1]],r=(new n.Pq0).subVectors(s,a).normalize(),l=r.dot(o);return console.log("First pos:",a.toArray()),console.log("Last pos:",s.toArray()),console.log("SpanVec:",r.toArray()),console.log("Right:",o.toArray()),console.log("Dot product:",l),l>=0?o:o.negate()}(l),g=function(e,{sizeRange:t=[.1,.3],colorHueRange:o=[0,1],sortDirection:i=null}={}){const a=e.length,s=[],l=[],c=[],d=new Float32Array(a).fill(0);for(let i=0;i<a;i++){const a=new n.Pq0(7*(Math.random()-.5),7*(Math.random()-.5),7*(Math.random()-.5)),r=e[i].clone().add(a);s.push(...r.toArray());const d=Math.random()*(o[1]-o[0])+o[0],p=(new n.Q1f).setHSL(d,1,.7);l.push(p.r,p.g,p.b);const u=2*Math.random()*(t[1]-t[0])+t[0];c.push(u)}const p=new n.LoY;p.setAttribute("position",new n.qtW(s,3)),p.setAttribute("aColor",new n.qtW(l,3)),p.setAttribute("aSize",new n.qtW(c,1)),p.setAttribute("aOpacity",new n.qtW(d,1));const u=new n.BKk({transparent:!0,blending:n.EZo,depthTest:!0,depthWrite:!1,uniforms:{uTime:{value:0},uOpacity:{value:1}},vertexShader:"\n      attribute float aSize;\n      attribute vec3 aColor;\n      attribute float aOpacity;\n      varying vec3 vColor;\n      varying float vOpacity;\n      uniform float uTime;\n      void main(){\n        vColor = aColor;\n        vOpacity = aOpacity;\n        vec4 mv = modelViewMatrix * vec4(position,1.0);\n        gl_PointSize = aSize * (300.0 / -mv.z) * clamp(uTime, 0.0, 1.0);\n        gl_Position = projectionMatrix * mv;\n      }",fragmentShader:"\n      varying vec3 vColor;\n\n      varying float vOpacity;\n      uniform float uOpacity;\n      void main(){\n        float d = distance(gl_PointCoord, vec2(0.5));\n        if(d > 0.5) discard;\n        float alpha = mix(0.0, 1.0, vOpacity);\n        gl_FragColor = vec4(vColor, alpha * uOpacity);\n      }"}),m=new n.ONl(p,u),y=p.getAttribute("position"),h=p.getAttribute("aOpacity"),g=[...Array(a).keys()];if(i){g.sort(((t,o)=>e[t].dot(i)-e[o].dot(i)));const t=e[g[0]],o=e[g[g.length-1]];console.log("ğŸ¯ Sorted direction test:"),console.log("First pos:",t.toArray()),console.log("Last pos:",o.toArray())}return g.forEach(((t,o)=>{const i=new n.Pq0(y.getX(t),y.getY(t),y.getZ(t)),a=e[t];r.Ay.to(d,{[t]:1,delay:2e-4*o,duration:.3,ease:"power2.out",onUpdate:()=>{h.array[t]=d[t],h.needsUpdate=!0}}),r.Ay.to(i,{x:a.x,y:a.y,z:a.z,delay:2e-4*o,duration:.5,ease:"power2.out",onUpdate:()=>{y.setXYZ(t,i.x,i.y,i.z),y.needsUpdate=!0}})})),m}(l,{sizeRange:[.1,.25],colorHueRange:[0,1],sortDirection:h});g.position.copy(u),pe.add(g);const w=[...Array(l.length).keys()];w.sort(((e,t)=>l[e].dot(h)-l[t].dot(h)));const f=g.material;if(r.Ay.to(f.uniforms.uTime,{value:1,duration:1,ease:"power2.out"}),r.Ay.to(f.uniforms.uOpacity,{value:1,duration:.8,ease:"power2.out",onComplete:()=>{const e=g.geometry.getAttribute("position"),t=g.geometry.getAttribute("aOpacity"),o=t.array,i=[];for(let t=0;t<e.count;t++){const o=(new n.Pq0).fromBufferAttribute(e,t),a=new n.Pq0(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize().multiplyScalar(2+4*Math.random());i.push(o.clone().add(a))}w.forEach(((a,l)=>{const c=i[a];if(!c)return;const d=(new n.Pq0).fromBufferAttribute(e,a);r.Ay.to(d,{x:c.x,y:c.y,z:c.z,delay:s-.8+2e-4*l,duration:1.5,ease:"power2.out",onUpdate:()=>{e.setXYZ(a,d.x,d.y,d.z),e.needsUpdate=!0}}),r.Ay.to(o,{[a]:0,delay:s-.8+2e-4*l,duration:1.5,ease:"power2.out",onUpdate:()=>{t.array[a]=o[a],t.needsUpdate=!0}})}))}}),0===ge.length)return console.warn("No constellation targets available"),{text:e,startTime:t,center:u,points:g};let v=null,P=1/0;for(const e of ge){const t=u.distanceTo(e.position);t<P&&(P=t,v=e)}if(!v)return console.warn("æœ€è¿‘å‚ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"),{text:e,startTime:t,center:u,points:g};const M=v.position.clone();return console.log(`ğŸ“ Nearest constellation: ${v.name}`),console.log("center:",u.toArray()),console.log("targetPos:",M.toArray()),console.log("distance:",P.toFixed(2)),P<5?(console.log(`ğŸŒŸ æ˜Ÿåº§ã€Œ${v.name}ã€ã‚’ç”Ÿæˆ`),function({data:e,position:t,name:o}){if(ye.has(o))return void console.log(`âš ï¸ æ˜Ÿåº§ "${o}" ã¯æ—¢ã«ç”Ÿæˆæ¸ˆã¿ã§ã™`);const i=new n.YJl,a=new n.Pq0;e.stars.forEach((([e,t,o])=>{a.x+=e,a.y+=t,a.z+=o})),a.divideScalar(e.stars.length),i.position.copy(t),e.stars.forEach((e=>{const t=new n.eaF(new n.Gu$(.2,8,8),new n.V9B({color:16777164})),o=new n.Pq0(...e).sub(a);t.position.copy(o),i.add(t)})),e.connections.forEach((([t,o])=>{const s=new n.Pq0(...e.stars[t]).sub(a),r=new n.Pq0(...e.stars[o]).sub(a),l=(new n.LoY).setFromPoints([s,r]),c=new n.N1A(l,new n.mrM({color:8834763}));i.add(c)})),m.add(i);const s=(new n.Pq0).copy(y.position);i.lookAt(s),ye.add(o),function(){const e=ye.size;let t;t=e>=10?52945:e>=8?255:e>=6?8388736:e>=3?16738740:11184810;const o=new n.Q1f(t);R.forEach((e=>{e.traverse((e=>{if(e.isMesh&&e.material&&e.material.color){const t=e.material.color.clone();r.Ay.to(t,{r:o.r,g:o.g,b:o.b,duration:1.2,ease:"power2.out",onUpdate:()=>{e.material.color.setRGB(t.r,t.g,t.b)}})}}))}))}(),function(){if(!ie)return;const e=ye.size,t=Math.min(e/10,1),o=new n.Q1f(1052704),i=new n.Q1f(3355494),a=o.clone().lerp(i,t);r.Ay.to(ie.material.color,{r:a.r,g:a.g,b:a.b,duration:1.5,ease:"power2.out"})}(),1===ye.size&&function(){if(Me)return;Me=!0;let e=0;!function t(){const o=performance.now(),n=ye.size,i=Math.max(1e3,6e3-500*n);if(o-e>i){e=o;const t=n,i=1+Math.floor(Math.random()*(1+t));for(let e=0;e<i;e++)be()}requestAnimationFrame(t)}()}()}({data:v.data,position:M,name:v.name})):console.log("è·é›¢ãŒé ã™ãã¦æ˜Ÿåº§æœªç”Ÿæˆ"),!Le?.loopOnEnd&&P>5&&P<50?function(e,t,o,i){const a=[],s=[],l=new n.LoY,c=new n.Q1f,d=(Math.max(5,Math.min(o,50))-5)/40,p=.9*(1-d),u=5+10*(1-d),y=2+6*d,h=new n.Pq0(0,1,0),g=(new n.kn4).lookAt(new n.Pq0,t,h);for(let t=0;t<300;t++){const t=Math.random()*u,o=(1-t/u)*y,i=Math.random()*Math.PI*2,r=Math.cos(i)*o,l=Math.sin(i)*o,p=-t,m=new n.Pq0(r,l,p).applyMatrix4(g),h=e.clone().add(m);a.push(h.x,h.y,h.z);const w=.1+.4*Math.random(),f=1-d,v=.7;c.setHSL(w,f,v),s.push(c.r,c.g,c.b)}l.setAttribute("position",new n.qtW(a,3)),l.setAttribute("color",new n.qtW(s,3));const w=new n.BH$({size:.2,vertexColors:!0,transparent:!0,opacity:0,depthWrite:!1,blending:n.EZo}),f=new n.ONl(l,w);m.add(f);const v={value:0},P=r.Ay.to(v,{value:4*Math.PI,duration:2,repeat:-1,ease:"sine.inOut",onUpdate:()=>{const e=(Math.sin(v.value)+1)/2;w.opacity=p*(.3+.6*e)}});setTimeout((()=>{P.kill(),r.Ay.to(w,{opacity:0,duration:1,ease:"power2.in",onComplete:()=>{m.remove(f),l.dispose(),w.dispose()}})}),1e3*i)}(u,(new n.Pq0).subVectors(M,u).normalize(),P,s):Le?.loopOnEnd&&console.log("ğŸ” ãƒ«ãƒ¼ãƒ—ä¸­ã®ãŸã‚ãƒ’ãƒ³ãƒˆè¡¨ç¤ºã¯ã‚¹ã‚­ãƒƒãƒ—"),{text:e,startTime:t,center:u,points:g}}const ye=new Set,he={hercules:{stars:[[0,0,0],[6,9,.2],[-6,9,-.2],[6,18,0],[-6,18,0]],connections:[[0,1],[0,2],[1,3],[2,4],[3,4]],size:16},canisMajor:{stars:[[0,0,0],[5,6,0],[10,3,.2],[15,0,-.2],[5,-6,.1]],connections:[[0,1],[1,2],[2,3],[0,4]],size:15},ursaMinor:{stars:[[0,0,0],[3,3,.2],[6,6,-.2],[9,9,0],[12,12,0]],connections:[[0,1],[1,2],[2,3],[3,4]],size:12},draco:{stars:[[0,0,0],[3,3,.3],[6,6,-.2],[9,9,.1],[12,6,0],[15,3,-.1],[18,0,0]],connections:[[0,1],[1,2],[2,3],[3,4],[4,5],[5,6]],size:18},capricornus:{stars:[[0,0,0],[6,0,.1],[3,6,-.1],[0,12,0],[-3,6,0],[-6,0,0]],connections:[[0,1],[1,2],[2,3],[3,4],[4,5],[5,0]],size:12},crux:{stars:[[0,0,0],[0,11.25,0],[7.5,5.625,.375],[-7.5,5.625,-.375]],connections:[[0,1],[2,3]],size:12},pegasus:{stars:[[0,0,0],[11.25,0,.375],[11.25,11.25,-.375],[0,11.25,0]],connections:[[0,1],[1,2],[2,3],[3,0]],size:12},leo:{stars:[[0,0,0],[7.5,3.75,.1875],[15,0,-.1875],[11.25,11.25,0]],connections:[[0,1],[1,2],[1,3]],size:15},andromeda:{stars:[[0,0,0],[3.75,7.5,.375],[7.5,15,-.375],[11.25,22.5,.1875],[15,30,-.1875]],connections:[[0,1],[1,2],[2,3],[3,4]],size:16},taurus:{stars:[[0,0,0],[-5.625,11.25,0],[-11.25,22.5,-.375],[-16.875,33.75,.375],[-22.5,22.5,0],[-28.125,11.25,-.1875]],connections:[[0,1],[1,2],[2,3],[3,4],[4,5]],size:16},lyra:{stars:[[0,0,0],[11.25,0,.375],[5.625,11.25,0],[5.625,5.625,3.75]],connections:[[0,1],[1,2],[2,0],[2,3]],size:12},scorpius:{stars:[[0,0,0],[3.75,7.5,0],[7.5,11.25,-.375],[11.25,7.5,0],[15,0,.375],[11.25,-7.5,0],[7.5,-11.25,-.375],[3.75,-7.5,0]],connections:[[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],[6,7]],size:13},aquarius:{stars:[[0,0,0],[3.75,3.75,.375],[7.5,0,-.375],[11.25,3.75,.1875],[15,0,-.1875],[18.75,3.75,0]],connections:[[0,1],[1,2],[2,3],[3,4],[4,5]],size:15},orion:{stars:[[0,0,0],[7.5,15,.375],[-7.5,15,-.375],[0,30,0],[11.25,-7.5,.375],[-11.25,-7.5,-.375],[0,-18.75,0]],connections:[[0,1],[0,2],[1,3],[2,3],[0,4],[0,5],[4,6],[5,6]],size:16},cassiopeia:{stars:[[0,0,0],[7.5,7.5,.375],[15,0,0],[22.5,7.5,-.375],[30,0,0]],connections:[[0,1],[1,2],[2,3],[3,4]],size:15},cygnus:{stars:[[0,0,0],[0,7.5,.375],[0,15,-.375],[-7.5,7.5,0],[7.5,7.5,0]],connections:[[0,1],[1,2],[1,3],[1,4]],size:10}},ge=[],we=new n.YJl;m.add(we);const fe=new n.YJl;m.add(fe);const ve=[],Pe=new n.Tap;["./texture/astro1.png","./texture/astro2.png","./texture/astro3.png","./texture/astro1.png","./texture/astro2.png","./texture/astro3.png","./texture/astro1.png","./texture/astro2.png","./texture/astro3.png"].forEach((e=>{Pe.load(e,(e=>ve.push(e)),void 0,(t=>console.error("Nebula load error",e,t)))}));let Me=!1;function be(){const e=new n.LoY,t=[],o=[],i=[],a=new n.Pq0;y.getWorldDirection(a);const s=(new n.Pq0).copy(y.position).add(a.multiplyScalar(30)),l=2*Math.random()*Math.PI,c=Math.acos(2*Math.random()-1),d=30*Math.random(),p=new n.Pq0(d*Math.sin(c)*Math.cos(l),d*Math.sin(c)*Math.sin(l),d*Math.cos(c)),u=s.clone().add(p),h=u.clone().add(new n.Pq0(20*(Math.random()-.5),-4*Math.random(),-2*Math.random())),g=new n.Q1f(16777215),w=new n.Q1f(12316415);for(let e=0;e<40;e++){const n=e/39,a=u.clone().lerp(h,n);t.push(a.x,a.y,a.z),o.push(.1+.3*n);const s=g.clone().lerp(w,n);i.push(s.r,s.g,s.b)}e.setAttribute("position",new n.qtW(t,3)),e.setAttribute("aSize",new n.qtW(o,1)),e.setAttribute("aColor",new n.qtW(i,3));const f=new n.BKk({uniforms:{uOpacity:{value:1}},vertexShader:"\n    precision mediump float;\n    attribute float aSize;\n    attribute vec3 aColor;\n    varying vec3 vColor;\n    void main() {\n      vColor = aColor;\n      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n      gl_PointSize = aSize * (300.0 / -mvPosition.z);\n      gl_Position = projectionMatrix * mvPosition;\n    }\n  ",fragmentShader:"\n    precision mediump float;\n    uniform float uOpacity;\n    varying vec3 vColor;\n    void main() {\n      float d = length(gl_PointCoord - vec2(0.5));\n      if (d > 0.5) discard;\n      gl_FragColor = vec4(vColor, uOpacity);\n    }\n  ",vertexColors:!0,transparent:!0,depthWrite:!1}),v=new n.ONl(e,f);m.add(v),function(e){const t=[];for(let o=0;o<40;o++){const o=new n.Pq0(2*(Math.random()-.5),2*(Math.random()-.5),2*(Math.random()-.5)),i=e.clone().add(o);t.push(i.x,i.y,i.z)}const o=new n.LoY;o.setAttribute("position",new n.qtW(t,3));const i=new n.BH$({color:8965375,size:.07,transparent:!0,opacity:1,depthWrite:!1,blending:n.NTi}),a=new n.ONl(o,i);m.add(a),r.Ay.to(i,{opacity:0,duration:2,ease:"power1.out",onComplete:()=>{m.remove(a),o.dispose(),i.dispose()}})}(h),r.Ay.to(f.uniforms.uOpacity,{value:0,duration:1.2,ease:"power1.out",onComplete:()=>{m.remove(v),e.dispose(),f.dispose()}})}const xe=new n.Pq0,qe=new n.Pq0,Ie=new n.Pq0,Ae=new n.Pq0,Se=new n.Pq0(0,-1.6,0),ze=new n.Pq0,Ce={},Ee=[],Oe=[],Te=new n.Pq0(0,0,5);window.addEventListener("keydown",(e=>Ce[e.key]=!0)),window.addEventListener("keyup",(e=>Ce[e.key]=!1));const ke=new n.tBo;let Le;window.addEventListener("mousemove",(function(e){De.x=e.clientX/window.innerWidth*2-1,De.y=-e.clientY/window.innerHeight*2+1}));let Be=!1,We=!1,Re=!1,He=!1;document.addEventListener("DOMContentLoaded",(()=>{function e(e,t){let o=e;for(;o;){if(o===t)return!0;o=o.parent}return!1}Le=new de({app:{token:"F3s1rJugVHrXdNRN"},mediaElement:document.querySelector("#media")}),Z.addEventListener("click",(()=>{const e=Z.innerHTML;if(e.includes("Click Here")){if(!Le.player.video||!We)return;console.log("æœ›é é¡ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"),c()}else e.includes("Select Music")&&(console.log("ãƒã‚¤ã‚¯ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"),Be=!0,r.Ay.to(Z,{opacity:0,duration:.6,onComplete:()=>{J.visible=!1,s(),l(),setTimeout((()=>{K()}),3e3)}}))})),window.addEventListener("mousedown",(t=>{const o=ke.intersectObjects(m.children,!0);if(o.length>0){const t=o[0].object;if(console.log(t),"init"===ae&&!Be&&_&&e(t,_))console.log("ãƒã‚¤ã‚¯ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"),Be=!0,r.Ay.to(Z,{opacity:0,duration:.6,onComplete:()=>{J.visible=!1,s(),l(),setTimeout((()=>{K()}),3e3)}});else if("init"===ae&&!Re&&$&&e(t,$)){if(!Le.player.video||!We)return;console.log("æœ›é é¡ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"),Re=!0,c()}else"viewing"!==ae&&"init"!==ae||!H||!e(t,H)||V.visible||(console.log("ã‚¢ãƒ³ãƒ—ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"),function(){const e=new n.Pq0;H.getWorldPosition(e),e.y+=2,V.position.copy(e),V.visible=!0,V.scale.set(1e-4,1e-4,1e-4);const t=document.getElementById("ampMessageBillboard");t.style.opacity=0,"init"===ae?t.innerHTML='\n      <p style="text-align: center; font-size: 20px; margin: 1em">\n        ãƒã‚¤ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ›²ã‚’é¸ã¼ã†<br>\n        <br>\n        æ›²ã‚’æ±ºã‚ãŸã‚‰ã€æœ›é é¡ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã‚ˆã†<br>\n        <br>\n      </p>\n      <p style="text-align: center; font-size: 15px; margin: 1em">\n        ã©ã“ã‹ã«æ˜Ÿåº§ãŒéš ã•ã‚Œã¦ã‚‹ã‹ã‚‚â€¦ï¼Ÿ\n      </p>\n    ':"viewing"===ae&&(t.innerHTML='\n      <p style="text-align: center; font-size: 20px; margin: 1em">\n        éŠã‚“ã§ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ï¼\n      </p>\n    '),r.Ay.to(V.scale,{x:.005,y:.005,z:.005,duration:.8,ease:"expo.out"}),r.Ay.to(t,{opacity:1,duration:.8,ease:"power2.out"}),r.Ay.to(V.scale,{x:1e-4,y:1e-4,z:1e-4,delay:5,duration:1.5,ease:"expo.in"}),r.Ay.to(t,{opacity:0,delay:5,duration:1.5,ease:"expo.in",onComplete:()=>{V.visible=!1}})}())}}));let t=null,o=null,i=null,a=0;function s(){const e=document.querySelector(".slider-wrapper");function n(e){const t=Math.floor(e/1e3);return`${Math.floor(t/60).toString().padStart(2,"0")}:${(t%60).toString().padStart(2,"0")}`}e.innerHTML="",Le._holoSliderTimeUpdateRegistered||(Le._holoSliderTimeUpdateRegistered=!0,Le.on("timeupdate",(e=>{o&&i&&function(e){const t=Le.player.video;if(!t)return;const a=t.duration,s=e/a*100;o.value=s,i.textContent=`${n(e)} / ${n(a)}`}(e)}))),u.forEach(((t,o)=>{const n=document.createElement("div");n.className="slide",n.dataset.index=o,n.innerHTML=`\n      <div class="slide-content">\n        <img class="jacket" src="${t.image}" alt="${t.title}" />\n        <div class="song-info">\n          <h3 class="song-title">${t.title}</h3>\n          <p class="song-artist">${t.artist}</p>\n          <img src="./texture/barlines.png" class="barlines" alt="bars" />\n        </div>\n      </div>\n      <div class="player-controls">\n        <button class="play-btn">â–¶</button>\n        <input type="range" class="seek-bar" min="0" max="100" value="0" />\n        <span class="time-display">00:00 / 00:00</span>\n      </div>\n    `,e.appendChild(n)}));const s=document.getElementById("slidePrev"),l=document.getElementById("slideNext");async function c(c){a=(a+c+u.length)%u.length;const d=e.querySelector(".slide").offsetWidth;r.Ay.to(e,{x:-d*a,duration:.3,ease:"power2.out"});const p=e.children[a];t=p.querySelector(".play-btn"),o=p.querySelector(".seek-bar"),i=p.querySelector(".time-display"),s.classList.add("disabled"),l.classList.add("disabled"),t.classList.add("disabled"),t.textContent="...",o.classList.add("disabled"),o.value=0,i.textContent="èª­ã¿è¾¼ã¿ä¸­...",await Le.loadSong(u[a]),s.classList.remove("disabled"),l.classList.remove("disabled"),t.classList.remove("disabled"),t.textContent="â–¶",o.value=0;const m=Le.player.video?.duration||0;i.textContent=`00:00 / ${n(m)}`,t.onclick=async()=>{Le.videoReady&&(Le.isPlaying?(await Le.safePause(),t.textContent="â–¶",o.classList.add("disabled"),console.log("[play button] Paused.")):(await Le.safePlay(),t.textContent="â¸",o.classList.remove("disabled"),console.log("[play button] Playing.")))},o.oninput=()=>{const e=Le.player.video;if(!e)return;const t=o.value/100*e.duration;console.log(`[seekBar.input] Requesting seek to: ${t.toFixed(0)}ms`),Le.player.requestMediaSeek(t)}}s.addEventListener("click",(()=>c(-1))),l.addEventListener("click",(()=>c(1))),c(0)}function l(){const e=new n.Pq0;_.getWorldPosition(e),e.y+=2.1,Y.position.copy(e),Y.visible=!0,Y.scale.set(1e-4,1e-4,1e-4);const t=document.getElementById("hologramBillboard");t.style.opacity=0,r.Ay.to(Y.scale,{x:.005,y:.005,z:.005,duration:.8,ease:"expo.out"}),r.Ay.to(t,{opacity:1,duration:.8,ease:"power2.out"})}function c(){if("init"!==ae)return;if(!Le.songReady)return;Le.safePause(),r.Ay.to(Z,{opacity:0,duration:.6,onComplete:()=>{J.visible=!1}}),ae="telescopeZooming";const e=$.position.clone(),t=y.position.clone(),o=new n.ubm;o.position.copy(t),o.lookAt(e.x+1,e.y,e.z);const i=o.quaternion.clone(),a=y.quaternion.clone();r.Ay.to(y.position,{x:e.x,y:e.y+1.2,z:e.z+.6,duration:2,ease:"power2.inOut"}),r.Ay.to({t:0},{t:1,duration:2,ease:"power2.inOut",onUpdate(){let e=this.targets()[0].t;y.quaternion.copy(a).slerp(i,e);const t=new n.Pq0(0,0,-.01).applyQuaternion(y.quaternion).add(y.position);ee.target.copy(t)},onComplete(){const e=new n.Pq0(0,0,-.01);e.applyQuaternion(y.quaternion).add(y.position),ee.target.copy(e),ae="fadingOut",re((async()=>{$&&($.visible=!1),Y.visible=!1,function({count:e=10,minDistance:t=40,cameraDistance:o=55,minPolarAngle:i=2*Math.PI/14,maxPolarAngle:a=4*Math.PI/8}){ge.length=0;const s=Object.keys(he),r=[],l=new n.Pq0;for(y&&y.getWorldDirection(l);r.length<e&&s.length>0;){const e=Math.floor(Math.random()*s.length),l=s.splice(e,1)[0],c=he[l];let d=0;for(;d<300;){const e=2*Math.random()*Math.PI,s=Math.acos(2*Math.random()-1),p=new n.Pq0(Math.sin(s)*Math.cos(e),Math.cos(s),Math.sin(s)*Math.sin(e)),u=Math.acos(p.y);if(u<i||u>a){d++;continue}const m=y?y.position.clone().add(p.multiplyScalar(o)):p.multiplyScalar(o);if(!ge.some((e=>e.position.distanceTo(m)<t+c.size))){ge.push({name:l,data:c,position:m}),r.push(l);break}d++}}ge.length<e&&console.log(`âš ï¸ ${e}å€‹ä¸­${ge.length}å€‹ã—ã‹é…ç½®ã§ãã¾ã›ã‚“ã§ã—ãŸ`),console.log("ğŸŒŒ Placed constellation targets:",ge)}({count:13,minDistance:20,cameraDistance:55}),ce(),ee.enabled=!0,ee.enableZoom=!1,ee.enablePan=!1,ee.enableRotate=!0,ee.minPolarAngle=3*Math.PI/7,ee.maxPolarAngle=7*Math.PI/8,y.position.set($.position.x,2,$.position.z),ee.target.set($.position.x,2,$.position.z-.1),ee.update(),document.getElementById("vignetteOverlay").style.opacity="1",q.visible=!1,B(),L(!0),setTimeout((()=>{r.Ay.to(A.material,{opacity:0,duration:1.2,onComplete:()=>{A.visible=!1}}),r.Ay.to(z.material,{opacity:0,duration:1.2,onComplete:()=>{z.visible=!1}})}),1e4),le((()=>{ae="exploringStars"})),await Le._sleep(1500),Le.restartCurrentSong(),He=!0}))}})}let d=!1,p=new n.PTz;y.quaternion.clone(p),ee.addEventListener("start",(()=>{d=!0})),ee.addEventListener("change",(()=>{d&&(y.quaternion.equals(p)||(document.body.style.cursor="grabbing"),p.copy(y.quaternion))})),ee.addEventListener("end",(()=>{d=!1,document.body.style.cursor="grab"})),Le.on("appready",(()=>{console.log("âœ… ã‚¢ãƒ—ãƒªæº–å‚™å®Œäº†")})),Le.on("videoready",(()=>{console.log("âœ… ãƒ“ãƒ‡ã‚ªæº–å‚™å®Œäº†")})),Le.on("play",(()=>{const e=Le.getCurrentSong();e&&console.log(`â–¶ï¸ å†ç”Ÿä¸­: ${e.name} by ${e.artist?.name??"ä¸æ˜"}`)})),Le.on("pause",(()=>{console.warn("ğŸ›‘ safePause å‘¼ã³å‡ºã—ï¼ˆã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ï¼‰"),console.trace(),console.log("pause")})),Le.on("stop",(()=>{console.log("stop")}));const u=[{title:"ã‚¹ãƒˆãƒªãƒ¼ãƒˆãƒ©ã‚¤ãƒˆ",artist:"åŠ è³€(ãƒã‚®ã‚·ãƒ£ãƒ¯ãƒ¼P)",url:"https://piapro.jp/t/ULcJ/20250205120202",image:"./texture/cover.png",beatId:4694275,chordId:2830730,repetitiveSegmentId:2946478,lyricId:67810,lyricDiffId:20654},{title:"ã‚¢ãƒªãƒ•ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",artist:"é›¨è‰¯ Amala",url:"https://piapro.jp/t/SuQO/20250127235813",image:"./texture/cover.png",beatId:4694276,chordId:2830731,repetitiveSegmentId:2946479,lyricId:67811,lyricDiffId:20655},{title:"ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒãƒ«ãƒ€ã‚¤ãƒ–",artist:"99piano",url:"https://piapro.jp/t/Ppc9/20241224135843",image:"./texture/cover.png",beatId:4694277,chordId:2830732,repetitiveSegmentId:2946480,lyricId:67812,lyricDiffId:20656},{title:"ãƒãƒ­ãƒ¼ã€ãƒ•ã‚§ãƒ«ãƒŸã€‚",artist:"ã©ï½ã±ã¿ã‚“",url:"https://piapro.jp/t/oTaJ/20250204234235",image:"./texture/cover.png",beatId:4694278,chordId:2830733,repetitiveSegmentId:2946481,lyricId:67813,lyricDiffId:20657},{title:"ãƒ‘ãƒ¬ãƒ¼ãƒ‰ãƒ¬ã‚³ãƒ¼ãƒ‰",artist:"ãã•ã‚‰",url:"https://piapro.jp/t/GCgy/20250202202635",image:"./texture/cover.png",beatId:4694279,chordId:2830734,repetitiveSegmentId:2946482,lyricId:67814,lyricDiffId:20658},{title:"ãƒ­ãƒ³ãƒªãƒ¼ãƒ©ãƒ³",artist:"æµ·é¢¨å¤ªé™½",url:"https://piapro.jp/t/CyPO/20250128183915",image:"./texture/cover.png",beatId:4694280,chordId:2830735,repetitiveSegmentId:2946483,lyricId:67815,lyricDiffId:20659}]}));const De=new n.I9Y;!function e(){if(requestAnimationFrame(e),function(){y.getWorldDirection(Ie),Ie.y=0,Ie.normalize(),Ae.crossVectors(Ie,y.up).normalize(),ze.set(0,0,0),(Ce.ArrowUp||Ce.w)&&ze.add(xe.copy(Ie).multiplyScalar(.05)),(Ce.ArrowDown||Ce.s)&&ze.add(xe.copy(Ie).multiplyScalar(-.05)),(Ce.ArrowLeft||Ce.a)&&ze.add(xe.copy(Ae).multiplyScalar(-.05)),(Ce.ArrowRight||Ce.d)&&ze.add(xe.copy(Ae).multiplyScalar(.05));const e=qe.copy(y.position).add(ze).add(Se);if(!(e.distanceTo(Te)>4)){for(const t of Oe)if(t.containsPoint(e))return;y.position.add(ze),ee.target.add(ze)}}(),E(),function(){if(!J.visible||!X)return;const e=new n.Pq0;X.getWorldPosition(e),J.position.set(e.x,e.y+1.7,e.z),J.lookAt(y.position)}(),ke.setFromCamera(De,y),_&&$&&H){const e=[];_&&!Be&&e.push(_),$&&!Re&&Be&&We&&e.push($),H&&!V.visible&&e.push(H);const t=ke.intersectObjects(e,!0);document.body.style.cursor=t.length>0?"pointer":"grab"}const t=m.getObjectByName("starSphere");t&&(t.rotation.y+=2e-5),Y.visible&&Y.lookAt(y.position),V.visible&&V.lookAt(y.position),pe.children.forEach((e=>{e.lookAt(y.position)})),fe.children.forEach((e=>{e.userData.lookAtCamera&&e.lookAt(y.position)})),se||ee.update(),p.clear(),p.render(m,y),p.clearDepth(),p.render(h,g),u.render(m,y)}(),window.addEventListener("resize",(()=>{y.aspect=window.innerWidth/window.innerHeight,y.updateProjectionMatrix(),u.setSize(window.innerWidth,window.innerHeight),g.left=-window.innerWidth/2,g.right=window.innerWidth/2,g.top=window.innerHeight/2,g.bottom=-window.innerHeight/2,g.updateProjectionMatrix(),p.setSize(window.innerWidth,window.innerHeight),T&&(B(),L("center"===k))})),window.onerror=function(e,t,o,n,i){console.error("ğŸŒ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒ:",{message:e,source:t,lineno:o,colno:n,error:i})},window.addEventListener("unhandledrejection",(e=>{e.reason&&"AbortError"===e.reason.name&&e.preventDefault()}))}},e=>{e.O(0,[300],(()=>e(e.s=866))),e.O()}]);