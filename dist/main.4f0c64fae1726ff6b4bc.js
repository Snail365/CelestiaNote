"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkcelestianote"] = self["webpackChunkcelestianote"] || []).push([["main"],{

/***/ "./src/script.js":
/*!***********************!*\
  !*** ./src/script.js ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var three__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! three */ \"./node_modules/three/build/three.core.js\");\n/* harmony import */ var three__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! three */ \"./node_modules/three/build/three.module.js\");\n/* harmony import */ var three_examples_jsm_controls_OrbitControls_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! three/examples/jsm/controls/OrbitControls.js */ \"./node_modules/three/examples/jsm/controls/OrbitControls.js\");\n/* harmony import */ var three_examples_jsm_renderers_CSS3DRenderer_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! three/examples/jsm/renderers/CSS3DRenderer.js */ \"./node_modules/three/examples/jsm/renderers/CSS3DRenderer.js\");\n/* harmony import */ var gsap__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! gsap */ \"./node_modules/gsap/index.js\");\n/* harmony import */ var textalive_app_api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! textalive-app-api */ \"./node_modules/textalive-app-api/dist/index.es.js\");\n/* harmony import */ var three_examples_jsm_loaders_GLTFLoader_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! three/examples/jsm/loaders/GLTFLoader.js */ \"./node_modules/three/examples/jsm/loaders/GLTFLoader.js\");\n/* harmony import */ var _styles_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./styles.css */ \"./src/styles.css\");\n\n\n\n\n\n\n\n//import { all, max } from 'three/tsl';\n//import GUI from 'three/examples/jsm/libs/lil-gui.module.min.js';\n\n\n\n\n\n// THREEãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª\nconsole.log('THREE.REVISION:', three__WEBPACK_IMPORTED_MODULE_2__.REVISION);\n\n/* --------------------------\r\n  Renderer ã®è¨­å®š\r\n--------------------------*/\n// WebGL\nconst canvas = document.getElementById('sceneCanvas');\nconst renderer = new three__WEBPACK_IMPORTED_MODULE_3__.WebGLRenderer({\n  canvas,\n  antialias: true,\n  preserveDrawingBuffer: true,\n  alpha: true\n});\nrenderer.setClearColor(0x000000, 0);\nrenderer.autoClear = false; // èƒŒæ™¯ã‚’é€æ˜ã«ã™ã‚‹ãŸã‚ã«è‡ªå‹•ã‚¯ãƒªã‚¢ã‚’ç„¡åŠ¹åŒ–\nrenderer.setSize(window.innerWidth, window.innerHeight);\nrenderer.outputColorSpace = three__WEBPACK_IMPORTED_MODULE_2__.SRGBColorSpace;\ndocument.body.appendChild(renderer.domElement);\n\n// CSS3D Rendererï¼ˆUI ç”¨ï¼‰\nconst cssRenderer = new three_examples_jsm_renderers_CSS3DRenderer_js__WEBPACK_IMPORTED_MODULE_4__.CSS3DRenderer();\ncssRenderer.domElement.classList.add('css3d-renderer');\ncssRenderer.setSize(window.innerWidth, window.innerHeight);\ncssRenderer.domElement.style.position = 'absolute';\ncssRenderer.domElement.style.top = 0;\ndocument.body.appendChild(cssRenderer.domElement);\n\n/* --------------------------\r\n  ã‚·ãƒ¼ãƒ³ãƒ»ã‚«ãƒ¡ãƒ©ãƒ»ãƒ©ã‚¤ãƒˆ ã®è¨­å®š\r\n--------------------------*/\nconst scene = new three__WEBPACK_IMPORTED_MODULE_2__.Scene();\nconst camera = new three__WEBPACK_IMPORTED_MODULE_2__.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);\ncamera.position.set(0, 1.6, 5); // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç›®ç·šé«˜ã•(1.6m)\n\n// const bloomLayer = new THREE.Layers();\n// bloomLayer.set(1); // Layer1ã‚’Bloomå°‚ç”¨ã¨ã—ã¦æ‰±ã†\n\n// const renderScene = new RenderPass(scene, camera);\n\n// const bloomPass = new UnrealBloomPass(\n//   new THREE.Vector2(window.innerWidth, window.innerHeight),\n//   1.5,\n//   0.5,\n//   0.9\n// );\n\n// const bloomComposer = new EffectComposer(renderer);\n// bloomComposer.addPass(renderScene);\n// bloomComposer.addPass(bloomPass);\n\nconst hudScene = new three__WEBPACK_IMPORTED_MODULE_2__.Scene();\nconst hudCamera = new three__WEBPACK_IMPORTED_MODULE_2__.OrthographicCamera(-window.innerWidth / 2, window.innerWidth / 2, window.innerHeight / 2, -window.innerHeight / 2, 0.1, 100);\nhudCamera.position.z = 10;\nconst ambientLight = new three__WEBPACK_IMPORTED_MODULE_2__.AmbientLight(0xffffff, 1.5);\nscene.add(ambientLight);\n\n/* --------------------------\r\n  ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ­ãƒ¼ãƒ‰\r\n--------------------------*/\n\nconst GUILoader = new three__WEBPACK_IMPORTED_MODULE_2__.TextureLoader();\nconst arrowTexture = GUILoader.load('./Model/markup_ARROW.png');\nconst wasdTexture = GUILoader.load('./Model/markup_WASD.png');\nconst MouseTexture = GUILoader.load('./Model/Mouse.png');\nconst MouseArrowTexture = GUILoader.load('./Model/Mouse_Arrow.png');\nconst GUImaterial = new three__WEBPACK_IMPORTED_MODULE_2__.SpriteMaterial({\n  map: arrowTexture,\n  transparent: true,\n  opacity: 1\n});\nconst GUIsprite = new three__WEBPACK_IMPORTED_MODULE_2__.Sprite(GUImaterial);\nGUIsprite.scale.set(80, 60, 1);\nGUIsprite.position.set(-window.innerWidth / 2 + 20, -window.innerHeight / 2 + 20, 1);\nhudScene.add(GUIsprite);\nconst GUIMouseMaterial = new three__WEBPACK_IMPORTED_MODULE_2__.SpriteMaterial({\n  map: MouseTexture,\n  transparent: true,\n  opacity: 1\n});\nconst GUIMouseSprite = new three__WEBPACK_IMPORTED_MODULE_2__.Sprite(GUIMouseMaterial);\nGUIMouseSprite.scale.set(35, 35, 1);\nGUIMouseSprite.position.set(-window.innerWidth / 2 + 130, -window.innerHeight / 2 + 40, 1);\nhudScene.add(GUIMouseSprite);\nconst GUIMouseArrowMaterial = new three__WEBPACK_IMPORTED_MODULE_2__.SpriteMaterial({\n  map: MouseArrowTexture,\n  transparent: true,\n  opacity: 1\n});\nconst GUIMouseArrowSprite = new three__WEBPACK_IMPORTED_MODULE_2__.Sprite(GUIMouseArrowMaterial);\nGUIMouseArrowSprite.scale.set(25, 25, 1);\nGUIMouseArrowSprite.position.set(-window.innerWidth / 2 + 130, -window.innerHeight / 2 + 40, 1);\nhudScene.add(GUIMouseArrowSprite);\nlet showWASD = false;\nsetInterval(() => {\n  GUImaterial.map = showWASD ? wasdTexture : arrowTexture;\n  GUImaterial.needsUpdate = true;\n  showWASD = !showWASD;\n}, 1000);\nfunction updateHudSpritePosition() {\n  GUIsprite.position.set(hudCamera.left + 60, hudCamera.bottom + 50, 1);\n}\nlet mouseDragTimeline = null;\nlet currentMouseDragMode = null; // 'center' ã¾ãŸã¯ 'left'\nfunction startMouseDragLoop(centered = false) {\n  if (mouseDragTimeline) return; // æ—¢ã«å‹•ã„ã¦ã„ãŸã‚‰äºŒé‡èµ·å‹•ã—ãªã„\n  currentMouseDragMode = centered ? 'center' : 'left';\n  let baseX, baseY;\n  if (centered) {\n    baseX = (hudCamera.left + hudCamera.right) / 2;\n    baseY = hudCamera.bottom + 40;\n  } else {\n    baseX = hudCamera.left + 130;\n    baseY = hudCamera.bottom + 40;\n  }\n  GUIMouseSprite.position.set(baseX, baseY, 1);\n  GUIMouseArrowSprite.position.set(baseX + 30, baseY + 10, 1);\n  GUIMouseSprite.material.rotation = 0;\n  GUIMouseArrowSprite.material.rotation = -Math.PI / 16;\n  mouseDragTimeline = gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].timeline({\n    repeat: -1,\n    // ç„¡é™ãƒ«ãƒ¼ãƒ—\n    yoyo: true,\n    // å…ƒã«æˆ»ã‚‹å‹•ã\n    ease: 'circ.inOut',\n    defaults: {\n      duration: 2\n    }\n  });\n  mouseDragTimeline.to(GUIMouseSprite.position, {\n    x: baseX + 30,\n    y: baseY + 10\n  }, 0);\n  mouseDragTimeline.to(GUIMouseSprite.material, {\n    rotation: -Math.PI / 16\n  }, 0);\n  mouseDragTimeline.to(GUIMouseArrowSprite.position, {\n    x: baseX,\n    y: baseY + 5\n  }, 0);\n  mouseDragTimeline.to(GUIMouseArrowSprite.material, {\n    rotation: Math.PI * 3 / 5\n  }, 0);\n}\nstartMouseDragLoop();\nfunction stopMouseDragLoop() {\n  if (mouseDragTimeline) {\n    mouseDragTimeline.kill();\n    mouseDragTimeline = null;\n    GUIMouseSprite.material.rotation = 0;\n    GUIMouseArrowSprite.material.rotaation = -Math.PI / 16;\n    updateHudSpritePosition(); // å…ƒã®ä½ç½®ã«æˆ»ã™\n  }\n}\nlet floor;\nconst floorLoader = new three_examples_jsm_loaders_GLTFLoader_js__WEBPACK_IMPORTED_MODULE_6__.GLTFLoader();\nfloorLoader.load('./Model/FloorModel/floor.glb', function (gltf) {\n  floor = gltf.scene;\n  floor.scale.set(0.25, 0.25, 0.25);\n  floor.position.set(0, 0, 5);\n  scene.add(floor);\n  console.log('âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†');\n}, undefined,\n// ãƒ­ãƒ¼ãƒ‰ä¸­ã®é€²è¡ŒçŠ¶æ³ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯(ãƒ‡ãƒãƒƒã‚°ç”¨)\nfunction (error) {\n  console.error('âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);\n});\nconst starRightPositions = [{\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(2.8, 0, 4.6),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(0, Math.PI / 5, -Math.PI / 5),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.125, 0.125, 0.125)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(-2.9, 0, 4),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(-Math.PI / 4, Math.PI / 9, 0),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.1, 0.1, 0.1)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(1.5, 0, 7),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(0, Math.PI / 3, -Math.PI / 6),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.125, 0.125, 0.125)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(-2.5, 0, 6.5),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(0, -Math.PI / 2, Math.PI / 5),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.11, 0.11, 0.11)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.5, 0, 6),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(-Math.PI / 7, -Math.PI / 4, -Math.PI / 3),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.04, 0.04, 0.04)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.23, 0, 4),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(-Math.PI / 3, -Math.PI / 4, -Math.PI / 3),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.05, 0.05, 0.05)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(2.2, 0, 1.7),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(-Math.PI / 7, -Math.PI / 4, -Math.PI / 3),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.08, 0.08, 0.08)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(-2.2, 0, 2.6),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(-(Math.PI * 2) / 5, -Math.PI / 4, -Math.PI / 3),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.06, 0.06, 0.06)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(-2.5, 0, 7.1),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(-Math.PI / 8, -Math.PI / 3, Math.PI / 3),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.05, 0.05, 0.05)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(-1.2, 0, 6.1),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(-Math.PI / 7, -Math.PI / 4, -Math.PI / 3),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.05, 0.05, 0.05)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(2.2, 0, 7.5),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(-Math.PI / 6, -Math.PI / 7, -Math.PI / 5),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.05, 0.05, 0.05)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(1, 0, 8.5),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(-Math.PI / 7, -Math.PI / 4, Math.PI / 8),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.08, 0.08, 0.08)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(-0.9, 0, 6.3),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(-Math.PI / 7, -Math.PI / 2, Math.PI / 3),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.07, 0.07, 0.07)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(-1, 0, 8),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(0, -Math.PI / 3, Math.PI * 3 / 8),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.17, 0.17, 0.17)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(-0.4, 0, 7.6),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(0, -Math.PI / 3, Math.PI / 4),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.09, 0.09, 0.09)\n}, {\n  position: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(-0.5, 0, 1.5),\n  rotation: new three__WEBPACK_IMPORTED_MODULE_2__.Euler(Math.PI / 4, Math.PI / 7, 0),\n  scale: new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0.1, 0.1, 0.1)\n}];\nconst StarRightLoader = new three_examples_jsm_loaders_GLTFLoader_js__WEBPACK_IMPORTED_MODULE_6__.GLTFLoader();\nStarRightLoader.load('./Model/StarRightModel/StarRight.glb', function (gltf) {\n  let starRight = gltf.scene;\n  starRightPositions.forEach(t => {\n    const starClone = starRight.clone();\n    starClone.position.copy(t.position);\n    starClone.scale.copy(t.scale);\n    scene.add(starClone);\n  });\n});\nlet amp;\nconst ampLoader = new three_examples_jsm_loaders_GLTFLoader_js__WEBPACK_IMPORTED_MODULE_6__.GLTFLoader();\nampLoader.load('./Model/AmpModel/amp.glb', function (gltf) {\n  amp = gltf.scene;\n  amp.scale.set(0.24, 0.24, 0.24);\n  amp.position.set(-3, 0, 5.5);\n  amp.rotation.y = Math.PI * 3 / 5; // 90åº¦å›è»¢\n  scene.add(amp);\n  onModelLoaded(amp);\n  console.log('âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†');\n}, undefined,\n// ãƒ­ãƒ¼ãƒ‰ä¸­ã®é€²è¡ŒçŠ¶æ³ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯(ãƒ‡ãƒãƒƒã‚°ç”¨)\nfunction (error) {\n  console.error('âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);\n});\nlet title;\nconst titleLoader = new three_examples_jsm_loaders_GLTFLoader_js__WEBPACK_IMPORTED_MODULE_6__.GLTFLoader();\ntitleLoader.load('./Model/TitleModel/Title.glb', function (gltf) {\n  title = gltf.scene;\n  title.scale.set(0.5, 0.5, 0.5);\n  title.position.set(2.5, 0, 6);\n  title.rotation.y = -Math.PI * 2 / 3; // 90åº¦å›è»¢\n  scene.add(title);\n  onModelLoaded(title);\n  console.log('âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†');\n}, undefined,\n// ãƒ­ãƒ¼ãƒ‰ä¸­ã®é€²è¡ŒçŠ¶æ³ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯(ãƒ‡ãƒãƒƒã‚°ç”¨)\nfunction (error) {\n  console.error('âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);\n});\nlet mic;\nconst micLoader = new three_examples_jsm_loaders_GLTFLoader_js__WEBPACK_IMPORTED_MODULE_6__.GLTFLoader();\nmicLoader.load('./Model/MicModel/mic.glb', function (gltf) {\n  mic = gltf.scene;\n  mic.scale.set(0.12, 0.11, 0.12);\n  mic.position.set(1.25, 0, 2.5);\n  mic.rotation.y = -Math.PI / 4;\n  scene.add(mic);\n  onModelLoaded(mic);\n  console.log('âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†');\n  showClickHereAboveMic();\n  console.log('mic world position:', mic.position);\n  console.log('clickHereObj position:', clickHereObj.position);\n}, undefined,\n// ãƒ­ãƒ¼ãƒ‰ä¸­ã®é€²è¡ŒçŠ¶æ³ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯(ãƒ‡ãƒãƒƒã‚°ç”¨)\nfunction (error) {\n  console.error('âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);\n});\nconst totalModels = 3; // èª­ã¿è¾¼ã‚€ãƒ¢ãƒ‡ãƒ«æ•°ï¼ˆamp, title, micï¼‰\nlet loadedModels = 0;\nfunction onModelLoaded(model) {\n  collidableObjects.push(model);\n  loadedModels++;\n  if (loadedModels === totalModels) {\n    initCollisionBoxes(); // ã™ã¹ã¦ã®ãƒ¢ãƒ‡ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰ä¸€åº¦ã ã‘å‘¼ã¶\n    console.log('âœ… ã™ã¹ã¦ã®ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº† â†’ è¡çªãƒœãƒƒã‚¯ã‚¹åˆæœŸåŒ–');\n  }\n}\nconst billboardElement = document.getElementById('hologramBillboard');\nconst hologramObject = new three_examples_jsm_renderers_CSS3DRenderer_js__WEBPACK_IMPORTED_MODULE_4__.CSS3DObject(billboardElement);\nbillboardElement.style.display = 'block'; // å¿µã®ãŸã‚ä¸Šæ›¸ã\nhologramObject.scale.set(0.005, 0.005, 0.005);\nhologramObject.visible = false;\nscene.add(hologramObject);\nconst wrapper = document.createElement('div');\nwrapper.id = 'clickHereContainer';\nconst clickHereElement = document.createElement('div');\nclickHereElement.id = 'clickHerePrompt';\nwrapper.appendChild(clickHereElement);\nconst clickHereObj = new three_examples_jsm_renderers_CSS3DRenderer_js__WEBPACK_IMPORTED_MODULE_4__.CSS3DObject(wrapper);\nclickHereElement.style.display = 'block'; // å¿µã®ãŸã‚ä¸Šæ›¸ã\nclickHereObj.scale.set(0.01, 0.01, 0.01);\nclickHereObj.position.set(0, 0, 0);\nscene.add(clickHereObj);\nlet clickHereTarget = null;\nfunction updateClickHere() {\n  if (!clickHereObj.visible || !clickHereTarget) return;\n  const pos = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3();\n  clickHereTarget.getWorldPosition(pos);\n  clickHereObj.position.set(pos.x, pos.y + 1.7, pos.z);\n  clickHereObj.lookAt(camera.position);\n}\nfunction showClickHereAboveTelescope() {\n  clickHereTarget = telescope;\n  clickHereObj.visible = true;\n  clickHereElement.textContent = 'Click Telescope';\n  clickHereElement.style.opacity = 0;\n\n  // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³æ¼”å‡º\n  gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(clickHereElement, {\n    opacity: 1,\n    duration: 0.6,\n    onComplete: () => {\n      telescopeClickable = true; // æœ›é é¡ãŒã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ãªã‚‹\n    }\n  });\n}\nfunction showClickHereAboveMic() {\n  clickHereTarget = mic;\n  clickHereObj.visible = true;\n  clickHereElement.textContent = 'Click Mic';\n  clickHereElement.style.opacity = 0;\n  gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(clickHereElement, {\n    opacity: 1,\n    duration: 0.6\n  });\n}\n\n/* --------------------------\r\n  OrbitControls ã®è¨­å®š\r\n--------------------------*/\n\n// è¦–ç‚¹ã®æ“ä½œã®åˆ¶é™\nconst controls = new three_examples_jsm_controls_OrbitControls_js__WEBPACK_IMPORTED_MODULE_7__.OrbitControls(camera, renderer.domElement);\n// æ“ä½œã‚’ç¦æ­¢ã™ã‚‹\ncontrols.enableDamping = true;\ncontrols.dampingFactor = 0.07;\ncontrols.enabled = true;\ncontrols.enablePan = false;\ncontrols.enableZoom = false;\n//controls.enabled = false;\n\n// åŸç‚¹ã‚’å‘ã\ncontrols.target.set(0, 1.6, 4.9);\n// ã‚­ãƒ£ãƒ—ãƒãƒ£ï¼šã‚·ãƒ¼ãƒ³åˆæœŸåŒ–å®Œäº†å¾Œã«ã‚«ãƒ¡ãƒ©ãƒ»ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®åˆæœŸçŠ¶æ…‹ã‚’ä¿å­˜\nconst initialCameraPosition = camera.position.clone();\nconst initialCameraQuaternion = camera.quaternion.clone();\nconst initialControlsTarget = controls.target.clone();\n// ãƒ‡ãƒãƒƒã‚°ç”¨\nconsole.log(initialControlsTarget);\nconsole.log(camera.position);\nconsole.log('åˆæœŸã®ã‚«ãƒ¡ãƒ©Quaternion:', initialCameraQuaternion);\n\n/* --------------------------\r\n  ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ•ãƒ©ã‚°\r\n--------------------------*/\nlet phase = 'init'; // ãƒ•ã‚§ãƒ¼ã‚ºç®¡ç†(init, fadingOut, smartphoneZoom, telescopeZooming, exploringStars, selectMusic, resettingCamera, viewing)\nlet resettingCamera = false; // ã‚«ãƒ¡ãƒ©ãƒªã‚»ãƒƒãƒˆä¸­ã€animate() ã® controls.update() ã‚’æŠ‘åˆ¶ã™ã‚‹\n\n/* --------------------------\r\n  ã‚¹ãƒãƒ›ãƒ¢ãƒ‡ãƒ«ã¨æœ›é é¡ãƒ¢ãƒ‡ãƒ«ã®ãƒ­ãƒ¼ãƒ‰ã¨ CSS3D UI é…ç½®\r\n--------------------------*/\n\nlet telescope;\nconst telescopeLoader = new three_examples_jsm_loaders_GLTFLoader_js__WEBPACK_IMPORTED_MODULE_6__.GLTFLoader();\ntelescopeLoader.load('./Model/TeleScopeModel/Telescope.glb', function (gltf) {\n  telescope = gltf.scene;\n  telescope.scale.set(0.5, 0.5, 0.5);\n  telescope.position.set(-1.5, 0, 2.5);\n  telescope.rotation.y = Math.PI;\n  scene.add(telescope);\n  collidableObjects.push(telescope);\n  console.log('âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†');\n}, undefined,\n// ãƒ­ãƒ¼ãƒ‰ä¸­ã®é€²è¡ŒçŠ¶æ³ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯(ãƒ‡ãƒãƒƒã‚°ç”¨)\nfunction (error) {\n  console.error('âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);\n});\nfunction fadeOutOverlay(callback) {\n  const overlay = document.getElementById('fadeOverlay');\n  overlay.style.pointerEvents = 'auto';\n  overlay.style.opacity = '1';\n  setTimeout(() => callback && callback(), 1000); // 1ç§’å¾Œã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\n}\nfunction fadeInOverlay(callback) {\n  const overlay = document.getElementById('fadeOverlay');\n  overlay.style.opacity = '0';\n  setTimeout(() => {\n    overlay.style.pointerEvents = 'none';\n    if (callback) callback();\n  }, 1000); // 1ç§’å¾Œã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\n}\n\n// è¦–ç‚¹ã®ç«¯ã‚’æš—ãã™ã‚‹\nfunction showVignette() {\n  document.getElementById('vignetteOverlay').style.opacity = '1';\n}\nfunction hideVignette() {\n  document.getElementById('vignetteOverlay').style.opacity = '0';\n}\n\n// æ¼”å‡ºä¸Šé‚ªé­”ã«ãªã‚‹æœ›é é¡ã‚’éè¡¨ç¤ºã«\nfunction hideModelsBeforeTelescopeScene() {\n  if (telescope) telescope.visible = false;\n}\nfunction showModelsBack() {\n  if (telescope) telescope.visible = true;\n}\n\n// ç´ ã¨ãªã‚‹æ˜Ÿã®çƒä½“ã‚’ç”Ÿæˆã™ã‚‹\nlet starSphere;\nfunction createStarSphere() {\n  // ã™ã§ã«æ˜Ÿç©ºãŒã‚ã‚‹å ´åˆã¯å‰Šé™¤ã—ã¦å†ç”Ÿæˆ\n  if (starSphere) {\n    scene.remove(starSphere);\n  }\n\n  // å¤©çƒã®ã‚¸ã‚ªãƒ¡ãƒˆãƒªï¼ˆå¤§ãã‚ã®çƒä½“ï¼‰\n  const geometry = new three__WEBPACK_IMPORTED_MODULE_2__.SphereGeometry(50, 64, 64);\n\n  // å†…å´ã‹ã‚‰è¦‹ãˆã‚‹ã‚ˆã†ã«ãƒãƒ†ãƒªã‚¢ãƒ«ã®sideã‚’æŒ‡å®š\n  const material = new three__WEBPACK_IMPORTED_MODULE_2__.MeshBasicMaterial({\n    // ã»ã‚“ã®ã‚Šé’ã£ã½ã\n    color: 0x000010,\n    side: three__WEBPACK_IMPORTED_MODULE_2__.BackSide,\n    transparent: true,\n    opacity: 1,\n    depthWrite: false,\n    depthTest: true\n  });\n  starSphere = new three__WEBPACK_IMPORTED_MODULE_2__.Mesh(geometry, material);\n  starSphere.renderOrder = -1;\n  starSphere.frustumCulled = false;\n  scene.add(starSphere);\n\n  // æ˜Ÿã®ç‚¹ç¾¤ï¼ˆPointsï¼‰ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é…ç½®\n  const starCount = 1500;\n  const starGeometry = new three__WEBPACK_IMPORTED_MODULE_2__.BufferGeometry();\n  const positions = [];\n  const colors = [];\n  const color = new three__WEBPACK_IMPORTED_MODULE_2__.Color();\n  for (let i = 0; i < starCount; i++) {\n    const radius = 49.5; // çƒã®å†…å´ã«å°‘ã—å°ã•ã‚ã«é…ç½®\n    const theta = Math.random() * 2 * Math.PI;\n    const phi = Math.acos(2 * Math.random() - 1);\n    const x = radius * Math.sin(phi) * Math.cos(theta);\n    const y = radius * Math.sin(phi) * Math.sin(theta);\n    const z = radius * Math.cos(phi);\n    positions.push(x, y, z);\n    //  è‰²ã‚‚ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºå®š\n    color.setHSL(Math.random(), 1.0, 0.7 + Math.random() * 0.3);\n    colors.push(color.r, color.g, color.b);\n  }\n  // ã‚¸ã‚ªãƒ¡ãƒˆãƒªç”Ÿæˆ\n  starGeometry.setAttribute('position', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(positions, 3));\n  starGeometry.setAttribute('color', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(colors, 3));\n  // ãƒãƒ†ãƒªã‚¢ãƒ«ç”Ÿæˆ\n  const starMaterial = new three__WEBPACK_IMPORTED_MODULE_2__.PointsMaterial({\n    size: 0.2,\n    vertexColors: true,\n    transparent: true,\n    opacity: 0.8\n  });\n  // æ˜Ÿç”Ÿæˆ\n  const stars = new three__WEBPACK_IMPORTED_MODULE_2__.Points(starGeometry, starMaterial);\n  starSphere.add(stars);\n\n  // GSAP ã§æ˜Ÿã®ã¾ãŸãŸãã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ¼”å‡º\n  gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(starMaterial, {\n    opacity: 0.3 + Math.random() * 0.5,\n    duration: 2 + Math.random() * 2,\n    yoyo: true,\n    repeat: -1,\n    ease: 'sine.inOut'\n  });\n  console.log('ğŸŒŒ æ˜Ÿç©ºãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ');\n  stars.name = 'starSphere';\n  return stars;\n}\n// æœ€åˆã‹ã‚‰è¡¨ç¤ºã™ã‚‹ãŸã‚ã«ä¸€åº¦ç”Ÿæˆã—ã¦ãŠã\ncreateStarSphere();\nfunction switchToStarScene() {\n  // æ˜Ÿç©ºã®ç”Ÿæˆ\n  createStarSphere();\n  // ã‚«ãƒ¡ãƒ©ã®è¨­å®šã‚’å›è»¢ã§ãã‚‹ã‚ˆã†ã«å¤‰æ›´\n  configureTelescopeControls();\n}\nfunction configureTelescopeControls() {\n  // æœ›é é¡ã‚’è¦—ã„ã¦ã„ã‚‹ã‚ˆã†ãªè¦–ç‚¹ã®èª¿æ•´\n  controls.enabled = true;\n  controls.enableZoom = false;\n  controls.enablePan = false;\n  controls.enableRotate = true;\n  controls.minPolarAngle = Math.PI * 3 / 7; // ä¸‹æ–¹å‘ã®é™ç•Œ\n  controls.maxPolarAngle = Math.PI * 7 / 8; // ä¸Šæ–¹å‘ã®é™ç•Œ\n\n  // åˆæœŸè¦–ç‚¹ä½ç½®ã¨å‘ãã®èª¿æ•´\n  camera.position.set(telescope.position.x, 2.0, telescope.position.z); // åœ°é¢ã‹ã‚‰å°‘ã—é«˜ã‚\n  controls.target.set(telescope.position.x, 2.0, telescope.position.z - 0.1); // ã‚„ã‚„å‰æ–¹ã«å‘ã‹ã›ã‚‹\n  controls.update();\n}\n\n/* --------------------------\r\n  ã‚«ãƒ¡ãƒ©ãƒªã‚»ãƒƒãƒˆé–¢æ•°ï¼ˆä½ç½®ãƒ»å›è»¢ã‚’åˆæœŸçŠ¶æ…‹ã«åŒæ™‚ã«è£œé–“ï¼‰\r\n--------------------------*/\n\nfunction resetCameraFromTelescope() {\n  if (phase !== 'exploringStars') return;\n  phase = 'resettingCamera';\n  resettingCamera = true;\n  controls.enabled = false;\n  controls.minPolarAngle = Math.PI / 4; // ä¸‹æ–¹å‘ã®é™ç•Œ\n  controls.maxPolarAngle = Math.PI; // ä¸Šæ–¹å‘ã®é™ç•Œ\n\n  camera.position.copy(initialCameraPosition);\n  camera.quaternion.copy(initialCameraQuaternion);\n  const newTarget = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0, 0, -0.01);\n  newTarget.applyQuaternion(camera.quaternion).add(camera.position);\n  controls.target.copy(newTarget);\n  controls.update();\n  resettingCamera = false;\n  console.log('ã‚«ãƒ¡ãƒ©ã®åˆæœŸçŠ¶æ…‹ã¸ã®ãƒªã‚»ãƒƒãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ');\n}\n\n/* --------------------------\r\n  TextAlive Player ã®åˆæœŸåŒ–ã¨éŸ³æ¥½å†ç”Ÿå‡¦ç†\r\n--------------------------*/\nclass SafeTextAlivePlayer {\n  constructor(playerOptions) {\n    this.player = new textalive_app_api__WEBPACK_IMPORTED_MODULE_0__.Player(playerOptions);\n    this.listeners = {};\n    this.videoReady = false;\n    this.songReady = false;\n    this.song = null;\n    this._holoSliderTimeUpdateRegistered = false;\n    this.loopOnEnd = false;\n    this.player.addListener({\n      onAppReady: app => {\n        console.log('TextAlive App Ready');\n        this.appReady = true;\n        this._emit('appready', app);\n        let previousPhraseStartTime = null;\n        let lastPosition = 0;\n        this.player.addListener({\n          onTimeUpdate: position => {\n            if (!this.player.video) return;\n            this._emit('timeupdate', position);\n            const duration = this.player.video.duration || 0;\n            if (!lyricsDisplayEnabled) return;\n            if (this.loopOnEnd) {\n              //console.log('ãƒ«ãƒ¼ãƒ—å†ç”Ÿä¸­');\n              //console.log('   â˜… allLyricData:', allLyricData.map(d => d.startTime));\n\n              allLyricData.forEach((data, idx) => {\n                //console.log(`     â†’ idx=${idx}, returned=${data.returned}, startTime=${data.startTime}`);\n                if (!data.returned && data.startTime > lastPosition && position >= data.startTime) {\n                  console.log(`  â†³ æˆ»ã™æ˜Ÿç¾¤ idx=${idx} phrase=\"${data.text}\" startTime=${data.startTime}`);\n                  // uTime ã‚’ 0â†’1 ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦æ–‡å­—å½¢çŠ¶ã«æˆ»ã™\n                  const newData = displayLyricInStars(data.text, data.startTime, data.center);\n                  allLyricData[idx] = {\n                    ...data,\n                    ...newData,\n                    returned: true\n                  };\n                }\n              });\n            }\n            lastPosition = position;\n            if (phase !== 'exploringStars') return;\n            const phrase = this.player.video.findPhrase(position);\n            if (phrase && phrase.startTime !== previousPhraseStartTime) {\n              previousPhraseStartTime = phrase.startTime;\n              console.log(phrase.text);\n              onNewPhrase(phrase, position);\n            }\n            if (duration && position >= duration - 100) {\n              console.log('æ›²çµ‚äº†æ¤œå‡º');\n              if (phase === 'exploringStars') {\n                fadeOutOverlay(() => {\n                  resetCameraFromTelescope();\n                  showModelsBack();\n                  hideVignette();\n                  phase = 'viewing';\n                  GUIsprite.visible = true;\n                  GUIMouseSprite.visible = true;\n                  GUIMouseSprite.material.opacity = 1.0;\n                  GUIMouseArrowSprite.visible = true;\n                  GUIMouseArrowSprite.material.opacity = 1.0;\n                  stopMouseDragLoop();\n                  startMouseDragLoop();\n                  controls.enabled = true;\n                  fadeInOverlay();\n                  previousPhraseStartTime = null;\n                });\n                this.loopOnEnd = true;\n              }\n            }\n          }\n        });\n      },\n      onVideoReady: async video => {\n        console.log('ğŸ¬ Video Ready', video);\n        this.videoReady = true;\n        const song = this.player.data.song;\n        let retries = 0;\n        while (!song?.name && retries++ < 10) {\n          console.log('æ›²æƒ…å ±ã‚’å¾…æ©Ÿä¸­...', retries);\n          await this._sleep(100);\n        }\n        if (!song?.name) {\n          console.warn('æ›²æƒ…å ±å–å¾—ã«å¤±æ•—');\n        } else {\n          this.songReady = true;\n          this.song = song;\n          console.log('æ›²å:', song.name);\n        }\n        this._emit('videoready', video);\n      },\n      onPlay: () => this._emit('play'),\n      onPause: () => {\n        console.log('â¸ onPause');\n        const position = this.player.timer.position;\n        const duration = this.player.video?.duration || 0;\n\n        // å†ãƒ«ãƒ¼ãƒ—æœŸé–“ãªã‚‰å†ã‚¹ã‚¿ãƒ¼ãƒˆ\n        if (this.loopOnEnd && duration && position >= duration - 200) {\n          console.log('âº çµ‚äº†ç›´å¾Œã®pauseæ¤œå‡º â†’ å†ç”Ÿå†é–‹');\n          allLyricData.forEach(data => data.returned = false);\n\n          //this.loopOnEnd = false; // ãƒ«ãƒ¼ãƒ—ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ\n\n          this.restartCurrentSong();\n          return;\n        }\n        this._emit('pause');\n      },\n      onStop: () => {\n        this._emit('stop');\n      }\n    });\n  }\n\n  // ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ç”¨ classã®ä¸­èº«ã‚’ã„ã˜ã‚‰ãšã«è¿½åŠ ã€‚\n  on(eventName, callback) {\n    if (!this.listeners[eventName]) this.listeners[eventName] = [];\n    this.listeners[eventName].push(callback);\n  }\n  // è¿½åŠ å†…å®¹ã‚’å®Ÿè¡Œ\n  _emit(eventName, data) {\n    (this.listeners[eventName] || []).forEach(cb => cb(data));\n  }\n  _sleep(ms) {\n    return new Promise(res => setTimeout(res, ms));\n  }\n  async loadSong(track) {\n    try {\n      console.log('loadSong é–‹å§‹:', track.url);\n      if (this.player && this.player.isPlaying) {\n        this.player.requestStop();\n      }\n    } catch (e) {\n      console.warn('loadSong: stopå¤±æ•—ï¼ˆç„¡è¦–ï¼‰', e.name, e.message);\n    }\n    this.videoReady = false;\n    this.songReady = false;\n    this.song = null;\n    try {\n      await this.player.createFromSongUrl(track.url, {\n        video: {\n          beatId: track.beatId,\n          chordId: track.chordId,\n          repetitiveSegmentId: track.repetitiveSegmentId,\n          lyricId: track.lyricId,\n          lyricDiffId: track.lyricDiffId\n        }\n      });\n    } catch (e) {\n      console.error('createFromSongUrl: ã‚¨ãƒ©ãƒ¼', e.name, e.message);\n      throw e;\n    }\n    let retries = 0;\n    while (!this.videoReady && retries++ < 10) {\n      await this._sleep(300);\n    }\n    if (!this.videoReady) {\n      throw new Error('videoReady ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ');\n    }\n    return true;\n  }\n  async safePlay(retry = true) {\n    try {\n      if (!this.player.mediaElement) {\n        console.warn('mediaElement ãŒæœªå®šç¾©ã§ã™');\n        return;\n      }\n      console.log('safePlay å®Ÿè¡Œé–‹å§‹');\n      if (this.player.mediaElement.paused) {\n        try {\n          this.player.requestPlay();\n        } catch (err) {\n          if (err.name === 'AbortError') {\n            console.warn('AbortError: play() ãŒä¸­æ–­ã•ã‚Œã¾ã—ãŸã€‚pause() ãŒå‰²ã‚Šè¾¼ã‚“ã å¯èƒ½æ€§');\n          } else {\n            throw err; // äºˆæœŸã—ãªã„ä¾‹å¤–ã¯å†ã‚¹ãƒ­ãƒ¼\n          }\n        }\n      }\n      await this._sleep(200);\n      if (!this.player.isPlaying && retry) {\n        console.warn('å†è©¦è¡Œ: requestPlay');\n        try {\n          this.player.requestPlay();\n        } catch (e) {\n          if (e.name === 'AbortError') {\n            console.warn('å†è©¦è¡Œã§ã‚‚ AbortError:', e.message);\n          } else {\n            console.warn('å†è©¦è¡Œã‚‚ä¸­æ–­:', e);\n          }\n        }\n      }\n    } catch (err) {\n      console.error('requestPlay å®Œå…¨å¤±æ•—', err);\n    }\n  }\n  async safePause() {\n    try {\n      this.player.requestPause();\n    } catch (e) {\n      console.error('requestPause ã‚¨ãƒ©ãƒ¼', e);\n    }\n  }\n  async safeStop() {\n    try {\n      this.player.requestStop();\n    } catch (e) {\n      console.error('requestStop ã‚¨ãƒ©ãƒ¼', e);\n    }\n  }\n  getPlayer() {\n    return this.player;\n  }\n  getCurrentSong() {\n    return this.song;\n  }\n  get isPlaying() {\n    return this.player.isPlaying;\n  }\n  restartCurrentSong() {\n    if (this.player && this.player.video) {\n      this.player.requestMediaSeek(0); // å†ç”Ÿä½ç½®ã‚’0ç§’ã«\n      setTimeout(() => {\n        this.safePlay();\n      }, 500);\n    }\n  }\n}\nconst lyricsGroup = new three__WEBPACK_IMPORTED_MODULE_2__.Group();\nlyricsGroup.position.set(0, 0, 0);\nlyricsGroup.rotation.set(0, 0, 0);\nlyricsGroup.scale.set(1, 1, 1);\nscene.add(lyricsGroup);\nconst allLyricData = [];\nfunction onNewPhrase(phrase, position) {\n  console.log('â–¶ onNewPhrase:', phrase.text, 'at', position);\n  const data = displayLyricInStars(phrase.text, position);\n  spawnExplosionStars(data.center);\n  spawnNebulaAt(data.center, 4);\n  data.returned = false;\n  // å¾Œã§æˆ»ã™ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜\n  allLyricData.push(data);\n  //ã€€ãƒ‡ãƒãƒƒã‚°\n  console.log('   â†’ allLyricData length:', allLyricData.length);\n}\n\n// ======= ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ç¾¤ =======\n/**\r\n * æ­Œè©ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ³ãƒã‚¹ã«æç”»ã—ã€\r\n * æ˜ã‚‹ã„ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é…åˆ—ã‚’è¿”ã™\r\n */\nfunction sampleTextAlphaIndices(text, {\n  canvasSize = 1024,\n  xStep = 2,\n  yStep = 1,\n  threshold = 128,\n  font = 'bold 48px \"Noto Sans JP\", Meiryo, sans-serif'\n} = {}) {\n  const canvas = document.createElement('canvas');\n  canvas.width = canvas.height = canvasSize;\n  const ctx = canvas.getContext('2d');\n  ctx.clearRect(0, 0, canvasSize, canvasSize);\n  ctx.fillStyle = 'white';\n  ctx.font = font;\n  ctx.textAlign = 'center';\n  ctx.textBaseline = 'middle';\n  ctx.fillText(text, canvasSize / 2, canvasSize / 2);\n  const data = ctx.getImageData(0, 0, canvasSize, canvasSize).data;\n  const coords = [];\n  for (let y = 0; y < canvasSize; y += yStep) {\n    for (let x = 0; x < canvasSize; x += xStep) {\n      if (data[(y * canvasSize + x) * 4 + 3] > threshold) {\n        coords.push({\n          x,\n          y\n        });\n      }\n    }\n  }\n  return {\n    coords,\n    canvasSize\n  };\n}\n\n/**\r\n * ç”»é¢å†…ãƒ©ãƒ³ãƒ€ãƒ ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’åŠ ãˆãŸãƒ¯ãƒ¼ãƒ«ãƒ‰åº§æ¨™ã«ãƒãƒƒãƒ”ãƒ³ã‚°\r\n */\nfunction mapToWorldPositions(coords, {\n  canvasSize,\n  scale = 120\n}) {\n  return coords.map(({\n    x,\n    y\n  }) => {\n    const nx = (x / canvasSize - 0.5) * scale;\n    const ny = (0.5 - y / canvasSize) * scale;\n    const nz = (Math.random() - 0.5) * 1.5;\n    return new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(nx, ny, nz);\n  });\n}\n\n/**\r\n * BufferGeometryï¼ShaderMaterial ã‚’ã¾ã¨ã‚ã¦ä½œã‚‹\r\n */\nfunction createLyricPoints(worldPositions, {\n  sizeRange = [0.1, 0.3],\n  colorHueRange = [0, 1],\n  keepIndices = []\n} = {}) {\n  const count = worldPositions.length;\n  const posArray = [];\n  const colorArray = [];\n  const sizeArray = [];\n  const keepArray = [];\n  for (let i = 0; i < count; i++) {\n    const offset = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3((Math.random() - 0.5) * 5, (Math.random() - 0.5) * 5, (Math.random() - 0.5) * 5);\n    const initPos = worldPositions[i].clone().add(offset);\n    posArray.push(...initPos.toArray());\n    const hue = Math.random() * (colorHueRange[1] - colorHueRange[0]) + colorHueRange[0];\n    const col = new three__WEBPACK_IMPORTED_MODULE_2__.Color().setHSL(hue, 1, 0.7);\n    colorArray.push(col.r, col.g, col.b);\n    const isKeep = keepIndices.includes(i);\n    const baseSize = 2.5 * Math.random() * (sizeRange[1] - sizeRange[0]) + sizeRange[0];\n    const enlargedSize = isKeep ? baseSize * 2 : baseSize; // æ˜Ÿåº§ç”¨ã¯2å€\n    sizeArray.push(enlargedSize);\n    keepArray.push(isKeep ? 1.0 : 0.0);\n  }\n  const geo = new three__WEBPACK_IMPORTED_MODULE_2__.BufferGeometry();\n  geo.setAttribute('position', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(posArray, 3));\n  geo.setAttribute('aColor', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(colorArray, 3));\n  geo.setAttribute('aSize', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(sizeArray, 1));\n  geo.setAttribute('aKeep', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(keepArray, 1));\n  const mat = new three__WEBPACK_IMPORTED_MODULE_2__.ShaderMaterial({\n    transparent: true,\n    blending: three__WEBPACK_IMPORTED_MODULE_2__.AdditiveBlending,\n    depthTest: false,\n    depthWrite: false,\n    uniforms: {\n      uTime: {\n        value: 0\n      },\n      uOpacity: {\n        value: 0\n      }\n    },\n    vertexShader: /* glsl */`\n      attribute float aSize;\n      attribute vec3 aColor;\n      attribute float aKeep;\n      varying vec3 vColor;\n      varying float vKeep;\n      uniform float uTime;\n      void main(){\n        vColor = aColor;\n        vKeep = aKeep;\n        vec4 mv = modelViewMatrix * vec4(position,1.0);\n        gl_PointSize = aSize * (300.0 / -mv.z) * clamp(uTime,0.0,1.0);\n        gl_Position = projectionMatrix * mv;\n      }`,\n    fragmentShader: /* glsl */`\n      varying vec3 vColor;\n      varying float vKeep;\n      uniform float uOpacity;\n      void main(){\n        float d = distance(gl_PointCoord, vec2(0.5));\n        if(d>0.5) discard;\n        float alpha = mix(uOpacity, 1.0, vKeep);\n        gl_FragColor = vec4(vColor, alpha);\n      }`\n  });\n  const points = new three__WEBPACK_IMPORTED_MODULE_2__.Points(geo, mat);\n\n  // ç²’å­ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦å…ƒã®ä½ç½®ã«é›†ã‚ã‚‹\n  const posAttr = geo.getAttribute('position');\n  worldPositions.forEach((target, i) => {\n    const from = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(posAttr.getX(i), posAttr.getY(i), posAttr.getZ(i));\n    gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(from, {\n      x: target.x,\n      y: target.y,\n      z: target.z,\n      duration: 1.2,\n      delay: Math.random() * 0.3,\n      ease: 'power2.out',\n      onUpdate: () => {\n        posAttr.setXYZ(i, from.x, from.y, from.z);\n        posAttr.needsUpdate = true;\n      }\n    });\n  });\n  return points;\n}\n\n// ======= ãƒªãƒ•ã‚¡ã‚¯ã‚¿å¾Œã® displayLyricInStars =======\nfunction displayLyricInStars(text, startTime, reusedCenter = null) {\n  // 1) ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰æœ‰åŠ¹ãªãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã‚’å–å¾—\n  const {\n    coords,\n    canvasSize\n  } = sampleTextAlphaIndices(text, {\n    canvasSize: 1024,\n    xStep: 2,\n    yStep: 1,\n    threshold: 128,\n    font: 'bold 48px \"Noto Sans JP\", Meiryo'\n  });\n\n  // 2) ã‚­ãƒ£ãƒ³ãƒã‚¹åº§æ¨™ â†’ ãƒ¯ãƒ¼ãƒ«ãƒ‰åº§æ¨™ã¸ãƒãƒƒãƒ”ãƒ³ã‚°\n  const worldPositions = mapToWorldPositions(coords, {\n    canvasSize,\n    scale: 120\n  });\n\n  // 3) æ˜Ÿåº§ã«æ®‹ã™ç²’å­ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«é¸å‡º\n  const total = worldPositions.length;\n  const keepCount = Math.min(6, total); // æ˜Ÿåº§ã¨ã—ã¦æ®‹ã™æ•°\n  const keepIndices = [];\n  while (keepIndices.length < keepCount) {\n    const i = Math.floor(Math.random() * total);\n    if (!keepIndices.includes(i)) keepIndices.push(i);\n  }\n\n  // 4) Points ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ\n  const points = createLyricPoints(worldPositions, {\n    sizeRange: [0.1, 0.25],\n    colorHueRange: [0, 1],\n    keepIndices\n  });\n\n  // ã‚«ãƒ¡ãƒ©ã®å‰æ–¹ãƒ»å³æ–¹å‘ãƒ»ä¸Šæ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«ã‚’å–å¾—\n  const forward = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3();\n  const right = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3();\n  const up = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3();\n  camera.getWorldDirection(forward); // å‰æ–¹å‘\n  right.crossVectors(forward, camera.up).normalize(); // å³æ–¹å‘\n  up.copy(camera.up).normalize(); // ä¸Šæ–¹å‘\n\n  // ä¸­å¿ƒç‚¹ï¼ˆã‚«ãƒ¡ãƒ©ã‹ã‚‰å‰æ–¹50ã€œ70ã®ç¯„å›²ã§å°‘ã—å³å¯„ã‚Šï¼‰\n  const distance = 45 + Math.random() * 20; // 45ã€œ65\n  const rightBias = 10 + Math.random() * 20; // å³æ–¹å‘ã«10ã€œ30ã®ãƒã‚¤ã‚¢ã‚¹\n  const upOffset = (Math.random() - 0.5) * 30; // ä¸Šä¸‹ãƒ©ãƒ³ãƒ€ãƒ  Â±15\n  const forwardOffset = (Math.random() - 0.5) * 20; // å‰å¾Œã«ã‚‚å°‘ã—æ•£ã‚‰ã™\n\n  const baseCenter = camera.position.clone().add(forward.clone().multiplyScalar(distance)).add(right.clone().multiplyScalar(rightBias)).add(up.clone().multiplyScalar(upOffset)).add(forward.clone().multiplyScalar(forwardOffset));\n  const center = reusedCenter || baseCenter;\n  points.position.copy(center);\n  lyricsGroup.add(points);\n\n  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹\n  const mat = points.material;\n  gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(mat.uniforms.uTime, {\n    value: 1,\n    duration: 1.0,\n    ease: 'power2.out'\n  });\n  gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(mat.uniforms.uOpacity, {\n    value: 1.0,\n    duration: 0.8,\n    ease: 'power2.out',\n    onComplete: () => {\n      // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆæ™‚ã«æ•£ã‚‰ã™å‡¦ç†\n      const posAttr = points.geometry.getAttribute('position');\n      const scatterTargets = [];\n      for (let i = 0; i < posAttr.count; i++) {\n        const from = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3().fromBufferAttribute(posAttr, i);\n        if (keepIndices.includes(i)) {\n          scatterTargets.push(null); // æ˜Ÿåº§ç”¨ã¯å›ºå®š\n        } else {\n          const dir = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(Math.random() - 0.5, Math.random() - 0.5, Math.random() - 0.5).normalize().multiplyScalar(2 + Math.random() * 4);\n          scatterTargets.push(from.clone().add(dir));\n        }\n      }\n      scatterTargets.forEach((target, i) => {\n        if (!target) return;\n        const current = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3().fromBufferAttribute(posAttr, i);\n        gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(current, {\n          x: target.x,\n          y: target.y,\n          z: target.z,\n          delay: 8.0,\n          duration: 2.0,\n          ease: 'power2.out',\n          onUpdate: () => {\n            posAttr.setXYZ(i, current.x, current.y, current.z);\n            posAttr.needsUpdate = true;\n          }\n        });\n      });\n      gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(mat.uniforms.uOpacity, {\n        value: 0.0,\n        delay: 8.0,\n        duration: 1.0,\n        ease: 'power2.out',\n        onComplete: () => {\n          // æ˜Ÿåº§åŒ–\n          createConstellation({\n            text,\n            startTime,\n            center,\n            points,\n            keepIndices\n          });\n        }\n      });\n    }\n  });\n  return {\n    text,\n    startTime,\n    center,\n    points\n  };\n}\n\n/**\r\n * æ­Œè©ã®æ˜Ÿã‚’æ˜Ÿåº§åŒ–ã—ã¦ Scene ã«è¿½åŠ ã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™\r\n */\nfunction createConstellation({\n  points,\n  keepIndices,\n  center,\n  text,\n  startTime\n}) {\n  const posAttr = points.geometry.getAttribute('position');\n\n  // center ã‚’åŸºæº–ã«ã—ãŸãƒ­ãƒ¼ã‚«ãƒ«æ‹¡æ•£å…ˆã‚’è¨ˆç®—\n  const localCenter = points.worldToLocal(center.clone()); // â†ä¸­å¿ƒã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«å¤‰æ›\n  const targetPositions = keepIndices.map(() => {\n    const offset = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3((Math.random() - 0.5) * 13,\n    // Xæ–¹å‘ Â±10\n    (Math.random() - 0.5) * 13,\n    // Yæ–¹å‘ Â±10\n    (Math.random() - 0.5) * 13 // Zæ–¹å‘ Â±10\n    );\n    return localCenter.clone().add(offset);\n  });\n  const worldStars = [];\n\n  // å„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®é ‚ç‚¹ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n  keepIndices.forEach((i, idx) => {\n    const from = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(posAttr.getX(i), posAttr.getY(i), posAttr.getZ(i));\n    const to = targetPositions[idx];\n    gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(from, {\n      x: to.x,\n      y: to.y,\n      z: to.z,\n      duration: 2.0,\n      ease: 'power2.out',\n      onUpdate: () => {\n        posAttr.setXYZ(i, from.x, from.y, from.z);\n        posAttr.needsUpdate = true;\n      },\n      onComplete: () => {\n        // æœ€å¾Œã®1ã¤ãŒçµ‚ã‚ã£ãŸå¾Œã«ç·šã‚’å¼•ã\n        if (idx === keepIndices.length - 1) {\n          keepIndices.forEach(i => {\n            const local = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(posAttr.getX(i), posAttr.getY(i), posAttr.getZ(i));\n            worldStars.push(points.localToWorld(local.clone()));\n          });\n          const lines = createConstellationLines(worldStars, 0.7);\n          scene.add(lines);\n          const data = allLyricData.find(d => d.text === text && d.startTime === startTime);\n          if (data) {\n            data.keepIndices = keepIndices;\n            data.constellationLines = lines;\n          }\n        }\n      }\n    });\n  });\n}\n\n// æ˜Ÿåº§ã®ç·šã‚’ç”Ÿæˆ\nfunction createConstellationLines(positions, offset = 0.7) {\n  const linePoints = [];\n  for (let i = 0; i < positions.length - 1; i++) {\n    const a = positions[i];\n    const b = positions[i + 1];\n    const dir = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3().subVectors(b, a).normalize();\n    const start = a.clone().add(dir.clone().multiplyScalar(offset));\n    const end = b.clone().add(dir.clone().multiplyScalar(-offset));\n    linePoints.push(start, end);\n  }\n  const geometry = new three__WEBPACK_IMPORTED_MODULE_2__.BufferGeometry().setFromPoints(linePoints);\n  const material = new three__WEBPACK_IMPORTED_MODULE_2__.LineBasicMaterial({\n    color: 0x88ccff,\n    transparent: true,\n    opacity: 0.7,\n    depthTest: false,\n    depthWrite: false,\n    blending: three__WEBPACK_IMPORTED_MODULE_2__.AdditiveBlending\n  });\n  return new three__WEBPACK_IMPORTED_MODULE_2__.LineSegments(geometry, material);\n}\n\n// function highlightConstellation(data) {\n//   if (!data || !data.points || !data.keepIndices) return;\n\n//   const geo = data.points.geometry;\n//   const aSize = geo.getAttribute('aSize');\n\n//   data.points.layers.enable(1);\n\n//   // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šï¼ˆæ‹¡å¤§â†’ç¸®å°ã‚’ç¹°ã‚Šè¿”ã™ï¼‰\n//   data.keepIndices.forEach((i) => {\n//     const baseSize = aSize.getX(i);\n//     const temp = { value: baseSize };\n\n//     gsap.to(temp, {\n//       value: baseSize * 1.5,\n//       duration: 0.6,\n//       yoyo: true,\n//       repeat: 3,\n//       ease: 'sine.inOut',\n//       onUpdate: () => {\n//         aSize.setX(i, temp.value);\n//         aSize.needsUpdate = true;\n//       },\n//     });\n//   });\n\n//   // ç·šã‚‚æ˜æ»…ã•ã›ã‚‹ï¼ˆç·šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã™ã‚‹å ´åˆï¼‰\n//   if (data.constellationLines) {\n//     const lineMat = data.constellationLines.material;\n//     gsap.fromTo(\n//       lineMat,\n//       {\n//         opacity: 1.0,\n//       },\n//       {\n//         opacity: 0.0,\n//         duration: 0.6,\n//         yoyo: true,\n//         repeat: 3,\n//         ease: 'sine.inOut',\n//         onComplete: () => {\n//           lineMat.opacity = 1.0;\n//           data.points.layers.disable(1);\n//         },\n//       }\n//     );\n//   }\n// }\n\nconst persistentStarsGroup = new three__WEBPACK_IMPORTED_MODULE_2__.Group();\nscene.add(persistentStarsGroup);\nfunction spawnExplosionStars(center, count = 25) {\n  console.log('ğŸ’¥ spawnExplosionStars called at', center);\n  const positions = [];\n  const targets = [];\n  const colors = [];\n  const sizes = [];\n  const color = new three__WEBPACK_IMPORTED_MODULE_2__.Color();\n  for (let i = 0; i < count; i++) {\n    const spread = 30;\n    const offset = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3((Math.random() - 0.5) * spread, (Math.random() - 0.5) * spread, (Math.random() - 0.5) * spread);\n    const startPos = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3().copy(center); // æ‹¡æ•£ã‚¹ã‚¿ãƒ¼ãƒˆä½ç½®\n    const targetPos = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3().copy(center).add(offset);\n    positions.push(startPos.x, startPos.y, startPos.z);\n    targets.push(targetPos.x, targetPos.y, targetPos.z);\n    color.setHSL(Math.random(), 0.6, 0.6 + Math.random() * 0.3);\n    colors.push(color.r, color.g, color.b);\n    sizes.push(0.4 + Math.random() * 0.6);\n  }\n  const geometry = new three__WEBPACK_IMPORTED_MODULE_2__.BufferGeometry();\n  geometry.setAttribute('position', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(positions, 3));\n  geometry.setAttribute('aTarget', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(targets, 3));\n  geometry.setAttribute('aColor', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(colors, 3));\n  geometry.setAttribute('aSize', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(sizes, 1));\n  const material = new three__WEBPACK_IMPORTED_MODULE_2__.ShaderMaterial({\n    transparent: true,\n    depthTest: true,\n    depthWrite: false,\n    blending: three__WEBPACK_IMPORTED_MODULE_2__.AdditiveBlending,\n    vertexColors: true,\n    uniforms: {\n      uTime: {\n        value: 0.0\n      },\n      uFlicker: {\n        value: 0.0\n      },\n      uOpacity: {\n        value: 1.0\n      }\n    },\n    vertexShader: `\n      attribute vec3 aTarget;\n      attribute vec3 aColor;\n      attribute float aSize;\n      varying vec3 vColor;\n      uniform float uTime;\n      uniform float uFlicker;\n      void main() {\n        vec3 newPos = mix(position, aTarget, uTime);\n        vec4 mvPosition = modelViewMatrix * vec4(newPos, 1.0);\n        gl_Position = projectionMatrix * mvPosition;\n        float flick = 0.1 + 0.3 * sin(uFlicker + aSize * 5.0);\n        float pointSize = aSize * (300.0 / abs(mvPosition.z)) * flick;\n        gl_PointSize = floor(pointSize) + 0.5;\n        vColor = aColor;\n      }\n    `,\n    fragmentShader: `\n      varying vec3 vColor;\n      uniform float uOpacity;\n      void main() {\n        float d = distance(gl_PointCoord, vec2(0.5));\n        float alpha = smoothstep(0.5, 0.4, d) * uOpacity;\n        //if (alpha < 0.01) discard;\n        gl_FragColor = vec4(vColor, alpha);\n      }\n    `\n  });\n  const points = new three__WEBPACK_IMPORTED_MODULE_2__.Points(geometry, material);\n  points.renderOrder = 888;\n  points.frustumCulled = false;\n  persistentStarsGroup.add(points);\n\n  // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n  gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(material.uniforms.uTime, {\n    value: 1.0,\n    duration: 1.0,\n    ease: 'power2.out'\n  });\n  gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(material.uniforms.uFlicker, {\n    value: Math.PI * 2,\n    duration: 2.0,\n    repeat: -1,\n    ease: 'linear'\n  });\n  //console.log(\"geometry count\", geometry.attributes.position.count);\n  // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã›ãšæ°¸ç¶šçš„ã«æ®‹ã™ï¼ˆå¿…è¦ã«å¿œã˜ã¦ opacity ã‚‚èª¿æ•´å¯èƒ½ï¼‰\n}\n\n// astro.pngã‚’å¤šãé…ç½®ã—ã€æ˜Ÿé›²ãŒå‡ºã‚‹ç¢ºç‡ã‚’ä¸Šã’ã¦ãŠãã€‚\nconst textures = ['./texture/astro1.png', './texture/astro2.png', './texture/astro3.png', './texture/astro1.png', './texture/astro2.png', './texture/astro3.png', './texture/astro1.png', './texture/astro2.png', './texture/astro3.png'];\nconst nebulaTextures = [];\nconst textureLoader = new three__WEBPACK_IMPORTED_MODULE_2__.TextureLoader();\n// ãƒ—ãƒªãƒ­ãƒ¼ãƒ‰\ntextures.forEach(url => {\n  textureLoader.load(url, tex => nebulaTextures.push(tex), undefined, err => console.error('Nebula load error', url, err));\n});\n// åŸºæœ¬æ˜Ÿé›²ã‚’ç”Ÿæˆã™ã‚‹ãŒã€ã‚¤ãƒ©ã‚¹ãƒˆãªã©ã‚‚ãƒ©ãƒ³ãƒ€ãƒ ã§è¡¨ç¤ºã™ã‚‹ã€‚\nfunction spawnNebulaAt(center, count) {\n  if (nebulaTextures.length === 0) {\n    console.warn('ğŸŒŒ nebula textures not yet loaded');\n    return;\n  }\n  for (let i = 0; i < count; i++) {\n    // è¡¨ç¤ºã™ã‚‹ç”»åƒã‚’ãƒ©ãƒ³ãƒ€ãƒ ã§æ±ºå®šã€‚\n    const texture = nebulaTextures[Math.floor(Math.random() * nebulaTextures.length)];\n    const geometry = new three__WEBPACK_IMPORTED_MODULE_2__.PlaneGeometry(1, 1);\n    const material = new three__WEBPACK_IMPORTED_MODULE_2__.MeshBasicMaterial({\n      map: texture,\n      transparent: true,\n      opacity: 0,\n      depthWrite: false,\n      depthTest: true,\n      blending: three__WEBPACK_IMPORTED_MODULE_2__.AdditiveBlending,\n      side: three__WEBPACK_IMPORTED_MODULE_2__.DoubleSide\n    });\n    const plane = new three__WEBPACK_IMPORTED_MODULE_2__.Mesh(geometry, material);\n    plane.renderOrder = 777;\n    plane.frustumCulled = false;\n    const spread = 30;\n    const offset = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3((Math.random() - 0.5) * spread, (Math.random() - 0.5) * spread, (Math.random() - 0.5) * spread);\n    plane.position.copy(center).add(offset);\n    const size = 8 + Math.random() * 6;\n    plane.scale.set(size, size, 1);\n    plane.userData.lookAtCamera = true;\n    persistentStarsGroup.add(plane);\n    gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(material, {\n      opacity: 0.1 + Math.random() * 0.3,\n      duration: 1.5,\n      ease: 'power2.out'\n    });\n    gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(plane.scale, {\n      x: size + 8,\n      y: size + 8,\n      duration: 3.0,\n      ease: 'sine.inOut'\n    });\n  }\n}\nfunction startShootingStars() {\n  setInterval(() => {\n    //if (phase === 'exploringStars') {\n    const count = Math.random() < 0.3 ? 2 : 1;\n    for (let i = 0; i < count; i++) {\n      spawnShootingStar();\n    }\n    //}\n  }, 2000 + Math.random() * 10000);\n}\nfunction spawnShootingStar() {\n  const particleCount = 40;\n  const geometry = new three__WEBPACK_IMPORTED_MODULE_2__.BufferGeometry();\n  const positions = [];\n  const sizes = [];\n  const colors = [];\n  const distance = 30;\n  const spreadX = 20;\n  const spreadY = 10;\n  const direction = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3();\n  camera.getWorldDirection(direction);\n  const basePosition = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3().copy(camera.position).add(direction.multiplyScalar(distance));\n  const offsetX = (Math.random() - 0.5) * spreadX * 2;\n  const offsetY = (Math.random() - 0.5) * spreadY * 2;\n  const offsetZ = (Math.random() - 0.5) * 0.3;\n  const start = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(basePosition.x + offsetX, basePosition.y + offsetY, basePosition.z + offsetZ);\n  const end = start.clone().add(new three__WEBPACK_IMPORTED_MODULE_2__.Vector3((Math.random() - 0.5) * 20.0, Math.random() * -4.0, Math.random() * -2.0));\n  const colorStart = new three__WEBPACK_IMPORTED_MODULE_2__.Color(0xffffff);\n  const colorEnd = new three__WEBPACK_IMPORTED_MODULE_2__.Color(0xbbeeff);\n  for (let i = 0; i < particleCount; i++) {\n    const ratio = i / (particleCount - 1);\n    const point = start.clone().lerp(end, ratio);\n    positions.push(point.x, point.y, point.z);\n    sizes.push(0.1 + ratio * 0.3); // * x.xã§æ‹¡å¤§ã‚µã‚¤ã‚º\n\n    const color = colorStart.clone().lerp(colorEnd, ratio);\n    colors.push(color.r, color.g, color.b);\n  }\n  geometry.setAttribute('position', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(positions, 3));\n  geometry.setAttribute('aSize', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(sizes, 1));\n  geometry.setAttribute('aColor', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(colors, 3));\n  const vertexShader = `\n  precision mediump float;\n  attribute float aSize;\n  attribute vec3 aColor;\n  varying vec3 vColor;\n  void main() {\n    vColor = aColor;\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_PointSize = aSize * (300.0 / -mvPosition.z); // è¦–è·é›¢ã«å¿œã˜ã¦èª¿æ•´\n    gl_Position = projectionMatrix * mvPosition;\n  }\n`;\n  const fragmentShader = `\n  precision mediump float;\n  uniform float uOpacity;\n  varying vec3 vColor;\n  void main() {\n    float d = length(gl_PointCoord - vec2(0.5));\n    if (d > 0.5) discard; // ä¸¸ã„ç²’ã«\n    gl_FragColor = vec4(vColor, uOpacity);\n  }\n`;\n  const material = new three__WEBPACK_IMPORTED_MODULE_2__.ShaderMaterial({\n    uniforms: {\n      uOpacity: {\n        value: 1.0\n      }\n    },\n    vertexShader,\n    fragmentShader,\n    vertexColors: true,\n    transparent: true,\n    depthWrite: false\n  });\n  const points = new three__WEBPACK_IMPORTED_MODULE_2__.Points(geometry, material);\n  scene.add(points);\n  createAfterglowParticles(end);\n  gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(material.uniforms.uOpacity, {\n    value: 0,\n    duration: 1.2,\n    ease: 'power1.out',\n    onComplete: () => {\n      scene.remove(points);\n      geometry.dispose();\n      material.dispose();\n    }\n  });\n}\nfunction createAfterglowParticles(position) {\n  const particleCount = 40;\n  const positions = [];\n  for (let i = 0; i < particleCount; i++) {\n    const offset = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3((Math.random() - 0.5) * 2, (Math.random() - 0.5) * 2, (Math.random() - 0.5) * 2);\n    const pos = position.clone().add(offset);\n    positions.push(pos.x, pos.y, pos.z);\n  }\n  const geometry = new three__WEBPACK_IMPORTED_MODULE_2__.BufferGeometry();\n  geometry.setAttribute('position', new three__WEBPACK_IMPORTED_MODULE_2__.Float32BufferAttribute(positions, 3));\n  const material = new three__WEBPACK_IMPORTED_MODULE_2__.PointsMaterial({\n    color: 0x88ccff,\n    size: 0.07,\n    transparent: true,\n    opacity: 1,\n    depthWrite: false,\n    blending: three__WEBPACK_IMPORTED_MODULE_2__.NormalBlending\n  });\n  const particles = new three__WEBPACK_IMPORTED_MODULE_2__.Points(geometry, material);\n  scene.add(particles);\n\n  // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆï¼†å‰Šé™¤\n  gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(material, {\n    opacity: 0,\n    duration: 2.0,\n    ease: 'power1.out',\n    onComplete: () => {\n      scene.remove(particles);\n      geometry.dispose();\n      material.dispose();\n    }\n  });\n}\n\n// å†åˆ©ç”¨ç”¨ãƒ™ã‚¯ãƒˆãƒ«ã‚’é–¢æ•°å¤–ã§å®šç¾©\n// const tempBox = new THREE.Box3();\nconst tempVec1 = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3();\nconst tempVec2 = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3();\nconst direction = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3();\nconst right = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3();\nconst offset = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0, -1.6, 0);\nconst moveVector = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3();\nconst moveSpeed = 0.05;\nconst keysPressed = {};\nconst collidableObjects = []; // è¡çªåˆ¤å®šå¯¾è±¡ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\nconst collidableBoxes = []; // â†‘ã‹ã‚‰ç”Ÿæˆã•ã‚ŒãŸBox3\nconst collisionCenter = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0, 0, 5);\nconst collisionRadius = 4;\n\n// è¡çªãƒœãƒƒã‚¯ã‚¹åˆæœŸåŒ–é–¢æ•°ï¼ˆãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰å¾Œãªã©ã«å‘¼ã¶ï¼‰\nfunction initCollisionBoxes() {\n  collidableBoxes.length = 0;\n  for (const obj of collidableObjects) {\n    if (!obj) continue;\n    const box = new three__WEBPACK_IMPORTED_MODULE_2__.Box3().setFromObject(obj);\n    collidableBoxes.push(box);\n  }\n}\nwindow.addEventListener('keydown', e => keysPressed[e.key] = true);\nwindow.addEventListener('keyup', e => keysPressed[e.key] = false);\nfunction updateCameraMovement() {\n  // å‘ãè¨ˆç®—\n  camera.getWorldDirection(direction);\n  direction.y = 0;\n  direction.normalize();\n  right.crossVectors(direction, camera.up).normalize();\n  moveVector.set(0, 0, 0);\n  if (keysPressed['ArrowUp'] || keysPressed['w']) {\n    moveVector.add(tempVec1.copy(direction).multiplyScalar(moveSpeed));\n  }\n  if (keysPressed['ArrowDown'] || keysPressed['s']) {\n    moveVector.add(tempVec1.copy(direction).multiplyScalar(-moveSpeed));\n  }\n  if (keysPressed['ArrowLeft'] || keysPressed['a']) {\n    moveVector.add(tempVec1.copy(right).multiplyScalar(-moveSpeed));\n  }\n  if (keysPressed['ArrowRight'] || keysPressed['d']) {\n    moveVector.add(tempVec1.copy(right).multiplyScalar(moveSpeed));\n  }\n  const hitPos = tempVec2.copy(camera.position).add(moveVector).add(offset);\n\n  // ç¯„å›²å¤–ãªã‚‰ç„¡è¦–\n  if (hitPos.distanceTo(collisionCenter) > collisionRadius) return;\n\n  // è¡çªåˆ¤å®š\n  for (const box of collidableBoxes) {\n    if (box.containsPoint(hitPos)) return;\n  }\n\n  // ç§»å‹•\n  camera.position.add(moveVector);\n  controls.target.add(moveVector);\n}\nconst raycaster = new three__WEBPACK_IMPORTED_MODULE_2__.Raycaster();\nwindow.addEventListener('mousemove', onMouseMove);\nlet micClicked = false;\nlet telescopeClickable = false;\nlet telescopeClicked = false;\nlet lyricsDisplayEnabled = false;\ndocument.addEventListener('DOMContentLoaded', () => {\n  const safePlayer = new SafeTextAlivePlayer({\n    app: {\n      token: 'F3s1rJugVHrXdNRN'\n    },\n    mediaElement: document.querySelector('#media')\n  });\n  // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è¦ª(target)ã‚’æ¢ã™\n  function isDescendantOf(object, target) {\n    let o = object;\n    while (o) {\n      if (o === target) return true;\n      o = o.parent;\n    }\n    return false;\n  }\n\n  // å„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ã‚¯ãƒªãƒƒã‚¯åˆ¤å®š\n  window.addEventListener('click', event => {\n    const intersects = raycaster.intersectObjects(scene.children, true);\n    if (intersects.length > 0) {\n      const clickedObject = intersects[0].object;\n      console.log(clickedObject);\n      if (phase === 'init' && !micClicked && mic && isDescendantOf(clickedObject, mic)) {\n        console.log('ãƒã‚¤ã‚¯ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');\n        micClicked = true;\n        gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(clickHereElement, {\n          opacity: 0,\n          duration: 0.6,\n          onComplete: () => {\n            clickHereObj.visible = false;\n            setupHoloSlider();\n            showCSSHologramAboveMic();\n            setTimeout(() => {\n              showClickHereAboveTelescope();\n            }, 3000);\n          }\n        });\n      } else if (phase === 'init' && !telescopeClicked && telescope && isDescendantOf(clickedObject, telescope)) {\n        // ãƒ‡ãƒãƒƒã‚°\n        if (!safePlayer.player.video || !telescopeClickable) return;\n        console.log('æœ›é é¡ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');\n        startTelescopeTransition();\n      } else if (phase === 'init' && amp && isDescendantOf(clickedObject, amp)) {\n        console.log('ã‚¢ãƒ³ãƒ—ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');\n        //safePlayer.loadSong(trackList[2]); // ãƒ‡ãƒãƒƒã‚°ç”¨ä»®å‘¼ã³å‡ºã—\n      }\n    }\n  });\n  let currentPlayButton = null;\n  let currentSeekBar = null;\n  let currentTimeDisplay = null;\n  let currentIndex = 0;\n  function setupHoloSlider() {\n    const slider = document.querySelector('.slider-wrapper');\n    slider.innerHTML = '';\n    function formatTime(ms) {\n      const sec = Math.floor(ms / 1000);\n      const min = Math.floor(sec / 60).toString().padStart(2, '0');\n      const s = (sec % 60).toString().padStart(2, '0');\n      return `${min}:${s}`;\n    }\n    function updateSeekUI(posMs) {\n      const video = safePlayer.player.video;\n      if (!video) return;\n      const durMs = video.duration;\n      const pct = posMs / durMs * 100;\n      currentSeekBar.value = pct;\n      currentTimeDisplay.textContent = `${formatTime(posMs)} / ${formatTime(durMs)}`;\n    }\n    if (!safePlayer._holoSliderTimeUpdateRegistered) {\n      safePlayer._holoSliderTimeUpdateRegistered = true;\n      safePlayer.on('timeupdate', posMs => {\n        if (!currentSeekBar || !currentTimeDisplay) return;\n        updateSeekUI(posMs);\n      });\n    }\n    trackList.forEach((track, i) => {\n      const slide = document.createElement('div');\n      slide.className = 'slide';\n      slide.dataset.index = i;\n      slide.innerHTML = `\n      <div class=\"slide-content\">\n        <img class=\"jacket\" src=\"${track.image}\" alt=\"${track.title}\" />\n        <div class=\"song-info\">\n          <h3 class=\"song-title\">${track.title}</h3>\n          <p class=\"song-artist\">${track.artist}</p>\n          <img src=\"./texture/barlines.png\" class=\"barlines\" alt=\"bars\" />\n        </div>\n      </div>\n      <div class=\"player-controls\">\n        <button class=\"play-btn\">â–¶</button>\n        <input type=\"range\" class=\"seek-bar\" min=\"0\" max=\"100\" value=\"0\" />\n        <span class=\"time-display\">00:00 / 00:00</span>\n      </div>\n    `;\n      slider.appendChild(slide);\n    });\n    const btnPrev = document.getElementById('slidePrev');\n    const btnNext = document.getElementById('slideNext');\n    btnPrev.addEventListener('click', () => updateSlide(-1));\n    btnNext.addEventListener('click', () => updateSlide(+1));\n    async function updateSlide(offset) {\n      currentIndex = (currentIndex + offset + trackList.length) % trackList.length;\n      const slideWidth = slider.querySelector('.slide').offsetWidth;\n      gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(slider, {\n        x: -slideWidth * currentIndex,\n        duration: 0.3,\n        ease: 'power2.out'\n      });\n      const currentSlide = slider.children[currentIndex];\n      currentPlayButton = currentSlide.querySelector('.play-btn');\n      currentSeekBar = currentSlide.querySelector('.seek-bar');\n      currentTimeDisplay = currentSlide.querySelector('.time-display');\n      btnPrev.classList.add('disabled');\n      btnNext.classList.add('disabled');\n      currentPlayButton.classList.add('disabled');\n      currentPlayButton.textContent = '...';\n      currentSeekBar.classList.add('disabled');\n      currentSeekBar.value = 0;\n      currentTimeDisplay.textContent = 'èª­ã¿è¾¼ã¿ä¸­...';\n      await safePlayer.loadSong(trackList[currentIndex]);\n      btnPrev.classList.remove('disabled');\n      btnNext.classList.remove('disabled');\n      currentPlayButton.classList.remove('disabled');\n      currentPlayButton.textContent = 'â–¶';\n      currentSeekBar.value = 0;\n      const dur = safePlayer.player.video?.duration || 0;\n      currentTimeDisplay.textContent = `00:00 / ${formatTime(dur)}`;\n      currentPlayButton.onclick = async () => {\n        if (!safePlayer.videoReady) {\n          return;\n        }\n        if (safePlayer.isPlaying) {\n          await safePlayer.safePause();\n          currentPlayButton.textContent = 'â–¶';\n          currentSeekBar.classList.add('disabled');\n          console.log(`[play button] Paused.`);\n        } else {\n          await safePlayer.safePlay();\n          currentPlayButton.textContent = 'â¸';\n          currentSeekBar.classList.remove('disabled');\n          console.log(`[play button] Playing.`);\n        }\n      };\n      currentSeekBar.oninput = () => {\n        const video = safePlayer.player.video;\n        if (!video) return;\n        const newTime = currentSeekBar.value / 100 * video.duration;\n        console.log(`[seekBar.input] Requesting seek to: ${newTime.toFixed(0)}ms`);\n        safePlayer.player.requestMediaSeek(newTime);\n      };\n    }\n    updateSlide(0);\n  }\n  function hideHologramUI() {\n    hologramObject.visible = false;\n  }\n  function showCSSHologramAboveMic() {\n    const micTop = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3();\n    mic.getWorldPosition(micTop);\n    micTop.y += 2.1;\n    hologramObject.position.copy(micTop);\n    hologramObject.visible = true;\n\n    // ã‚¹ã‚±ãƒ¼ãƒ«ã‚’0ã«åˆæœŸåŒ–ã—ã¦ã‹ã‚‰ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³\n    hologramObject.scale.set(0.0001, 0.0001, 0.0001);\n\n    // UIè¦ç´ ã®opacityã‚’0ã«ã—ã¦ã‹ã‚‰ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³\n    const ui = document.getElementById('hologramBillboard');\n    ui.style.opacity = 0;\n\n    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŒæ™‚ã«å®Ÿè¡Œ\n    gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(hologramObject.scale, {\n      x: 0.005,\n      y: 0.005,\n      z: 0.005,\n      duration: 0.8,\n      ease: 'expo.out'\n    });\n    gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(ui, {\n      opacity: 1,\n      duration: 0.8,\n      ease: 'power2.out'\n    });\n  }\n\n  // æœ›é é¡ã¸ã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³\n  function startTelescopeTransition() {\n    if (phase !== 'init') return;\n    if (!safePlayer.songReady) return; // æ›²ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ãªã„\n    safePlayer.safePause(); // ä¸€æ™‚åœæ­¢\n    gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(clickHereElement, {\n      opacity: 0,\n      duration: 0.6,\n      onComplete: () => {\n        clickHereObj.visible = false;\n      }\n    });\n    phase = 'telescopeZooming';\n    const telescopePosition = telescope.position.clone();\n    const targetCameraPosition = camera.position.clone();\n    const tempCamera = new three__WEBPACK_IMPORTED_MODULE_2__.PerspectiveCamera();\n    tempCamera.position.copy(targetCameraPosition);\n    tempCamera.lookAt(telescopePosition.x + 1, telescopePosition.y, telescopePosition.z);\n    const targetQuaternion = tempCamera.quaternion.clone();\n    const startQuaternion = camera.quaternion.clone();\n\n    // ğŸ“¸ ã‚«ãƒ¡ãƒ©ã®ã‚ºãƒ¼ãƒ ï¼ˆä½ç½®ï¼‰\n    gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(camera.position, {\n      x: telescopePosition.x,\n      y: telescopePosition.y + 1.2,\n      z: telescopePosition.z + 0.6,\n      duration: 2,\n      ease: 'power2.inOut'\n    });\n\n    // ğŸ“¸ ã‚«ãƒ¡ãƒ©ã®å‘ãï¼ˆQuaternionè£œé–“ï¼‰\n    gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to({\n      t: 0\n    }, {\n      t: 1,\n      duration: 2,\n      ease: 'power2.inOut',\n      onUpdate() {\n        let progress = this.targets()[0].t;\n        camera.quaternion.copy(startQuaternion).slerp(targetQuaternion, progress);\n\n        // ã‚«ãƒ¡ãƒ©æ–¹å‘ã«åˆã‚ã›ã¦ controls.target ã‚‚æ›´æ–°\n        const currentTarget = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0, 0, -0.01).applyQuaternion(camera.quaternion).add(camera.position);\n        controls.target.copy(currentTarget);\n      },\n      onComplete() {\n        const newTarget = new three__WEBPACK_IMPORTED_MODULE_2__.Vector3(0, 0, -0.01);\n        newTarget.applyQuaternion(camera.quaternion).add(camera.position);\n        controls.target.copy(newTarget);\n        phase = 'fadingOut';\n        fadeOutOverlay(async () => {\n          hideModelsBeforeTelescopeScene();\n          hideHologramUI();\n          switchToStarScene(); // æ˜Ÿç©ºã‚·ãƒ¼ãƒ³ã¸ã®åˆ‡ã‚Šæ›¿ãˆ\n          showVignette();\n          GUIsprite.visible = false;\n          stopMouseDragLoop();\n          startMouseDragLoop(true);\n          setTimeout(() => {\n            gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(GUIMouseSprite.material, {\n              opacity: 0,\n              duration: 1.2,\n              onComplete: () => {\n                GUIMouseSprite.visible = false;\n              }\n            });\n            gsap__WEBPACK_IMPORTED_MODULE_5__[\"default\"].to(GUIMouseArrowSprite.material, {\n              opacity: 0,\n              duration: 1.2,\n              onComplete: () => {\n                GUIMouseArrowSprite.visible = false;\n              }\n            });\n          }, 10000);\n          fadeInOverlay(() => {\n            phase = 'exploringStars';\n          });\n          await safePlayer._sleep(1500); // å†ç”Ÿã¾ã§å°‘ã—å¾…ã¤\n          safePlayer.restartCurrentSong();\n          lyricsDisplayEnabled = true;\n        });\n      }\n    });\n  }\n  safePlayer.on('appready', () => {\n    console.log('âœ… ã‚¢ãƒ—ãƒªæº–å‚™å®Œäº†');\n  });\n  safePlayer.on('videoready', () => {\n    console.log('âœ… ãƒ“ãƒ‡ã‚ªæº–å‚™å®Œäº†');\n  });\n  safePlayer.on('play', () => {\n    const song = safePlayer.getCurrentSong();\n    if (song) {\n      console.log(`â–¶ï¸ å†ç”Ÿä¸­: ${song.name} by ${song.artist?.name ?? 'ä¸æ˜'}`);\n    }\n  });\n  safePlayer.on('pause', () => {\n    console.warn('ğŸ›‘ safePause å‘¼ã³å‡ºã—ï¼ˆã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ï¼‰');\n    console.trace();\n    console.log('pause');\n  });\n  safePlayer.on('stop', () => {\n    console.log('stop');\n    // if (safePlayer.loopOnEnd) {\n    //   // æ¬¡ãƒ«ãƒ¼ãƒ—ã«å‚™ãˆã¦ã™ã¹ã¦ã® data.returned ã‚’ false ã«\n    //   allLyricData.forEach(({ data }) => {\n    //     data.returned = false;\n    //   });\n    //   //safePlayer.loopOnEnd = false;\n    // }\n  });\n  const trackList = [{\n    title: 'ã‚¹ãƒˆãƒªãƒ¼ãƒˆãƒ©ã‚¤ãƒˆ',\n    artist: 'åŠ è³€(ãƒã‚®ã‚·ãƒ£ãƒ¯ãƒ¼P)',\n    url: 'https://piapro.jp/t/ULcJ/20250205120202',\n    image: './Model/cover.png',\n    beatId: 4694275,\n    chordId: 2830730,\n    repetitiveSegmentId: 2946478,\n    lyricId: 67810,\n    lyricDiffId: 20654\n  }, {\n    title: 'ã‚¢ãƒªãƒ•ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³',\n    artist: 'é›¨è‰¯ Amala',\n    url: 'https://piapro.jp/t/SuQO/20250127235813',\n    image: './Model/cover.png',\n    beatId: 4694276,\n    chordId: 2830731,\n    repetitiveSegmentId: 2946479,\n    lyricId: 67811,\n    lyricDiffId: 20655\n  }, {\n    title: 'ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒãƒ«ãƒ€ã‚¤ãƒ–',\n    artist: '99piano',\n    url: 'https://piapro.jp/t/Ppc9/20241224135843',\n    image: './Model/cover.png',\n    beatId: 4694277,\n    chordId: 2830732,\n    repetitiveSegmentId: 2946480,\n    lyricId: 67812,\n    lyricDiffId: 20656\n  }, {\n    title: 'ãƒãƒ­ãƒ¼ã€ãƒ•ã‚§ãƒ«ãƒŸã€‚',\n    artist: 'ã©ï½ã±ã¿ã‚“',\n    url: 'https://piapro.jp/t/oTaJ/20250204234235',\n    image: './Model/cover.png',\n    beatId: 4694278,\n    chordId: 2830733,\n    repetitiveSegmentId: 2946481,\n    lyricId: 67813,\n    lyricDiffId: 20657\n  }, {\n    title: 'ãƒ‘ãƒ¬ãƒ¼ãƒ‰ãƒ¬ã‚³ãƒ¼ãƒ‰',\n    artist: 'ãã•ã‚‰',\n    url: 'https://piapro.jp/t/GCgy/20250202202635',\n    image: './Model/cover.png',\n    beatId: 4694279,\n    chordId: 2830734,\n    repetitiveSegmentId: 2946482,\n    lyricId: 67814,\n    lyricDiffId: 20658\n  }, {\n    title: 'ãƒ­ãƒ³ãƒªãƒ¼ãƒ©ãƒ³',\n    artist: 'æµ·é¢¨å¤ªé™½',\n    url: 'https://piapro.jp/t/CyPO/20250128183915',\n    image: './Model/cover.png',\n    beatId: 4694280,\n    chordId: 2830735,\n    repetitiveSegmentId: 2946483,\n    lyricId: 67815,\n    lyricDiffId: 20659\n  }];\n});\nconst mouse = new three__WEBPACK_IMPORTED_MODULE_2__.Vector2();\nfunction onMouseMove(event) {\n  // ãƒã‚¦ã‚¹åº§æ¨™ã‚’æ­£è¦åŒ–\n  mouse.x = event.clientX / window.innerWidth * 2 - 1;\n  mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\n}\n/* --------------------------\r\n  ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—\r\n--------------------------*/\n\nconst darkMaterial = new three__WEBPACK_IMPORTED_MODULE_2__.MeshBasicMaterial({\n  color: 'black'\n});\nconst materialsCache = new Map();\nfunction darkenNonBloomed(obj) {\n  if (obj.isMesh || obj.isPoints || obj.isLine) {\n    if (!bloomLayer.test(obj.layers)) {\n      materialsCache.set(obj, obj.material);\n      obj.material = darkMaterial;\n    }\n  }\n}\nfunction restoreMaterials(obj) {\n  if (materialsCache.has(obj)) {\n    obj.material = materialsCache.get(obj);\n    materialsCache.delete(obj);\n  }\n}\nfunction animate() {\n  requestAnimationFrame(animate);\n  updateCameraMovement();\n  updateHudSpritePosition();\n  updateClickHere();\n  raycaster.setFromCamera(mouse, camera);\n  if (mic && telescope && amp) {\n    const raycastTargets = [];\n    if (mic && !micClicked) raycastTargets.push(mic);\n    if (telescope && !telescopeClicked && micClicked && telescopeClickable) raycastTargets.push(telescope);\n    const intersects = raycaster.intersectObjects(raycastTargets, true); // mic ã¯ glb ãƒ¢ãƒ‡ãƒ«ã®ãƒ«ãƒ¼ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ\n    document.body.style.cursor = intersects.length > 0 ? 'pointer' : 'grab';\n  }\n  const starSphere = scene.getObjectByName('starSphere');\n  if (starSphere) {\n    starSphere.rotation.y += 0.00002;\n  }\n  if (hologramObject.visible) {\n    hologramObject.lookAt(camera.position);\n  }\n  lyricsGroup.children.forEach(mesh => {\n    mesh.lookAt(camera.position);\n  });\n  persistentStarsGroup.children.forEach(obj => {\n    if (obj.userData.lookAtCamera) {\n      obj.lookAt(camera.position);\n    }\n  });\n  if (!resettingCamera) {\n    controls.update();\n  }\n\n  // === [1] é€šå¸¸æç”»å‰ã« bloom ãƒ¬ã‚¤ãƒ¤ãƒ¼ã ã‘ã‚’æç”» ===\n  // scene.traverse(darkenNonBloomed);\n  // camera.layers.set(1); // bloomLayer ã®ã¿æç”»\n  // bloomComposer.render(); // UnrealBloomPass ç”¨\n  // scene.traverse(restoreMaterials);\n\n  // === [2] é€šå¸¸æç”» ===\n  // camera.layers.set(0); // é€šå¸¸ãƒ¬ã‚¤ãƒ¤ãƒ¼\n  renderer.clear();\n  renderer.render(scene, camera);\n  renderer.clearDepth(); // æ·±åº¦ãƒãƒƒãƒ•ã‚¡ã‚’ã‚¯ãƒªã‚¢\n  renderer.render(hudScene, hudCamera);\n  cssRenderer.render(scene, camera);\n}\nanimate();\nstartShootingStars();\n\n/* --------------------------\r\n  ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ\r\n--------------------------*/\nwindow.addEventListener('resize', () => {\n  camera.aspect = window.innerWidth / window.innerHeight;\n  camera.updateProjectionMatrix();\n  cssRenderer.setSize(window.innerWidth, window.innerHeight);\n  hudCamera.left = -window.innerWidth / 2;\n  hudCamera.right = window.innerWidth / 2;\n  hudCamera.top = window.innerHeight / 2;\n  hudCamera.bottom = -window.innerHeight / 2;\n  hudCamera.updateProjectionMatrix();\n  renderer.setSize(window.innerWidth, window.innerHeight);\n  if (mouseDragTimeline) {\n    stopMouseDragLoop();\n    if (currentMouseDragMode === 'center') {\n      startMouseDragLoop(true);\n    } else {\n      startMouseDragLoop(false);\n    }\n  }\n});\n\n/* --------------------------\r\n  ã‚¨ãƒ©ãƒ¼å¯¾å¿œ\r\n--------------------------*/\nwindow.onerror = function (message, source, lineno, colno, error) {\n  console.error('ğŸŒ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒ:', {\n    message,\n    source,\n    lineno,\n    colno,\n    error\n  });\n};\nwindow.addEventListener('unhandledrejection', event => {\n  if (event.reason && event.reason.name === 'AbortError') {\n    event.preventDefault(); // AbortError ã¯ç„¡è¦–\n  }\n});\n\n//# sourceURL=webpack://celestianote/./src/script.js?");

/***/ }),

/***/ "./src/styles.css":
/*!************************!*\
  !*** ./src/styles.css ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n// extracted by mini-css-extract-plugin\n\n\n//# sourceURL=webpack://celestianote/./src/styles.css?");

/***/ })

},
/******/ __webpack_require__ => { // webpackRuntimeModules
/******/ var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
/******/ __webpack_require__.O(0, ["vendors-node_modules_gsap_index_js-node_modules_textalive-app-api_dist_index_es_js-node_modul-493032"], () => (__webpack_exec__("./src/script.js")));
/******/ var __webpack_exports__ = __webpack_require__.O();
/******/ }
]);