"use strict";(self.webpackChunkcelestianote=self.webpackChunkcelestianote||[]).push([[792],{866:(e,t,o)=>{var n=o(922),i=o(437),a=o(24),s=o(411),r=o(880),l=o(977),c=o(92);console.log("THREE.REVISION:",n.sPf);const d=document.getElementById("sceneCanvas"),p=new i.JeP({canvas:d,antialias:!0,preserveDrawingBuffer:!0,alpha:!0});p.setClearColor(0,0),p.autoClear=!1,p.setSize(window.innerWidth,window.innerHeight),p.outputColorSpace=n.er$,document.body.appendChild(p.domElement);const u=new s.a0;u.domElement.classList.add("css3d-renderer"),u.setSize(window.innerWidth,window.innerHeight),u.domElement.style.position="absolute",u.domElement.style.top=0,document.body.appendChild(u.domElement);const y=new n.Z58,h=new n.ubm(75,window.innerWidth/window.innerHeight,.1,100);h.position.set(0,1.6,5);const m=new n.Z58,g=new n.qUd(-window.innerWidth/2,window.innerWidth/2,window.innerHeight/2,-window.innerHeight/2,.1,100);g.position.z=10;const w=new n.$p8(16777215,1.5);y.add(w);const f=new n.Tap,v=f.load("./Model/markup_ARROW.png"),P=f.load("./Model/markup_WASD.png"),M=f.load("./Model/Mouse.png"),b=f.load("./Model/Mouse_Arrow.png"),x=new n.RoJ({map:v,transparent:!0,opacity:1}),q=new n.kxk(x);q.scale.set(160,120,1),q.position.set(-window.innerWidth/2+20,-window.innerHeight/2+20,1),m.add(q);const I=new n.RoJ({map:M,transparent:!0,opacity:1}),A=new n.kxk(I);A.scale.set(70,70,1),A.position.set(-window.innerWidth/2+130,-window.innerHeight/2+40,1),m.add(A);const S=new n.RoJ({map:b,transparent:!0,opacity:1}),z=new n.kxk(S);z.scale.set(50,50,1),z.position.set(-window.innerWidth/2+130,-window.innerHeight/2+40,1),m.add(z);let C=!1;function E(){q.position.set(g.left+90,g.bottom+70,1)}setInterval((()=>{x.map=C?P:v,x.needsUpdate=!0,C=!C}),1e3);let O,k=null,T=null;function L(e=!1){if(k)return;let t,o;T=e?"center":"left",e?(t=(g.left+g.right)/2,o=g.bottom+45):(t=g.left+230,o=g.bottom+45),A.position.set(t,o,1),z.position.set(t+50,o+20,1),A.material.rotation=0,z.material.rotation=-Math.PI/16,k=r.Ay.timeline({repeat:-1,yoyo:!0,ease:"circ.inOut",defaults:{duration:2}}),k.to(A.position,{x:t+70,y:o+40},0),k.to(A.material,{rotation:-Math.PI/16},0),k.to(z.position,{x:t,y:o+5},0),k.to(z.material,{rotation:3*Math.PI/5},0)}function B(){k&&(k.kill(),k=null,A.material.rotation=0,z.material.rotaation=-Math.PI/16,E())}L(),(new c.B).load("./Model/FloorModel/floor.glb",(function(e){O=e.scene,O.scale.set(.25,.25,.25),O.position.set(0,0,5),y.add(O),console.log("âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†")}),void 0,(function(e){console.error("âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",e)}));const W=[{position:new n.Pq0(2.8,0,6),rotation:new n.O9p(0,Math.PI/5,-Math.PI/5),scale:new n.Pq0(.125,.125,.125)},{position:new n.Pq0(-2.9,0,4),rotation:new n.O9p(-Math.PI/4,Math.PI/9,0),scale:new n.Pq0(.1,.1,.1)},{position:new n.Pq0(1.5,0,7),rotation:new n.O9p(0,Math.PI/3,-Math.PI/6),scale:new n.Pq0(.125,.125,.125)},{position:new n.Pq0(-2.5,0,6.5),rotation:new n.O9p(0,-Math.PI/2,Math.PI/5),scale:new n.Pq0(.11,.11,.11)},{position:new n.Pq0(.5,0,6),rotation:new n.O9p(-Math.PI/7,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.04,.04,.04)},{position:new n.Pq0(.23,0,4),rotation:new n.O9p(-Math.PI/3,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.05,.05,.05)},{position:new n.Pq0(2.2,0,1.7),rotation:new n.O9p(-Math.PI/7,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.08,.08,.08)},{position:new n.Pq0(-2.2,0,2.6),rotation:new n.O9p(-2*Math.PI/5,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.06,.06,.06)},{position:new n.Pq0(-2.5,0,7.1),rotation:new n.O9p(-Math.PI/8,-Math.PI/3,Math.PI/3),scale:new n.Pq0(.05,.05,.05)},{position:new n.Pq0(-1.2,0,6.1),rotation:new n.O9p(-Math.PI/7,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.05,.05,.05)},{position:new n.Pq0(2.2,0,7.5),rotation:new n.O9p(-Math.PI/6,-Math.PI/7,-Math.PI/5),scale:new n.Pq0(.05,.05,.05)},{position:new n.Pq0(1,0,8.5),rotation:new n.O9p(-Math.PI/7,-Math.PI/4,Math.PI/8),scale:new n.Pq0(.08,.08,.08)},{position:new n.Pq0(-.9,0,6.3),rotation:new n.O9p(-Math.PI/7,-Math.PI/2,Math.PI/3),scale:new n.Pq0(.07,.07,.07)},{position:new n.Pq0(-1,0,8),rotation:new n.O9p(0,-Math.PI/3,3*Math.PI/8),scale:new n.Pq0(.17,.17,.17)},{position:new n.Pq0(-.4,0,7.6),rotation:new n.O9p(0,-Math.PI/3,Math.PI/4),scale:new n.Pq0(.09,.09,.09)},{position:new n.Pq0(-.5,0,1.5),rotation:new n.O9p(Math.PI/4,Math.PI/7,0),scale:new n.Pq0(.1,.1,.1)}],R=[];let H,$,D,_;(new c.B).load("./Model/StarRightModel/StarRight.glb",(function(e){const t=e.scene;W.forEach((e=>{const o=t.clone(!0);o.position.copy(e.position),o.rotation.copy(e.rotation),o.scale.copy(e.scale),o.traverse((e=>{e.isMesh&&e.material&&(e.material=e.material.clone(),e.material.color=new n.Q1f(11184810))})),y.add(o),R.push(o)}))})),(new c.B).load("./Model/AmpModel/amp.glb",(function(e){H=e.scene,H.scale.set(.24,.24,.24),H.position.set(-2,0,7.3),H.rotation.y=4*Math.PI/5,y.add(H),Y(H),console.log("âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†")}),void 0,(function(e){console.error("âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",e)})),(new c.B).load("./Model/TitleModel/Title.glb",(function(e){$=e.scene,$.scale.set(.5,.5,.5),$.position.set(2.5,0,4),$.rotation.y=-Math.PI/3,y.add($),Y($),console.log("âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†")}),void 0,(function(e){console.error("âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",e)})),(new c.B).load("./Model/MicModel/mic.glb",(function(e){D=e.scene,D.scale.set(.12,.11,.12),D.position.set(.8,0,2),D.rotation.y=-Math.PI/8,y.add(D),Y(D),console.log("âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†"),le=D,re.visible=!0,se.innerHTML='\n      <p style="text-align: center; margin: 0px;">\n        Select Music<br>\n        â‡©\n      </p>\n    ',se.style.opacity=0,r.Ay.to(se,{opacity:1,duration:.6}),console.log("mic world position:",D.position),console.log("clickHereObj position:",re.position)}),void 0,(function(e){console.error("âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",e)})),(new c.B).load("./Model/TeleScopeModel/Telescope.glb",(function(e){_=e.scene,_.scale.set(.5,.5,.5),_.position.set(-1.5,0,2.4),_.rotation.y=Math.PI,y.add(_),Y(_),console.log("âœ… GLBãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº†")}),void 0,(function(e){console.error("âŒ GLBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",e)}));const F=4;let U=0;const j=[],N=[];function Y(e){j.push(e),U++,U===F&&(function(){N.length=0;for(const e of j){if(!e)continue;const t=(new n.NRn).setFromObject(e);N.push(t)}}(),console.log("âœ… ã™ã¹ã¦ã®ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿å®Œäº† â†’ è¡çªãƒœãƒƒã‚¯ã‚¹åˆæœŸåŒ–"))}const Q={};window.addEventListener("keydown",(e=>Q[e.key]=!0)),window.addEventListener("keyup",(e=>Q[e.key]=!1));const G=new n.Pq0,V=new n.Pq0,Z=new n.Pq0,J=new n.Pq0,X=new n.Pq0,K=new n.Pq0(0,-1.6,0),ee=new n.Pq0(0,0,5),te=document.getElementById("hologramBillboard"),oe=new s.on(te);te.style.display="block",oe.scale.set(.005,.005,.005),oe.visible=!1,y.add(oe);const ne=document.getElementById("ampMessageBillboard"),ie=new s.on(ne);ne.style.display="block",ie.scale.set(.005,.005,.005),ie.visible=!1,y.add(ie);const ae=document.createElement("div");ae.id="clickHereContainer";const se=document.createElement("div");se.id="clickHerePrompt",ae.appendChild(se);const re=new s.on(ae);se.style.display="block",re.scale.set(.01,.01,.01),re.position.set(0,0,0),y.add(re);let le=null;function ce(){le=_,re.visible=!0,se.innerHTML='\n      <p style="text-align: center; margin: 0px;">\n        Click Here<br>\n        â‡©\n      </p>\n    ',se.style.opacity=0,r.Ay.to(se,{opacity:1,duration:.6,onComplete:()=>{Be=!0}})}const de=new a.N(h,p.domElement);de.enableDamping=!0,de.dampingFactor=.07,de.enabled=!0,de.enablePan=!1,de.enableZoom=!1,de.target.set(0,1.6,4.9);const pe=h.position.clone(),ue=h.quaternion.clone(),ye=de.target.clone();console.log(ye),console.log(h.position),console.log("åˆæœŸã®ã‚«ãƒ¡ãƒ©Quaternion:",ue);let he,me="init",ge=!1;function we(e){const t=document.getElementById("fadeOverlay");t.style.pointerEvents="auto",t.style.opacity="1",setTimeout((()=>e&&e()),1e3)}function fe(e){const t=document.getElementById("fadeOverlay");t.style.opacity="0",setTimeout((()=>{t.style.pointerEvents="none",e&&e()}),1e3)}function ve(){he&&y.remove(he);const e=new n.Gu$(80,64,64),t=new n.V9B({color:1052704,side:n.hsX,transparent:!0,opacity:1,depthWrite:!1,depthTest:!0});he=new n.eaF(e,t),he.renderOrder=-1,he.frustumCulled=!1,y.add(he);const o=new n.LoY,i=[],a=[],s=new n.Q1f;for(let e=0;e<1500;e++){const e=49.5,t=2*Math.random()*Math.PI,o=Math.acos(2*Math.random()-1),n=e*Math.sin(o)*Math.cos(t),r=e*Math.sin(o)*Math.sin(t),l=e*Math.cos(o);i.push(n,r,l),s.setHSL(Math.random(),1,.7+.3*Math.random()),a.push(s.r,s.g,s.b)}o.setAttribute("position",new n.qtW(i,3)),o.setAttribute("color",new n.qtW(a,3));const l=new n.BH$({size:.2,vertexColors:!0,transparent:!0,opacity:.8}),c=new n.ONl(o,l);return he.add(c),r.Ay.to(l,{opacity:.3+.5*Math.random(),duration:2+2*Math.random(),yoyo:!0,repeat:-1,ease:"sine.inOut"}),console.log("ğŸŒŒ æ˜Ÿç©ºãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸ"),c.name="starSphere",c}ve();const Pe=new n.YJl;Pe.position.set(0,0,0),Pe.rotation.set(0,0,0),Pe.scale.set(1,1,1),y.add(Pe);const Me=[];function be(e,t,o=null,i=4e3){const a=Me.find((o=>o.text===e&&o.startTime===t));a&&function(e){if(e.constellationLines){const t=e.constellationLines.material;r.Ay.to(t,{opacity:0,duration:1,ease:"power2.out",onComplete:()=>{y.remove(e.constellationLines),e.constellationLines.geometry.dispose(),e.constellationLines.material.dispose(),e.constellationLines=null}})}if(e.points&&e.keepIndices){const t=e.points.geometry.getAttribute("position"),o=e.points.geometry.getAttribute("aSize"),i=e.points.material;e.keepIndices.forEach((e=>{const i=new n.Pq0(t.getX(e),t.getY(e),t.getZ(e)),a=new n.Pq0(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize().multiplyScalar(2+4*Math.random()),s=i.clone().add(a);if(r.Ay.to(i,{x:s.x,y:s.y,z:s.z,duration:1.2,ease:"power2.out",onUpdate:()=>{t.setXYZ(e,i.x,i.y,i.z),t.needsUpdate=!0}}),o){const t={value:o.getX(e)};r.Ay.to(t,{value:0,duration:1.2,onUpdate:()=>{o.setX(e,t.value),o.needsUpdate=!0}})}})),r.Ay.to(i.uniforms.uOpacity,{value:0,duration:1.2,ease:"power2.out",onComplete:()=>{Pe.remove(e.points),e.points.geometry.dispose(),e.points.material.dispose(),e.points=null}})}}(a);const s=Math.max(i/1e3,1.5),l=function(e,{canvasSize:t=1024,xStep:o=1,yStep:i=1,threshold:a=128,font:s='bold 48px "Noto Sans JP", Meiryo, sans-serif',scale:r=120}={}){const l=document.createElement("canvas");l.width=l.height=t;const c=l.getContext("2d");c.clearRect(0,0,t,t),c.fillStyle="white",c.font=s,c.textAlign="center",c.textBaseline="middle",c.fillText(e,t/2,t/2);const d=c.getImageData(0,0,t,t).data,p=[];for(let e=0;e<t;e+=i)for(let n=0;n<t;n+=o)d[4*(e*t+n)+3]>a&&p.push({x:n,y:e});let u=0,y=0;p.forEach((({x:e,y:t})=>{u+=e,y+=t}));const h=u/p.length,m=y/p.length;return p.map((({x:e,y:o})=>{const i=(e-h)/t*r,a=(m-o)/t*r,s=1.5*(Math.random()-.5);return new n.Pq0(i,a,s)}))}(e,{canvasSize:1024,xStep:1,yStep:1,scale:120,font:'bold 48px "Noto Sans JP", Meiryo'}),c=new n.Pq0;h.getWorldDirection(c);const d=55+5*Math.random(),p=h.position.clone().add(c.clone().multiplyScalar(d)),u=o||p,m=function(e){const t=new n.Pq0;h.getWorldDirection(t);const o=(new n.Pq0).crossVectors(t,h.up).normalize(),i=[...Array(e.length).keys()].sort(((t,o)=>e[t].x-e[o].x)),a=e[i[0]],s=e[i[i.length-1]],r=(new n.Pq0).subVectors(s,a).normalize(),l=r.dot(o);return console.log("First pos:",a.toArray()),console.log("Last pos:",s.toArray()),console.log("SpanVec:",r.toArray()),console.log("Right:",o.toArray()),console.log("Dot product:",l),l>=0?o:o.negate()}(l),g=function(e,{sizeRange:t=[.1,.3],colorHueRange:o=[0,1],sortDirection:i=null}={}){const a=e.length,s=[],l=[],c=[],d=new Float32Array(a).fill(0);for(let i=0;i<a;i++){const a=new n.Pq0(7*(Math.random()-.5),7*(Math.random()-.5),7*(Math.random()-.5)),r=e[i].clone().add(a);s.push(...r.toArray());const d=Math.random()*(o[1]-o[0])+o[0],p=(new n.Q1f).setHSL(d,1,.7);l.push(p.r,p.g,p.b);const u=2*Math.random()*(t[1]-t[0])+t[0];c.push(u)}const p=new n.LoY;p.setAttribute("position",new n.qtW(s,3)),p.setAttribute("aColor",new n.qtW(l,3)),p.setAttribute("aSize",new n.qtW(c,1)),p.setAttribute("aOpacity",new n.qtW(d,1));const u=new n.BKk({transparent:!0,blending:n.EZo,depthTest:!0,depthWrite:!1,uniforms:{uTime:{value:0},uOpacity:{value:1}},vertexShader:"\n      attribute float aSize;\n      attribute vec3 aColor;\n      attribute float aOpacity;\n      varying vec3 vColor;\n      varying float vOpacity;\n      uniform float uTime;\n      void main(){\n        vColor = aColor;\n        vOpacity = aOpacity;\n        vec4 mv = modelViewMatrix * vec4(position,1.0);\n        gl_PointSize = aSize * (300.0 / -mv.z) * clamp(uTime, 0.0, 1.0);\n        gl_Position = projectionMatrix * mv;\n      }",fragmentShader:"\n      varying vec3 vColor;\n\n      varying float vOpacity;\n      uniform float uOpacity;\n      void main(){\n        float d = distance(gl_PointCoord, vec2(0.5));\n        if(d > 0.5) discard;\n        float alpha = mix(0.0, 1.0, vOpacity);\n        gl_FragColor = vec4(vColor, alpha * uOpacity);\n      }"}),y=new n.ONl(p,u),h=p.getAttribute("position"),m=p.getAttribute("aOpacity"),g=[...Array(a).keys()];if(i){g.sort(((t,o)=>e[t].dot(i)-e[o].dot(i)));const t=e[g[0]],o=e[g[g.length-1]];console.log("ğŸ¯ Sorted direction test:"),console.log("First pos:",t.toArray()),console.log("Last pos:",o.toArray())}return g.forEach(((t,o)=>{const i=new n.Pq0(h.getX(t),h.getY(t),h.getZ(t)),a=e[t];r.Ay.to(d,{[t]:1,delay:2e-4*o,duration:.3,ease:"power2.out",onUpdate:()=>{m.array[t]=d[t],m.needsUpdate=!0}}),r.Ay.to(i,{x:a.x,y:a.y,z:a.z,delay:2e-4*o,duration:.5,ease:"power2.out",onUpdate:()=>{h.setXYZ(t,i.x,i.y,i.z),h.needsUpdate=!0}})})),y}(l,{sizeRange:[.1,.25],colorHueRange:[0,1],sortDirection:m});g.position.copy(u),Pe.add(g);const w=[...Array(l.length).keys()];w.sort(((e,t)=>l[e].dot(m)-l[t].dot(m)));const f=g.material;if(r.Ay.to(f.uniforms.uTime,{value:1,duration:1,ease:"power2.out"}),r.Ay.to(f.uniforms.uOpacity,{value:1,duration:.8,ease:"power2.out",onComplete:()=>{const e=g.geometry.getAttribute("position"),t=g.geometry.getAttribute("aOpacity"),o=t.array,i=[];for(let t=0;t<e.count;t++){const o=(new n.Pq0).fromBufferAttribute(e,t),a=new n.Pq0(Math.random()-.5,Math.random()-.5,Math.random()-.5).normalize().multiplyScalar(2+4*Math.random());i.push(o.clone().add(a))}w.forEach(((a,l)=>{const c=i[a];if(!c)return;const d=(new n.Pq0).fromBufferAttribute(e,a);r.Ay.to(d,{x:c.x,y:c.y,z:c.z,delay:s-.8+2e-4*l,duration:1.5,ease:"power2.out",onUpdate:()=>{e.setXYZ(a,d.x,d.y,d.z),e.needsUpdate=!0}}),r.Ay.to(o,{[a]:0,delay:s-.8+2e-4*l,duration:1.5,ease:"power2.out",onUpdate:()=>{t.array[a]=o[a],t.needsUpdate=!0}})}))}}),0===Ie.length)return console.warn("No constellation targets available"),{text:e,startTime:t,center:u,points:g};let v=null,P=1/0;for(const e of Ie){const t=u.distanceTo(e.position);t<P&&(P=t,v=e)}if(!v)return console.warn("æœ€è¿‘å‚ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"),{text:e,startTime:t,center:u,points:g};const M=v.position.clone();return console.log(`ğŸ“ Nearest constellation: ${v.name}`),console.log("center:",u.toArray()),console.log("targetPos:",M.toArray()),console.log("distance:",P.toFixed(2)),P<5?(console.log(`ğŸŒŸ æ˜Ÿåº§ã€Œ${v.name}ã€ã‚’ç”Ÿæˆ`),function({data:e,position:t,name:o}){if(xe.has(o))return void console.log(`âš ï¸ æ˜Ÿåº§ "${o}" ã¯æ—¢ã«ç”Ÿæˆæ¸ˆã¿ã§ã™`);const i=new n.YJl,a=new n.Pq0;e.stars.forEach((([e,t,o])=>{a.x+=e,a.y+=t,a.z+=o})),a.divideScalar(e.stars.length),i.position.copy(t),e.stars.forEach((e=>{const t=new n.eaF(new n.Gu$(.2,8,8),new n.V9B({color:16777164})),o=new n.Pq0(...e).sub(a);t.position.copy(o),i.add(t)})),e.connections.forEach((([t,o])=>{const s=new n.Pq0(...e.stars[t]).sub(a),r=new n.Pq0(...e.stars[o]).sub(a),l=(new n.LoY).setFromPoints([s,r]),c=new n.N1A(l,new n.mrM({color:8834763}));i.add(c)})),y.add(i);const s=(new n.Pq0).copy(h.position);i.lookAt(s),xe.add(o),function(){const e=xe.size,t=[16711680,16744192,16776960,65280,255,4915330,9109759];let o;if(e>=12)o=e=>{const o=t[e%t.length];return new n.Q1f(o)};else{let t;t=e>=10?52945:e>=8?255:e>=6?8388736:e>=3?16738740:11184810;const i=new n.Q1f(t);o=()=>i}R.forEach(((e,t)=>{const n=o(t);e.traverse((e=>{if(e.isMesh&&e.material&&e.material.color){const t=e.material.color.clone();r.Ay.to(t,{r:n.r,g:n.g,b:n.b,duration:1.2,ease:"power2.out",onUpdate:()=>{e.material.color.setRGB(t.r,t.g,t.b)}})}}))}))}(),function(){if(!he)return;const e=xe.size,t=Math.min(e/10,1),o=new n.Q1f(1052704),i=new n.Q1f(2105408),a=o.clone().lerp(i,t);r.Ay.to(he.material.color,{r:a.r,g:a.g,b:a.b,duration:1.5,ease:"power2.out"})}(),1===xe.size&&function(){if(Ee)return;Ee=!0;let e=0;!function t(){const o=performance.now(),n=xe.size,i=Math.max(1e3,8e3-500*n);if(o-e>i){e=o;const t=n,i=1+Math.floor(Math.random()*(1+t));for(let e=0;e<i;e++)Oe()}requestAnimationFrame(t)}()}()}({data:v.data,position:M,name:v.name})):console.log("è·é›¢ãŒé ã™ãã¦æ˜Ÿåº§æœªç”Ÿæˆ"),!Te?.loopOnEnd&&P>5&&P<50?function(e,t,o,i){const a=[],s=[],l=new n.LoY,c=new n.Q1f,d=(Math.max(5,Math.min(o,50))-5)/40,p=.9*(1-d),u=5+10*(1-d),h=2+6*d,m=new n.Pq0(0,1,0),g=(new n.kn4).lookAt(new n.Pq0,t,m);for(let t=0;t<300;t++){const t=Math.random()*u,o=(1-t/u)*h,i=Math.random()*Math.PI*2,r=Math.cos(i)*o,l=Math.sin(i)*o,p=-t,y=new n.Pq0(r,l,p).applyMatrix4(g),m=e.clone().add(y);a.push(m.x,m.y,m.z);const w=.1+.4*Math.random(),f=1-d,v=.7;c.setHSL(w,f,v),s.push(c.r,c.g,c.b)}l.setAttribute("position",new n.qtW(a,3)),l.setAttribute("color",new n.qtW(s,3));const w=new n.BH$({size:.2,vertexColors:!0,transparent:!0,opacity:0,depthWrite:!1,blending:n.EZo}),f=new n.ONl(l,w);y.add(f);const v={value:0},P=r.Ay.to(v,{value:4*Math.PI,duration:2,repeat:-1,ease:"sine.inOut",onUpdate:()=>{const e=(Math.sin(v.value)+1)/2;w.opacity=p*(.3+.6*e)}});setTimeout((()=>{P.kill(),r.Ay.to(w,{opacity:0,duration:1,ease:"power2.in",onComplete:()=>{y.remove(f),l.dispose(),w.dispose()}})}),1e3*i)}(u,(new n.Pq0).subVectors(M,u).normalize(),P,s):Te?.loopOnEnd&&console.log("ğŸ” ãƒ«ãƒ¼ãƒ—ä¸­ã®ãŸã‚ãƒ’ãƒ³ãƒˆè¡¨ç¤ºã¯ã‚¹ã‚­ãƒƒãƒ—"),{text:e,startTime:t,center:u,points:g}}const xe=new Set,qe={hercules:{stars:[[0,0,0],[6,9,.2],[-6,9,-.2],[6,18,0],[-6,18,0]],connections:[[0,1],[0,2],[1,3],[2,4],[3,4]],size:16},canisMajor:{stars:[[0,0,0],[5,6,0],[10,3,.2],[15,0,-.2],[5,-6,.1]],connections:[[0,1],[1,2],[2,3],[0,4]],size:15},ursaMinor:{stars:[[0,0,0],[3,3,.2],[6,6,-.2],[9,9,0],[12,12,0]],connections:[[0,1],[1,2],[2,3],[3,4]],size:12},draco:{stars:[[0,0,0],[3,3,.3],[6,6,-.2],[9,9,.1],[12,6,0],[15,3,-.1],[18,0,0]],connections:[[0,1],[1,2],[2,3],[3,4],[4,5],[5,6]],size:18},capricornus:{stars:[[0,0,0],[6,0,.1],[3,6,-.1],[0,12,0],[-3,6,0],[-6,0,0]],connections:[[0,1],[1,2],[2,3],[3,4],[4,5],[5,0]],size:12},crux:{stars:[[0,0,0],[0,11.25,0],[7.5,5.625,.375],[-7.5,5.625,-.375]],connections:[[0,1],[2,3]],size:12},pegasus:{stars:[[0,0,0],[11.25,0,.375],[11.25,11.25,-.375],[0,11.25,0]],connections:[[0,1],[1,2],[2,3],[3,0]],size:12},leo:{stars:[[0,0,0],[7.5,3.75,.1875],[15,0,-.1875],[11.25,11.25,0]],connections:[[0,1],[1,2],[1,3]],size:15},andromeda:{stars:[[0,0,0],[3.75,7.5,.375],[7.5,15,-.375],[11.25,22.5,.1875],[15,30,-.1875]],connections:[[0,1],[1,2],[2,3],[3,4]],size:16},taurus:{stars:[[0,0,0],[-5.625,11.25,0],[-11.25,22.5,-.375],[-16.875,33.75,.375],[-22.5,22.5,0],[-28.125,11.25,-.1875]],connections:[[0,1],[1,2],[2,3],[3,4],[4,5]],size:16},lyra:{stars:[[0,0,0],[11.25,0,.375],[5.625,11.25,0],[5.625,5.625,3.75]],connections:[[0,1],[1,2],[2,0],[2,3]],size:12},scorpius:{stars:[[0,0,0],[3.75,7.5,0],[7.5,11.25,-.375],[11.25,7.5,0],[15,0,.375],[11.25,-7.5,0],[7.5,-11.25,-.375],[3.75,-7.5,0]],connections:[[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],[6,7]],size:13},aquarius:{stars:[[0,0,0],[3.75,3.75,.375],[7.5,0,-.375],[11.25,3.75,.1875],[15,0,-.1875],[18.75,3.75,0]],connections:[[0,1],[1,2],[2,3],[3,4],[4,5]],size:15},orion:{stars:[[0,0,0],[7.5,15,.375],[-7.5,15,-.375],[0,30,0],[11.25,-7.5,.375],[-11.25,-7.5,-.375],[0,-18.75,0]],connections:[[0,1],[0,2],[1,3],[2,3],[0,4],[0,5],[4,6],[5,6]],size:16},cassiopeia:{stars:[[0,0,0],[7.5,7.5,.375],[15,0,0],[22.5,7.5,-.375],[30,0,0]],connections:[[0,1],[1,2],[2,3],[3,4]],size:15},cygnus:{stars:[[0,0,0],[0,7.5,.375],[0,15,-.375],[-7.5,7.5,0],[7.5,7.5,0]],connections:[[0,1],[1,2],[1,3],[1,4]],size:10}},Ie=[],Ae=new n.YJl;y.add(Ae);const Se=new n.YJl;y.add(Se);const ze=[],Ce=new n.Tap;["./texture/astro1.png","./texture/astro2.png","./texture/astro3.png"].forEach((e=>{Ce.load(e,(e=>ze.push(e)),void 0,(t=>console.error("Nebula load error",e,t)))}));let Ee=!1;function Oe(){const e=new n.LoY,t=[],o=[],i=[],a=new n.Pq0;h.getWorldDirection(a);const s=(new n.Pq0).copy(h.position).add(a.multiplyScalar(30)),l=2*Math.random()*Math.PI,c=Math.acos(2*Math.random()-1),d=30*Math.random(),p=new n.Pq0(d*Math.sin(c)*Math.cos(l),d*Math.sin(c)*Math.sin(l),d*Math.cos(c)),u=s.clone().add(p),m=u.clone().add(new n.Pq0(20*(Math.random()-.5),-4*Math.random(),-2*Math.random())),g=new n.Q1f(16777215),w=new n.Q1f(12316415);for(let e=0;e<40;e++){const n=e/39,a=u.clone().lerp(m,n);t.push(a.x,a.y,a.z),o.push(.1+.3*n);const s=g.clone().lerp(w,n);i.push(s.r,s.g,s.b)}e.setAttribute("position",new n.qtW(t,3)),e.setAttribute("aSize",new n.qtW(o,1)),e.setAttribute("aColor",new n.qtW(i,3));const f=new n.BKk({uniforms:{uOpacity:{value:1}},vertexShader:"\n    precision mediump float;\n    attribute float aSize;\n    attribute vec3 aColor;\n    varying vec3 vColor;\n    void main() {\n      vColor = aColor;\n      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n      gl_PointSize = aSize * (300.0 / -mvPosition.z);\n      gl_Position = projectionMatrix * mvPosition;\n    }\n  ",fragmentShader:"\n    precision mediump float;\n    uniform float uOpacity;\n    varying vec3 vColor;\n    void main() {\n      float d = length(gl_PointCoord - vec2(0.5));\n      if (d > 0.5) discard;\n      gl_FragColor = vec4(vColor, uOpacity);\n    }\n  ",vertexColors:!0,transparent:!0,depthWrite:!1}),v=new n.ONl(e,f);y.add(v),function(e){const t=[];for(let o=0;o<40;o++){const o=new n.Pq0(2*(Math.random()-.5),2*(Math.random()-.5),2*(Math.random()-.5)),i=e.clone().add(o);t.push(i.x,i.y,i.z)}const o=new n.LoY;o.setAttribute("position",new n.qtW(t,3));const i=new n.BH$({color:8965375,size:.07,transparent:!0,opacity:1,depthWrite:!1,blending:n.NTi}),a=new n.ONl(o,i);y.add(a),r.Ay.to(i,{opacity:0,duration:2,ease:"power1.out",onComplete:()=>{y.remove(a),o.dispose(),i.dispose()}})}(m),r.Ay.to(f.uniforms.uOpacity,{value:0,duration:1.2,ease:"power1.out",onComplete:()=>{y.remove(v),e.dispose(),f.dispose()}})}const ke=new n.tBo;let Te;window.addEventListener("mousemove",(function(e){Ve.x=e.clientX/window.innerWidth*2-1,Ve.y=-e.clientY/window.innerHeight*2+1}));let Le=!1,Be=!1,We=!1,Re=!1;function He(e,t){let o=e;for(;o;){if(o===t)return!0;o=o.parent}return!1}Te=new class{constructor(e){this.player=new l.ai(e),this.listeners={},this.videoReady=!1,this.songReady=!1,this.song=null,this._holoSliderTimeUpdateRegistered=!1,this.loopOnEnd=!1,this.player.addListener({onAppReady:e=>{console.log("TextAlive App Ready"),this.appReady=!0,this._emit("appready",e);let t=null,o=0;this.player.addListener({onTimeUpdate:e=>{if(!this.player.video)return;this._emit("timeupdate",e);const i=this.player.video.duration||0;if(!Re)return;if(this.loopOnEnd&&Me.forEach(((t,n)=>{if(!t.returned&&t.startTime>o&&e>=t.startTime){console.log(`æˆ»ã™æ˜Ÿç¾¤ idx=${n} phrase="${t.text}" startTime=${t.startTime}`);const e=this.player.video.findPhrase(t.startTime),o=(e?.endTime||t.startTime+4e3)-t.startTime,i=be(t.text,t.startTime,t.center,o);Me[n]={...t,...i,returned:!0}}})),o=e,"exploringStars"!==me)return;const a=this.player.video.findPhrase(e);a&&a.startTime!==t&&(t=a.startTime,console.log(a.text),function(e,t){console.log("onNewPhrase:",e.text,"at",t);const o=e.startTime,i=(e.endTime||o+4e3)-o,a=be(e.text,t,null,i);(function(e,t=25){console.log("ğŸ’¥ spawnExplosionStars called at",e);const o=[],i=[],a=[],s=[],l=new n.Q1f;for(let r=0;r<t;r++){const t=30,r=new n.Pq0((Math.random()-.5)*t,(Math.random()-.5)*t,(Math.random()-.5)*t),c=(new n.Pq0).copy(e),d=(new n.Pq0).copy(e).add(r);o.push(c.x,c.y,c.z),i.push(d.x,d.y,d.z),l.setHSL(Math.random(),.6,.6+.3*Math.random()),a.push(l.r,l.g,l.b),s.push(.4+.6*Math.random())}const c=new n.LoY;c.setAttribute("position",new n.qtW(o,3)),c.setAttribute("aTarget",new n.qtW(i,3)),c.setAttribute("aColor",new n.qtW(a,3)),c.setAttribute("aSize",new n.qtW(s,1));const d=new n.BKk({transparent:!0,depthTest:!0,depthWrite:!1,blending:n.EZo,vertexColors:!0,uniforms:{uTime:{value:0},uFlicker:{value:0},uOpacity:{value:1}},vertexShader:"\n      attribute vec3 aTarget;\n      attribute vec3 aColor;\n      attribute float aSize;\n      varying vec3 vColor;\n      uniform float uTime;\n      uniform float uFlicker;\n      void main() {\n        vec3 newPos = mix(position, aTarget, uTime);\n        vec4 mvPosition = modelViewMatrix * vec4(newPos, 1.0);\n        gl_Position = projectionMatrix * mvPosition;\n        float flick = 0.1 + 0.3 * sin(uFlicker + aSize * 5.0);\n        float pointSize = aSize * (300.0 / abs(mvPosition.z)) * flick;\n        gl_PointSize = floor(pointSize) + 0.5;\n        vColor = aColor;\n      }\n    ",fragmentShader:"\n      varying vec3 vColor;\n      uniform float uOpacity;\n      void main() {\n        float d = distance(gl_PointCoord, vec2(0.5));\n        float alpha = smoothstep(0.5, 0.4, d) * uOpacity;\n        //if (alpha < 0.01) discard;\n        gl_FragColor = vec4(vColor, alpha);\n      }\n    "}),p=new n.ONl(c,d);p.renderOrder=888,p.frustumCulled=!1,Se.add(p),r.Ay.to(d.uniforms.uTime,{value:1,duration:1,ease:"power2.out"}),r.Ay.to(d.uniforms.uFlicker,{value:2*Math.PI,duration:2,repeat:-1,ease:"linear"})})(a.center),function(e){if(0!==ze.length)for(let t=0;t<4;t++){const t=ze[Math.floor(Math.random()*ze.length)],o=new n.bdM(1,1),i=new n.V9B({map:t,transparent:!0,opacity:0,depthWrite:!1,depthTest:!0,blending:n.EZo,side:n.$EB}),a=new n.eaF(o,i);a.renderOrder=777,a.frustumCulled=!1;const s=50,l=new n.Pq0((Math.random()-.5)*s,(Math.random()-.5)*s,(Math.random()-.5)*s);a.position.copy(e).add(l);const c=10+10*Math.random();a.scale.set(c,c,1),a.userData.lookAtCamera=!0,Se.add(a),r.Ay.to(i,{opacity:.15+.3*Math.random(),duration:1.5,ease:"power2.out"}),r.Ay.to(a.scale,{x:c+8,y:c+8,duration:3,ease:"sine.inOut"})}else console.warn("ğŸŒŒ nebula textures not yet loaded")}(a.center),a.returned=!1,Me.push(a),console.log("   â†’ allLyricData length:",Me.length)}(a,e)),i&&e>=i-100&&(console.log("æ›²çµ‚äº†æ¤œå‡º"),"exploringStars"===me&&(we((()=>{!function(){if("exploringStars"!==me)return;me="resettingCamera",ge=!0,de.enabled=!1,de.minPolarAngle=Math.PI/4,de.maxPolarAngle=Math.PI,h.position.copy(pe),h.quaternion.copy(ue);const e=new n.Pq0(0,0,-.01);e.applyQuaternion(h.quaternion).add(h.position),de.target.copy(e),de.update(),ge=!1,console.log("ã‚«ãƒ¡ãƒ©ã®åˆæœŸçŠ¶æ…‹ã¸ã®ãƒªã‚»ãƒƒãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ")}(),_&&(_.visible=!0),document.getElementById("vignetteOverlay").style.opacity="0",me="viewing",q.visible=!0,A.visible=!0,A.material.opacity=1,z.visible=!0,z.material.opacity=1,B(),L(),de.enabled=!0,fe(),t=null})),this.loopOnEnd=!0))}})},onVideoReady:async e=>{console.log("ğŸ¬ Video Ready",e),this.videoReady=!0;const t=this.player.data.song;let o=0;for(;!t?.name&&o++<10;)console.log("æ›²æƒ…å ±ã‚’å¾…æ©Ÿä¸­...",o),await this._sleep(100);t?.name?(this.songReady=!0,this.song=t,console.log("æ›²å:",t.name)):console.warn("æ›²æƒ…å ±å–å¾—ã«å¤±æ•—"),this._emit("videoready",e)},onPlay:()=>this._emit("play"),onPause:()=>{console.log("â¸ onPause");const e=this.player.timer.position,t=this.player.video?.duration||0;if(this.loopOnEnd&&t&&e>=t-200)return console.log("âº çµ‚äº†ç›´å¾Œã®pauseæ¤œå‡º â†’ å†ç”Ÿå†é–‹"),Me.forEach((e=>e.returned=!1)),void this.restartCurrentSong();this._emit("pause")},onStop:()=>{this._emit("stop")}})}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}_emit(e,t){(this.listeners[e]||[]).forEach((e=>e(t)))}_sleep(e){return new Promise((t=>setTimeout(t,e)))}async loadSong(e){try{console.log("loadSong é–‹å§‹:",e.url),this.player&&this.player.isPlaying&&this.player.requestStop()}catch(e){console.warn("loadSong: stopå¤±æ•—ï¼ˆç„¡è¦–ï¼‰",e.name,e.message)}this.videoReady=!1,this.songReady=!1,this.song=null;try{await this.player.createFromSongUrl(e.url,{video:{beatId:e.beatId,chordId:e.chordId,repetitiveSegmentId:e.repetitiveSegmentId,lyricId:e.lyricId,lyricDiffId:e.lyricDiffId}})}catch(e){throw console.error("createFromSongUrl: ã‚¨ãƒ©ãƒ¼",e.name,e.message),e}let t=0;for(;!this.videoReady&&t++<10;)await this._sleep(300);if(!this.videoReady)throw new Error("videoReady ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ");return!0}async safePlay(e=!0){try{if(!this.player.mediaElement)return void console.warn("mediaElement ãŒæœªå®šç¾©ã§ã™");if(console.log("safePlay å®Ÿè¡Œé–‹å§‹"),this.player.mediaElement.paused)try{this.player.requestPlay()}catch(e){if("AbortError"!==e.name)throw e;console.warn("AbortError: play() ãŒä¸­æ–­ã•ã‚Œã¾ã—ãŸã€‚pause() ãŒå‰²ã‚Šè¾¼ã‚“ã å¯èƒ½æ€§")}if(await this._sleep(200),!this.player.isPlaying&&e){console.warn("å†è©¦è¡Œ: requestPlay");try{this.player.requestPlay()}catch(e){"AbortError"===e.name?console.warn("å†è©¦è¡Œã§ã‚‚ AbortError:",e.message):console.warn("å†è©¦è¡Œã‚‚ä¸­æ–­:",e)}}}catch(e){console.error("requestPlay å®Œå…¨å¤±æ•—",e)}}async safePause(){try{this.player.requestPause()}catch(e){console.error("requestPause ã‚¨ãƒ©ãƒ¼",e)}}async safeStop(){try{this.player.requestStop()}catch(e){console.error("requestStop ã‚¨ãƒ©ãƒ¼",e)}}getPlayer(){return this.player}getCurrentSong(){return this.song}get isPlaying(){return this.player.isPlaying}restartCurrentSong(){this.player&&this.player.video&&(this.player.requestMediaSeek(0),setTimeout((()=>{this.safePlay()}),500))}}({app:{token:"F3s1rJugVHrXdNRN"},mediaElement:document.querySelector("#media")}),se.addEventListener("click",(()=>{const e=se.innerHTML;if(e.includes("Click Here")){if(!Te.player.video||!Be)return;console.log("æœ›é é¡ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"),Ne()}else e.includes("Select Music")&&(console.log("ãƒã‚¤ã‚¯ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"),Le=!0,r.Ay.to(se,{opacity:0,duration:.6,onComplete:()=>{re.visible=!1,Ue(),je(),setTimeout((()=>{ce()}),3e3)}}))})),window.addEventListener("mousedown",(e=>{const t=ke.intersectObjects(y.children,!0);if(t.length>0){const e=t[0].object;if(console.log(e),"init"===me&&!Le&&D&&He(e,D))console.log("ãƒã‚¤ã‚¯ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"),Le=!0,r.Ay.to(se,{opacity:0,duration:.6,onComplete:()=>{re.visible=!1,Ue(),je(),setTimeout((()=>{ce()}),3e3)}});else if("init"===me&&!We&&_&&He(e,_)){if(!Te.player.video||!Be)return;console.log("æœ›é é¡ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"),We=!0,Ne()}else"viewing"!==me&&"init"!==me||!H||!He(e,H)||ie.visible||(console.log("ã‚¢ãƒ³ãƒ—ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"),function(){const e=new n.Pq0;H.getWorldPosition(e),e.y+=2,ie.position.copy(e),ie.visible=!0,ie.scale.set(1e-4,1e-4,1e-4);const t=document.getElementById("ampMessageBillboard");t.style.opacity=0;const o=Object.keys(Ie).length,i=xe.size,a=i/o*100;let s;i>=12?(s="#ffffff",t.style.background="linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet)",t.style.color="#000000"):s=i>=10?"#00ced1":i>=8?"#0000ff":i>=6?"#800080":i>=3?"#ff69b4":"#aaaaaa",i<12&&(t.style.backGround="rgba(0, 0, 0, 0.5)",t.style.color=s),t.style.border=`2px solid ${s}`,t.style.boxShadow=`0 0 20px ${s}`;const l=new n.Q1f(s).getStyle();t.querySelectorAll("p, h2, span, strong").forEach((e=>{e.style.color=l}));let c="";c=100===a?"ã™ã¹ã¦ã®æ˜Ÿåº§ã‚’ç™ºè¦‹ã—ãŸã‚ˆï¼<br>ã‚ãªãŸã¯æ˜Ÿã®é”äººã ï½ï¼":a>=70?"ãŸãã•ã‚“ã®æ˜Ÿåº§ã‚’è¦‹ã¤ã‘ãŸã­ï¼ã‚ã¨å°‘ã—ã§å…¨éƒ¨è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ã‚ˆï¼":a>=30?"ã„ã„æ„Ÿã˜ï¼ã¾ã ã¾ã æ˜Ÿåº§ã¯çœ ã£ã¦ã‚‹ã‚ˆï½ï¼":a>0?"æ˜Ÿåº§ãŒå°‘ã—è¦‹ãˆã¦ããŸã­ï½ï¼<br>ã‚‚ã£ã¨æ¢ã—ã¦ã¿ã‚ˆã†ï¼":"æ˜Ÿåº§ã¯è¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸâ€¦<br>ã‚‚ã†ä¸€å›æ¢ã—ã¦ã¿ã‚ˆã†ï¼",t.innerHTML="viewing"===me?`\n      <div style="text-align: center; line-height: 1.6;">\n        <h2 style="font-size: 22px;">éŠã‚“ã§ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ï¼</h2>\n        <p style="font-size: 16px;">${o}å€‹ä¸­ <strong>${i}å€‹</strong> ã®æ˜Ÿåº§ã‚’è¦‹ã¤ã‘ãŸã‚ˆï¼</p>\n        <p style="font-size: 14px; color: ${s};">${c}</p>\n      </div>\n    `:'\n      <div style="text-align: center; line-height: 1.6;">\n        <h2 style="font-size: 22px; margin-bottom: 10px; color: #aaffff;">\n          æ›²ã‚’é¸ã‚“ã§ã¿ã‚ˆã†\n        </h2>\n        <p style="font-size: 16px; color: #aaffff;">\n          ãƒã‚¤ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ›²ã‚’é¸ã¼ã†<br>\n          é¸ã³çµ‚ã‚ã£ãŸã‚‰æœ›é é¡ã‚’è¦—ã„ã¦ã¿ã‚ˆã†\n        </p>\n        <hr style="border: none; border-top: 1px solid #88ccff; margin: 1em 0;">\n        <p style="font-size: 14px; color: #aaffff;">\n          æ˜Ÿç©ºã«ã¯éš ã‚ŒãŸæ˜Ÿåº§ãŒã‚ã‚‹ã‹ã‚‚â€¦ï¼Ÿ\n        </p>\n      </div>\n    ',r.Ay.to(ie.scale,{x:.005,y:.005,z:.005,duration:.8,ease:"expo.out"}),r.Ay.to(t,{opacity:1,duration:.8,ease:"power2.out"}),r.Ay.to(ie.scale,{x:1e-4,y:1e-4,z:1e-4,delay:5,duration:1.5,ease:"expo.in"}),r.Ay.to(t,{opacity:0,delay:5,duration:1.5,ease:"expo.in",onComplete:()=>{ie.visible=!1}})}())}}));let $e=null,De=null,_e=null,Fe=0;function Ue(){const e=document.querySelector(".slider-wrapper");function t(e){const t=Math.floor(e/1e3);return`${Math.floor(t/60).toString().padStart(2,"0")}:${(t%60).toString().padStart(2,"0")}`}e.innerHTML="",Te._holoSliderTimeUpdateRegistered||(Te._holoSliderTimeUpdateRegistered=!0,Te.on("timeupdate",(e=>{De&&_e&&function(e){const o=Te.player.video;if(!o)return;const n=o.duration,i=e/n*100;De.value=i,_e.textContent=`${t(e)} / ${t(n)}`}(e)}))),Ge.forEach(((t,o)=>{const n=document.createElement("div");n.className="slide",n.dataset.index=o,n.innerHTML=`\n      <div class="slide-content">\n        <img class="jacket" src="${t.image}" alt="${t.title}" />\n        <div class="song-info">\n          <h3 class="song-title">${t.title}</h3>\n          <p class="song-artist">${t.artist}</p>\n          <img src="./texture/barlines.png" class="barlines" alt="bars" />\n        </div>\n      </div>\n      <div class="player-controls">\n        <button class="play-btn">â–¶</button>\n        <input type="range" class="seek-bar" min="0" max="100" value="0" />\n        <span class="time-display">00:00 / 00:00</span>\n      </div>\n    `,e.appendChild(n)}));const o=document.getElementById("slidePrev"),n=document.getElementById("slideNext");async function i(i){Fe=(Fe+i+Ge.length)%Ge.length;const a=e.querySelector(".slide").offsetWidth;r.Ay.to(e,{x:-a*Fe,duration:.3,ease:"power2.out"});const s=e.children[Fe];$e=s.querySelector(".play-btn"),De=s.querySelector(".seek-bar"),_e=s.querySelector(".time-display"),o.classList.add("disabled"),n.classList.add("disabled"),$e.classList.add("disabled"),$e.textContent="...",De.classList.add("disabled"),De.value=0,_e.textContent="èª­ã¿è¾¼ã¿ä¸­...",await Te.loadSong(Ge[Fe]),o.classList.remove("disabled"),n.classList.remove("disabled"),$e.classList.remove("disabled"),$e.textContent="â–¶",De.value=0;const l=Te.player.video?.duration||0;_e.textContent=`00:00 / ${t(l)}`,$e.onclick=async()=>{Te.videoReady&&(Te.isPlaying?(await Te.safePause(),$e.textContent="â–¶",De.classList.add("disabled"),console.log("[play button] Paused.")):(await Te.safePlay(),$e.textContent="â¸",De.classList.remove("disabled"),console.log("[play button] Playing.")))},De.oninput=()=>{const e=Te.player.video;if(!e)return;const t=De.value/100*e.duration;console.log(`[seekBar.input] Requesting seek to: ${t.toFixed(0)}ms`),Te.player.requestMediaSeek(t)}}o.addEventListener("click",(()=>i(-1))),n.addEventListener("click",(()=>i(1))),i(0)}function je(){const e=new n.Pq0;D.getWorldPosition(e),e.y+=2.1,oe.position.copy(e),oe.visible=!0,oe.scale.set(1e-4,1e-4,1e-4);const t=document.getElementById("hologramBillboard");t.style.opacity=0,r.Ay.to(oe.scale,{x:.005,y:.005,z:.005,duration:.8,ease:"expo.out"}),r.Ay.to(t,{opacity:1,duration:.8,ease:"power2.out"})}function Ne(){if("init"!==me)return;if(!Te.songReady)return;Te.safePause(),r.Ay.to(se,{opacity:0,duration:.6,onComplete:()=>{re.visible=!1}}),me="telescopeZooming";const e=_.position.clone(),t=h.position.clone(),o=new n.ubm;o.position.copy(t),o.lookAt(e.x+1,e.y,e.z);const i=o.quaternion.clone(),a=h.quaternion.clone();r.Ay.to(h.position,{x:e.x,y:e.y+1.2,z:e.z+.6,duration:2,ease:"power2.inOut"}),r.Ay.to({t:0},{t:1,duration:2,ease:"power2.inOut",onUpdate(){let e=this.targets()[0].t;h.quaternion.copy(a).slerp(i,e);const t=new n.Pq0(0,0,-.01).applyQuaternion(h.quaternion).add(h.position);de.target.copy(t)},onComplete(){const e=new n.Pq0(0,0,-.01);e.applyQuaternion(h.quaternion).add(h.position),de.target.copy(e),me="fadingOut",we((async()=>{_&&(_.visible=!1),oe.visible=!1,function({count:e=10,minDistance:t=40,cameraDistance:o=55,minPolarAngle:i=2*Math.PI/14,maxPolarAngle:a=4*Math.PI/8}){Ie.length=0;const s=Object.keys(qe),r=[],l=new n.Pq0;for(h&&h.getWorldDirection(l);r.length<e&&s.length>0;){const e=Math.floor(Math.random()*s.length),l=s.splice(e,1)[0],c=qe[l];let d=0;for(;d<300;){const e=2*Math.random()*Math.PI,s=Math.acos(2*Math.random()-1),p=new n.Pq0(Math.sin(s)*Math.cos(e),Math.cos(s),Math.sin(s)*Math.sin(e)),u=Math.acos(p.y);if(u<i||u>a){d++;continue}const y=h?h.position.clone().add(p.multiplyScalar(o)):p.multiplyScalar(o);if(!Ie.some((e=>e.position.distanceTo(y)<t+c.size))){Ie.push({name:l,data:c,position:y}),r.push(l);break}d++}}Ie.length<e&&console.log(`âš ï¸ ${e}å€‹ä¸­${Ie.length}å€‹ã—ã‹é…ç½®ã§ãã¾ã›ã‚“ã§ã—ãŸ`),console.log("ğŸŒŒ Placed constellation targets:",Ie)}({count:13,minDistance:20,cameraDistance:55}),ve(),de.enabled=!0,de.enableZoom=!1,de.enablePan=!1,de.enableRotate=!0,de.minPolarAngle=3*Math.PI/7,de.maxPolarAngle=7*Math.PI/8,h.position.set(_.position.x,2,_.position.z),de.target.set(_.position.x,2,_.position.z-.1),de.update(),document.getElementById("vignetteOverlay").style.opacity="1",q.visible=!1,B(),L(!0),setTimeout((()=>{r.Ay.to(A.material,{opacity:0,duration:1.2,onComplete:()=>{A.visible=!1}}),r.Ay.to(z.material,{opacity:0,duration:1.2,onComplete:()=>{z.visible=!1}})}),1e4),fe((()=>{me="exploringStars"})),await Te._sleep(1500),Te.restartCurrentSong(),Re=!0}))}})}let Ye=!1,Qe=new n.PTz;h.quaternion.clone(Qe),de.addEventListener("start",(()=>{Ye=!0})),de.addEventListener("change",(()=>{Ye&&(h.quaternion.equals(Qe)||(document.body.style.cursor="grabbing"),Qe.copy(h.quaternion))})),de.addEventListener("end",(()=>{Ye=!1,document.body.style.cursor="grab"})),Te.on("appready",(()=>{console.log("âœ… ã‚¢ãƒ—ãƒªæº–å‚™å®Œäº†")})),Te.on("videoready",(()=>{console.log("âœ… ãƒ“ãƒ‡ã‚ªæº–å‚™å®Œäº†")})),Te.on("play",(()=>{const e=Te.getCurrentSong();e&&console.log(`â–¶ï¸ å†ç”Ÿä¸­: ${e.name} by ${e.artist?.name??"ä¸æ˜"}`)})),Te.on("pause",(()=>{console.warn("ğŸ›‘ safePause å‘¼ã³å‡ºã—ï¼ˆã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ï¼‰"),console.trace(),console.log("pause")})),Te.on("stop",(()=>{console.log("stop")}));const Ge=[{title:"ã‚¹ãƒˆãƒªãƒ¼ãƒˆãƒ©ã‚¤ãƒˆ",artist:"åŠ è³€(ãƒã‚®ã‚·ãƒ£ãƒ¯ãƒ¼P)",url:"https://piapro.jp/t/ULcJ/20250205120202",image:"./texture/cover.png",beatId:4694275,chordId:2830730,repetitiveSegmentId:2946478,lyricId:67810,lyricDiffId:20654},{title:"ã‚¢ãƒªãƒ•ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",artist:"é›¨è‰¯ Amala",url:"https://piapro.jp/t/SuQO/20250127235813",image:"./texture/cover.png",beatId:4694276,chordId:2830731,repetitiveSegmentId:2946479,lyricId:67811,lyricDiffId:20655},{title:"ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒãƒ«ãƒ€ã‚¤ãƒ–",artist:"99piano",url:"https://piapro.jp/t/Ppc9/20241224135843",image:"./texture/cover.png",beatId:4694277,chordId:2830732,repetitiveSegmentId:2946480,lyricId:67812,lyricDiffId:20656},{title:"ãƒãƒ­ãƒ¼ã€ãƒ•ã‚§ãƒ«ãƒŸã€‚",artist:"ã©ï½ã±ã¿ã‚“",url:"https://piapro.jp/t/oTaJ/20250204234235",image:"./texture/cover.png",beatId:4694278,chordId:2830733,repetitiveSegmentId:2946481,lyricId:67813,lyricDiffId:20657},{title:"ãƒ‘ãƒ¬ãƒ¼ãƒ‰ãƒ¬ã‚³ãƒ¼ãƒ‰",artist:"ãã•ã‚‰",url:"https://piapro.jp/t/GCgy/20250202202635",image:"./texture/cover.png",beatId:4694279,chordId:2830734,repetitiveSegmentId:2946482,lyricId:67814,lyricDiffId:20658},{title:"ãƒ­ãƒ³ãƒªãƒ¼ãƒ©ãƒ³",artist:"æµ·é¢¨å¤ªé™½",url:"https://piapro.jp/t/CyPO/20250128183915",image:"./texture/cover.png",beatId:4694280,chordId:2830735,repetitiveSegmentId:2946483,lyricId:67815,lyricDiffId:20659}],Ve=new n.I9Y;!function e(){if(requestAnimationFrame(e),function(){h.getWorldDirection(J),J.y=0,J.normalize(),X.crossVectors(J,h.up).normalize(),Z.set(0,0,0),(Q.ArrowUp||Q.w)&&Z.add(G.copy(J).multiplyScalar(.04)),(Q.ArrowDown||Q.s)&&Z.add(G.copy(J).multiplyScalar(-.04)),(Q.ArrowLeft||Q.a)&&Z.add(G.copy(X).multiplyScalar(-.04)),(Q.ArrowRight||Q.d)&&Z.add(G.copy(X).multiplyScalar(.04));const e=V.copy(h.position).add(Z).add(K);if(!(e.distanceTo(ee)>4)){for(const t of N)if(t.containsPoint(e))return;h.position.add(Z),de.target.add(Z)}}(),E(),function(){if(!re.visible||!le)return;const e=new n.Pq0;le.getWorldPosition(e),re.position.set(e.x,e.y+1.7,e.z),re.lookAt(h.position)}(),ke.setFromCamera(Ve,h),D&&_&&H){const e=[];D&&!Le&&e.push(D),_&&!We&&Le&&Be&&e.push(_),H&&!ie.visible&&e.push(H);const t=ke.intersectObjects(e,!0);document.body.style.cursor=t.length>0?"pointer":"grab"}const t=y.getObjectByName("starSphere");t&&(t.rotation.y+=2e-5),oe.visible&&oe.lookAt(h.position),ie.visible&&ie.lookAt(h.position),Pe.children.forEach((e=>{e.lookAt(h.position)})),Se.children.forEach((e=>{e.userData.lookAtCamera&&e.lookAt(h.position)})),ge||de.update(),p.clear(),p.render(y,h),p.clearDepth(),p.render(m,g),u.render(y,h)}(),window.addEventListener("resize",(()=>{h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),u.setSize(window.innerWidth,window.innerHeight),g.left=-window.innerWidth/2,g.right=window.innerWidth/2,g.top=window.innerHeight/2,g.bottom=-window.innerHeight/2,g.updateProjectionMatrix(),p.setSize(window.innerWidth,window.innerHeight),k&&(B(),L("center"===T))})),window.onerror=function(e,t,o,n,i){console.error("ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ã‚­ãƒ£ãƒƒãƒ:",{message:e,source:t,lineno:o,colno:n,error:i})},window.addEventListener("unhandledrejection",(e=>{e.reason&&"AbortError"===e.reason.name&&e.preventDefault()}))}},e=>{e.O(0,[300],(()=>e(e.s=866))),e.O()}]);