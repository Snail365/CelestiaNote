"use strict";(self.webpackChunkcelestianote=self.webpackChunkcelestianote||[]).push([[792],{866:(e,t,o)=>{var n=o(922),i=o(437),a=o(24),r=o(411),s=o(880),l=o(977),d=o(92),c=o(307),p=o(804),u=o(383);console.log("THREE.REVISION:",n.sPf);const h=document.getElementById("sceneCanvas"),m=new i.JeP({canvas:h,antialias:!0,preserveDrawingBuffer:!0,alpha:!0});m.setClearColor(0,0),m.autoClear=!1,m.setSize(window.innerWidth,window.innerHeight),m.outputColorSpace=n.er$,document.body.appendChild(m.domElement);const y=new r.a0;y.domElement.classList.add("css3d-renderer"),y.setSize(window.innerWidth,window.innerHeight),y.domElement.style.position="absolute",y.domElement.style.top=0,document.body.appendChild(y.domElement);const w=new n.Z58,g=new n.ubm(75,window.innerWidth/window.innerHeight,.1,100);g.position.set(0,1.6,5),(new n.zgK).set(1);const f=new p.A(w,g),v=new u.C(new n.I9Y(window.innerWidth,window.innerHeight),1.5,.4,.85),P=new c.s(m);P.addPass(f),P.addPass(v);const M=new n.Z58,b=new n.qUd(-window.innerWidth/2,window.innerWidth/2,window.innerHeight/2,-window.innerHeight/2,.1,100);b.position.z=10;const I=new n.$p8(16777215,1.5);w.add(I);const S=new n.Tap,q=S.load("./Model/markup_ARROW.png"),x=S.load("./Model/markup_WASD.png"),C=S.load("./Model/Mouse.png"),A=S.load("./Model/Mouse_Arrow.png"),O=new n.RoJ({map:q,transparent:!0,opacity:1}),E=new n.kxk(O);E.scale.set(80,60,1),E.position.set(-window.innerWidth/2+20,-window.innerHeight/2+20,1),M.add(E);const k=new n.RoJ({map:C,transparent:!0,opacity:1}),z=new n.kxk(k);z.scale.set(35,35,1),z.position.set(-window.innerWidth/2+130,-window.innerHeight/2+40,1),M.add(z);const T=new n.RoJ({map:A,transparent:!0,opacity:1}),L=new n.kxk(T);L.scale.set(25,25,1),L.position.set(-window.innerWidth/2+130,-window.innerHeight/2+40,1),M.add(L);let W=!1;function B(){E.position.set(b.left+60,b.bottom+50,1)}setInterval((()=>{O.map=W?x:q,O.needsUpdate=!0,W=!W}),1e3);let R,_=null,H=null;function D(e=!1){if(_)return;let t,o;H=e?"center":"left",e?(t=(b.left+b.right)/2,o=b.bottom+40):(t=b.left+130,o=b.bottom+40),z.position.set(t,o,1),L.position.set(t+30,o+10,1),z.material.rotation=0,L.material.rotation=-Math.PI/16,_=s.Ay.timeline({repeat:-1,yoyo:!0,ease:"circ.inOut",defaults:{duration:2}}),_.to(z.position,{x:t+30,y:o+10},0),_.to(z.material,{rotation:-Math.PI/16},0),_.to(L.position,{x:t,y:o+5},0),_.to(L.material,{rotation:3*Math.PI/5},0)}function $(){_&&(_.kill(),_=null,z.material.rotation=0,L.material.rotaation=-Math.PI/16,B())}D(),(new d.B).load("./Model/FloorModel/floor.glb",(function(e){R=e.scene,R.scale.set(.25,.25,.25),R.position.set(0,0,5),w.add(R),console.log("‚úÖ GLB„É¢„Éá„É´Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü")}),void 0,(function(e){console.error("‚ùå GLBË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",e)}));const j=[{position:new n.Pq0(2.8,0,4.6),rotation:new n.O9p(0,Math.PI/5,-Math.PI/5),scale:new n.Pq0(.125,.125,.125)},{position:new n.Pq0(-2.9,0,4),rotation:new n.O9p(-Math.PI/4,Math.PI/9,0),scale:new n.Pq0(.1,.1,.1)},{position:new n.Pq0(1.5,0,7),rotation:new n.O9p(0,Math.PI/3,-Math.PI/6),scale:new n.Pq0(.125,.125,.125)},{position:new n.Pq0(-2.5,0,6.5),rotation:new n.O9p(0,-Math.PI/2,Math.PI/5),scale:new n.Pq0(.11,.11,.11)},{position:new n.Pq0(.5,0,6),rotation:new n.O9p(-Math.PI/7,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.04,.04,.04)},{position:new n.Pq0(.23,0,4),rotation:new n.O9p(-Math.PI/3,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.05,.05,.05)},{position:new n.Pq0(2.2,0,1.7),rotation:new n.O9p(-Math.PI/7,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.08,.08,.08)},{position:new n.Pq0(-2.2,0,2.6),rotation:new n.O9p(-2*Math.PI/5,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.06,.06,.06)},{position:new n.Pq0(-2.5,0,7.1),rotation:new n.O9p(-Math.PI/8,-Math.PI/3,Math.PI/3),scale:new n.Pq0(.05,.05,.05)},{position:new n.Pq0(-1.2,0,6.1),rotation:new n.O9p(-Math.PI/7,-Math.PI/4,-Math.PI/3),scale:new n.Pq0(.05,.05,.05)},{position:new n.Pq0(2.2,0,7.5),rotation:new n.O9p(-Math.PI/6,-Math.PI/7,-Math.PI/5),scale:new n.Pq0(.05,.05,.05)},{position:new n.Pq0(1,0,8.5),rotation:new n.O9p(-Math.PI/7,-Math.PI/4,Math.PI/8),scale:new n.Pq0(.08,.08,.08)},{position:new n.Pq0(-.9,0,6.3),rotation:new n.O9p(-Math.PI/7,-Math.PI/2,Math.PI/3),scale:new n.Pq0(.07,.07,.07)},{position:new n.Pq0(-1,0,8),rotation:new n.O9p(0,-Math.PI/3,3*Math.PI/8),scale:new n.Pq0(.17,.17,.17)},{position:new n.Pq0(-.4,0,7.6),rotation:new n.O9p(0,-Math.PI/3,Math.PI/4),scale:new n.Pq0(.09,.09,.09)},{position:new n.Pq0(-.5,0,1.5),rotation:new n.O9p(Math.PI/4,Math.PI/7,0),scale:new n.Pq0(.1,.1,.1)}];let F,N,U;(new d.B).load("./Model/StarRightModel/StarRight.glb",(function(e){let t=e.scene;j.forEach((e=>{const o=t.clone();o.position.copy(e.position),o.scale.copy(e.scale),w.add(o)}))})),(new d.B).load("./Model/AmpModel/amp.glb",(function(e){F=e.scene,F.scale.set(.24,.24,.24),F.position.set(-3,0,5.5),F.rotation.y=3*Math.PI/5,w.add(F),V(F),console.log("‚úÖ GLB„É¢„Éá„É´Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü")}),void 0,(function(e){console.error("‚ùå GLBË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",e)})),(new d.B).load("./Model/TitleModel/Title.glb",(function(e){N=e.scene,N.scale.set(.5,.5,.5),N.position.set(2.5,0,6),N.rotation.y=2*-Math.PI/3,w.add(N),V(N),console.log("‚úÖ GLB„É¢„Éá„É´Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü")}),void 0,(function(e){console.error("‚ùå GLBË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",e)})),(new d.B).load("./Model/MicModel/mic.glb",(function(e){U=e.scene,U.scale.set(.12,.11,.12),U.position.set(1.25,0,2.5),U.rotation.y=-Math.PI/4,w.add(U),V(U),console.log("‚úÖ GLB„É¢„Éá„É´Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü"),ee=U,X.visible=!0,Q.textContent="Click Mic",Q.style.opacity=0,s.Ay.to(Q,{opacity:1,duration:.6}),console.log("mic world position:",U.position),console.log("clickHereObj position:",X.position)}),void 0,(function(e){console.error("‚ùå GLBË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",e)}));const Y=3;let G=0;function V(e){xe.push(e),G++,G===Y&&(function(){Ce.length=0;for(const e of xe){if(!e)continue;const t=(new n.NRn).setFromObject(e);Ce.push(t)}}(),console.log("‚úÖ „Åô„Åπ„Å¶„ÅÆ„É¢„Éá„É´Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü ‚Üí Ë°ùÁ™Å„Éú„ÉÉ„ÇØ„ÇπÂàùÊúüÂåñ"))}const J=document.getElementById("hologramBillboard"),K=new r.on(J);J.style.display="block",K.scale.set(.005,.005,.005),K.visible=!1,w.add(K);const Z=document.createElement("div");Z.id="clickHereContainer";const Q=document.createElement("div");Q.id="clickHerePrompt",Z.appendChild(Q);const X=new r.on(Z);Q.style.display="block",X.scale.set(.01,.01,.01),X.position.set(0,0,0),w.add(X);let ee=null;const te=new a.N(g,m.domElement);te.enableDamping=!0,te.dampingFactor=.07,te.enabled=!0,te.enablePan=!1,te.enableZoom=!1,te.target.set(0,1.6,4.9);const oe=g.position.clone(),ne=g.quaternion.clone(),ie=te.target.clone();console.log(ie),console.log(g.position),console.log("ÂàùÊúü„ÅÆ„Ç´„É°„É©Quaternion:",ne);let ae,re,se="init",le=!1;function de(e){const t=document.getElementById("fadeOverlay");t.style.pointerEvents="auto",t.style.opacity="1",setTimeout((()=>e&&e()),1e3)}function ce(e){const t=document.getElementById("fadeOverlay");t.style.opacity="0",setTimeout((()=>{t.style.pointerEvents="none",e&&e()}),1e3)}function pe(){re&&w.remove(re);const e=new n.Gu$(50,64,64),t=new n.V9B({color:16,side:n.hsX,transparent:!0,opacity:1,depthWrite:!1,depthTest:!0});re=new n.eaF(e,t),re.renderOrder=-1,re.frustumCulled=!1,w.add(re);const o=new n.LoY,i=[],a=[],r=new n.Q1f;for(let e=0;e<1500;e++){const e=49.5,t=2*Math.random()*Math.PI,o=Math.acos(2*Math.random()-1),n=e*Math.sin(o)*Math.cos(t),s=e*Math.sin(o)*Math.sin(t),l=e*Math.cos(o);i.push(n,s,l),r.setHSL(Math.random(),1,.7+.3*Math.random()),a.push(r.r,r.g,r.b)}o.setAttribute("position",new n.qtW(i,3)),o.setAttribute("color",new n.qtW(a,3));const l=new n.BH$({size:.2,vertexColors:!0,transparent:!0,opacity:.8}),d=new n.ONl(o,l);return re.add(d),s.Ay.to(l,{opacity:.3+.5*Math.random(),duration:2+2*Math.random(),yoyo:!0,repeat:-1,ease:"sine.inOut"}),console.log("üåå ÊòüÁ©∫„ÅåÁîüÊàê„Åï„Çå„Åæ„Åó„Åü"),d.name="starSphere",d}(new d.B).load("./Model/TeleScopeModel/Telescope.glb",(function(e){ae=e.scene,ae.scale.set(.5,.5,.5),ae.position.set(-1.5,0,2.5),ae.rotation.y=Math.PI,w.add(ae),xe.push(ae),console.log("‚úÖ GLB„É¢„Éá„É´Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü")}),void 0,(function(e){console.error("‚ùå GLBË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",e)})),pe();class ue{constructor(e){this.player=new l.ai(e),this.listeners={},this.videoReady=!1,this.songReady=!1,this.song=null,this._holoSliderTimeUpdateRegistered=!1,this.loopOnEnd=!1,this.player.addListener({onAppReady:e=>{console.log("TextAlive App Ready"),this.appReady=!0,this._emit("appready",e);let t=null,o=0;this.player.addListener({onTimeUpdate:e=>{if(!this.player.video)return;this._emit("timeupdate",e);const i=this.player.video.duration||0;if(!ze)return;if(this.loopOnEnd&&me.forEach(((t,n)=>{!t.returned&&t.startTime>o&&e>=t.startTime&&(console.log(`  ‚Ü≥ Êàª„ÅôÊòüÁæ§ idx=${n} phrase="${t.text}" startTime=${t.startTime}`),function(e){if(!e||!e.points||!e.keepIndices)return;const t=e.points.geometry.getAttribute("aSize");if(e.points.layers.enable(1),e.keepIndices.forEach((e=>{const o=t.getX(e),n={value:o};s.Ay.to(n,{value:1.5*o,duration:.6,yoyo:!0,repeat:3,ease:"sine.inOut",onUpdate:()=>{t.setX(e,n.value),t.needsUpdate=!0}})})),e.constellationLines){const t=e.constellationLines.material;s.Ay.fromTo(t,{opacity:1},{opacity:0,duration:.6,yoyo:!0,repeat:3,ease:"sine.inOut",onComplete:()=>{t.opacity=1,e.points.layers.disable(1)}})}}(me[n]),t.returned=!0)})),o=e,"exploringStars"!==se)return;const a=this.player.video.findPhrase(e);a&&a.startTime!==t&&(t=a.startTime,console.log(a.text),function(e,t){console.log("‚ñ∂ onNewPhrase:",e.text,"at",t);const o=function(e,t){const{coords:o,canvasSize:i}=function(e,{canvasSize:t=1024,xStep:o=2,yStep:n=1,threshold:i=128,font:a='bold 48px "Noto Sans JP", Meiryo, sans-serif'}={}){const r=document.createElement("canvas");r.width=r.height=t;const s=r.getContext("2d");s.clearRect(0,0,t,t),s.fillStyle="white",s.font=a,s.textAlign="center",s.textBaseline="middle",s.fillText(e,t/2,t/2);const l=s.getImageData(0,0,t,t).data,d=[];for(let e=0;e<t;e+=n)for(let n=0;n<t;n+=o)l[4*(e*t+n)+3]>i&&d.push({x:n,y:e});return{coords:d,canvasSize:t}}(e,{canvasSize:1024,xStep:2,yStep:1,threshold:128,font:'bold 48px "Noto Sans JP", Meiryo'}),a=function(e,{canvasSize:t,scale:o=120}){return e.map((({x:e,y:i})=>{const a=(e/t-.5)*o,r=(.5-i/t)*o,s=1.5*(Math.random()-.5);return new n.Pq0(a,r,s)}))}(o,{canvasSize:i,scale:120}),r=a.length,l=Math.min(6,r),d=[];for(;d.length<l;){const e=Math.floor(Math.random()*r);d.includes(e)||d.push(e)}const c=function(e,{sizeRange:t=[.1,.3],colorHueRange:o=[0,1],keepIndices:i=[]}={}){const a=e.length,r=[],s=[],l=[],d=[];for(let c=0;c<a;c++){r.push(...e[c].toArray());const a=Math.random()*(o[1]-o[0])+o[0],p=(new n.Q1f).setHSL(a,1,.7);s.push(p.r,p.g,p.b);const u=i.includes(c),h=2.5*Math.random()*(t[1]-t[0])+t[0],m=u?2*h:h;l.push(m),d.push(u?1:0)}const c=new n.LoY;c.setAttribute("position",new n.qtW(r,3)),c.setAttribute("aColor",new n.qtW(s,3)),c.setAttribute("aSize",new n.qtW(l,1)),c.setAttribute("aKeep",new n.qtW(d,1));const p=new n.BKk({transparent:!0,blending:n.EZo,depthTest:!0,depthWrite:!1,uniforms:{uTime:{value:0},uOpacity:{value:0}},vertexShader:"\n      attribute float aSize;\n      attribute vec3 aColor;\n      attribute float aKeep;\n      varying vec3 vColor;\n      varying float vKeep;\n      uniform float uTime;\n      void main(){\n        vColor = aColor;\n        vKeep = aKeep;\n        vec4 mv = modelViewMatrix * vec4(position,1.0);\n        gl_PointSize = aSize * (300.0 / -mv.z) * clamp(uTime,0.0,1.0);\n        gl_Position = projectionMatrix * mv;\n      }",fragmentShader:"\n      varying vec3 vColor;\n      varying float vKeep;\n      uniform float uOpacity;\n      void main(){\n        float d = distance(gl_PointCoord, vec2(0.5));\n        if(d>0.5) discard;\n        float alpha = mix(uOpacity, 1.0, vKeep);\n        gl_FragColor = vec4(vColor, alpha);\n      }"});return new n.ONl(c,p)}(a,{sizeRange:[.1,.25],colorHueRange:[0,1],keepIndices:d}),p=new n.Pq0;g.getWorldDirection(p);const u=g.position.clone().add(p.multiplyScalar(50));c.position.copy(u),he.add(c);const h=c.material;return s.Ay.to(h.uniforms.uTime,{value:1,duration:1,ease:"power2.out"}),s.Ay.to(h.uniforms.uOpacity,{value:1,duration:.8,ease:"power2.out",onComplete(){s.Ay.to(h.uniforms.uOpacity,{value:0,delay:8,duration:1,ease:"power2.out",onComplete(){!function({points:e,keepIndices:t,center:o,text:i,startTime:a}){const r=e.geometry.getAttribute("position"),l=e.worldToLocal(o.clone()),d=t.map((()=>{const e=new n.Pq0(13*(Math.random()-.5),13*(Math.random()-.5),13*(Math.random()-.5));return l.clone().add(e)})),c=[];t.forEach(((o,l)=>{const p=new n.Pq0(r.getX(o),r.getY(o),r.getZ(o)),u=d[l];s.Ay.to(p,{x:u.x,y:u.y,z:u.z,duration:2,ease:"power2.out",onUpdate:()=>{r.setXYZ(o,p.x,p.y,p.z),r.needsUpdate=!0},onComplete:()=>{if(l===t.length-1){t.forEach((t=>{const o=new n.Pq0(r.getX(t),r.getY(t),r.getZ(t));c.push(e.localToWorld(o.clone()))}));const o=function(e,t=.7){const o=[];for(let i=0;i<e.length-1;i++){const a=e[i],r=e[i+1],s=(new n.Pq0).subVectors(r,a).normalize(),l=a.clone().add(s.clone().multiplyScalar(t)),d=r.clone().add(s.clone().multiplyScalar(-t));o.push(l,d)}const i=(new n.LoY).setFromPoints(o),a=new n.mrM({color:8965375,transparent:!0,opacity:.7,depthTest:!0,depthWrite:!1});return new n.DXC(i,a)}(c,.7);w.add(o);const s=me.find((e=>e.text===i&&e.startTime===a));s&&(s.keepIndices=t,s.constellationLines=o)}}})}))}({text:e,startTime:t,center:u,points:c,keepIndices:d})}})}}),{text:e,startTime:t,center:u,points:c}}(e.text,t);(function(e,t=25){console.log("üí• spawnExplosionStars called at",e);const o=[],i=[],a=[],r=[],l=new n.Q1f;for(let s=0;s<t;s++){const t=30,s=new n.Pq0((Math.random()-.5)*t,(Math.random()-.5)*t,(Math.random()-.5)*t),d=(new n.Pq0).copy(e),c=(new n.Pq0).copy(e).add(s);o.push(d.x,d.y,d.z),i.push(c.x,c.y,c.z),l.setHSL(Math.random(),.6,.6+.3*Math.random()),a.push(l.r,l.g,l.b),r.push(.4+.6*Math.random())}const d=new n.LoY;d.setAttribute("position",new n.qtW(o,3)),d.setAttribute("aTarget",new n.qtW(i,3)),d.setAttribute("aColor",new n.qtW(a,3)),d.setAttribute("aSize",new n.qtW(r,1));const c=new n.BKk({transparent:!0,depthTest:!0,depthWrite:!1,blending:n.EZo,vertexColors:!0,uniforms:{uTime:{value:0},uFlicker:{value:0},uOpacity:{value:1}},vertexShader:"\n      attribute vec3 aTarget;\n      attribute vec3 aColor;\n      attribute float aSize;\n      varying vec3 vColor;\n      uniform float uTime;\n      uniform float uFlicker;\n      void main() {\n        vec3 newPos = mix(position, aTarget, uTime);\n        vec4 mvPosition = modelViewMatrix * vec4(newPos, 1.0);\n        gl_Position = projectionMatrix * mvPosition;\n        float flick = 0.1 + 0.3 * sin(uFlicker + aSize * 5.0);\n        float pointSize = aSize * (300.0 / abs(mvPosition.z)) * flick;\n        gl_PointSize = floor(pointSize) + 0.5;\n        vColor = aColor;\n      }\n    ",fragmentShader:"\n      varying vec3 vColor;\n      uniform float uOpacity;\n      void main() {\n        float d = distance(gl_PointCoord, vec2(0.5));\n        float alpha = smoothstep(0.5, 0.4, d) * uOpacity;\n        //if (alpha < 0.01) discard;\n        gl_FragColor = vec4(vColor, alpha);\n      }\n    "}),p=new n.ONl(d,c);p.renderOrder=888,p.frustumCulled=!1,ye.add(p),s.Ay.to(c.uniforms.uTime,{value:1,duration:1,ease:"power2.out"}),s.Ay.to(c.uniforms.uFlicker,{value:2*Math.PI,duration:2,repeat:-1,ease:"linear"})})(o.center),function(e){if(0!==we.length)for(let t=0;t<4;t++){const t=we[Math.floor(Math.random()*we.length)],o=new n.bdM(1,1),i=new n.V9B({map:t,transparent:!0,opacity:0,depthWrite:!1,depthTest:!0,blending:n.EZo,side:n.$EB}),a=new n.eaF(o,i);a.renderOrder=777,a.frustumCulled=!1;const r=30,l=new n.Pq0((Math.random()-.5)*r,(Math.random()-.5)*r,(Math.random()-.5)*r);a.position.copy(e).add(l);const d=8+6*Math.random();a.scale.set(d,d,1),a.userData.lookAtCamera=!0,ye.add(a),s.Ay.to(i,{opacity:.4+.4*Math.random(),duration:1.5,ease:"power2.out"}),s.Ay.to(a.scale,{x:d+8,y:d+8,duration:3,ease:"sine.inOut"})}else console.warn("üåå nebula textures not yet loaded")}(o.center),o.returned=!1,me.push(o),console.log("   ‚Üí allLyricData length:",me.length)}(a,e)),i&&e>=i-100&&(console.log("Êõ≤ÁµÇ‰∫ÜÊ§úÂá∫"),"exploringStars"===se&&(de((()=>{!function(){if("exploringStars"!==se)return;se="resettingCamera",le=!0,te.enabled=!1,te.minPolarAngle=Math.PI/4,te.maxPolarAngle=Math.PI,g.position.copy(oe),g.quaternion.copy(ne);const e=new n.Pq0(0,0,-.01);e.applyQuaternion(g.quaternion).add(g.position),te.target.copy(e),te.update(),le=!1,console.log("„Ç´„É°„É©„ÅÆÂàùÊúüÁä∂ÊÖã„Å∏„ÅÆ„É™„Çª„ÉÉ„Éà„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü")}(),ae&&(ae.visible=!0),document.getElementById("vignetteOverlay").style.opacity="0",se="viewing",E.visible=!0,z.visible=!0,z.material.opacity=1,L.visible=!0,L.material.opacity=1,$(),D(),te.enabled=!0,ce(),t=null})),this.loopOnEnd=!0))}})},onVideoReady:async e=>{console.log("üé¨ Video Ready",e),this.videoReady=!0;const t=this.player.data.song;let o=0;for(;!t?.name&&o++<10;)console.log("Êõ≤ÊÉÖÂ†±„ÇíÂæÖÊ©ü‰∏≠...",o),await this._sleep(100);t?.name?(this.songReady=!0,this.song=t,console.log("Êõ≤Âêç:",t.name)):console.warn("Êõ≤ÊÉÖÂ†±ÂèñÂæó„Å´Â§±Êïó"),this._emit("videoready",e)},onPlay:()=>this._emit("play"),onPause:()=>{console.log("‚è∏ onPause");const e=this.player.timer.position,t=this.player.video?.duration||0;if(this.loopOnEnd&&t&&e>=t-200)return console.log("‚è∫ ÁµÇ‰∫ÜÁõ¥Âæå„ÅÆpauseÊ§úÂá∫ ‚Üí ÂÜçÁîüÂÜçÈñã"),me.forEach((e=>e.returned=!1)),void this.restartCurrentSong();this._emit("pause")},onStop:()=>{this._emit("stop")}})}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}_emit(e,t){(this.listeners[e]||[]).forEach((e=>e(t)))}_sleep(e){return new Promise((t=>setTimeout(t,e)))}async loadSong(e){try{console.log("loadSong ÈñãÂßã:",e.url),this.player&&this.player.isPlaying&&this.player.requestStop()}catch(e){console.warn("loadSong: stopÂ§±ÊïóÔºàÁÑ°Ë¶ñÔºâ",e.name,e.message)}this.videoReady=!1,this.songReady=!1,this.song=null;try{await this.player.createFromSongUrl(e.url,{video:{beatId:e.beatId,chordId:e.chordId,repetitiveSegmentId:e.repetitiveSegmentId,lyricId:e.lyricId,lyricDiffId:e.lyricDiffId}})}catch(e){throw console.error("createFromSongUrl: „Ç®„É©„Éº",e.name,e.message),e}let t=0;for(;!this.videoReady&&t++<10;)await this._sleep(300);if(!this.videoReady)throw new Error("videoReady „Çø„Ç§„É†„Ç¢„Ç¶„Éà");return!0}async safePlay(e=!0){try{if(!this.player.mediaElement)return void console.warn("mediaElement „ÅåÊú™ÂÆöÁæ©„Åß„Åô");if(console.log("safePlay ÂÆüË°åÈñãÂßã"),this.player.mediaElement.paused)try{this.player.requestPlay()}catch(e){if("AbortError"!==e.name)throw e;console.warn("AbortError: play() „Åå‰∏≠Êñ≠„Åï„Çå„Åæ„Åó„Åü„ÄÇpause() „ÅåÂâ≤„ÇäËæº„Çì„Å†ÂèØËÉΩÊÄß")}if(await this._sleep(200),!this.player.isPlaying&&e){console.warn("ÂÜçË©¶Ë°å: requestPlay");try{this.player.requestPlay()}catch(e){"AbortError"===e.name?console.warn("ÂÜçË©¶Ë°å„Åß„ÇÇ AbortError:",e.message):console.warn("ÂÜçË©¶Ë°å„ÇÇ‰∏≠Êñ≠:",e)}}}catch(e){console.error("requestPlay ÂÆåÂÖ®Â§±Êïó",e)}}async safePause(){try{this.player.requestPause()}catch(e){console.error("requestPause „Ç®„É©„Éº",e)}}async safeStop(){try{this.player.requestStop()}catch(e){console.error("requestStop „Ç®„É©„Éº",e)}}getPlayer(){return this.player}getCurrentSong(){return this.song}get isPlaying(){return this.player.isPlaying}restartCurrentSong(){this.player&&this.player.video&&(this.player.requestMediaSeek(0),setTimeout((()=>{this.safePlay()}),500))}}const he=new n.YJl;he.position.set(0,0,0),he.rotation.set(0,0,0),he.scale.set(1,1,1),w.add(he);const me=[],ye=new n.YJl;w.add(ye);const we=[],ge=new n.Tap;function fe(){const e=new n.LoY,t=[],o=[],i=[],a=new n.Pq0;g.getWorldDirection(a);const r=(new n.Pq0).copy(g.position).add(a.multiplyScalar(30)),l=20*(Math.random()-.5)*2,d=10*(Math.random()-.5)*2,c=.3*(Math.random()-.5),p=new n.Pq0(r.x+l,r.y+d,r.z+c),u=p.clone().add(new n.Pq0(20*(Math.random()-.5),-4*Math.random(),-2*Math.random())),h=new n.Q1f(16777215),m=new n.Q1f(12316415);for(let e=0;e<40;e++){const n=e/39,a=p.clone().lerp(u,n);t.push(a.x,a.y,a.z),o.push(.1+.3*n);const r=h.clone().lerp(m,n);i.push(r.r,r.g,r.b)}e.setAttribute("position",new n.qtW(t,3)),e.setAttribute("aSize",new n.qtW(o,1)),e.setAttribute("aColor",new n.qtW(i,3));const y=new n.BKk({uniforms:{uOpacity:{value:1}},vertexShader:"\n  precision mediump float;\n  attribute float aSize;\n  attribute vec3 aColor;\n  varying vec3 vColor;\n  void main() {\n    vColor = aColor;\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_PointSize = aSize * (300.0 / -mvPosition.z); // Ë¶ñË∑ùÈõ¢„Å´Âøú„Åò„Å¶Ë™øÊï¥\n    gl_Position = projectionMatrix * mvPosition;\n  }\n",fragmentShader:"\n  precision mediump float;\n  uniform float uOpacity;\n  varying vec3 vColor;\n  void main() {\n    float d = length(gl_PointCoord - vec2(0.5));\n    if (d > 0.5) discard; // ‰∏∏„ÅÑÁ≤í„Å´\n    gl_FragColor = vec4(vColor, uOpacity);\n  }\n",vertexColors:!0,transparent:!0,depthWrite:!1}),f=new n.ONl(e,y);w.add(f),function(e){const t=[];for(let o=0;o<40;o++){const o=new n.Pq0(2*(Math.random()-.5),2*(Math.random()-.5),2*(Math.random()-.5)),i=e.clone().add(o);t.push(i.x,i.y,i.z)}const o=new n.LoY;o.setAttribute("position",new n.qtW(t,3));const i=new n.BH$({color:8965375,size:.07,transparent:!0,opacity:1}),a=new n.ONl(o,i);w.add(a),s.Ay.to(i,{opacity:0,duration:2,ease:"power1.out",onComplete:()=>{w.remove(a),o.dispose(),i.dispose()}})}(u),s.Ay.to(y.uniforms.uOpacity,{value:0,duration:1.2,ease:"power1.out",onComplete:()=>{w.remove(f),e.dispose(),y.dispose()}})}["./texture/astro1.png","./texture/astro2.png","./texture/astro3.png","./texture/astro1.png","./texture/astro2.png","./texture/astro3.png","./texture/astro1.png","./texture/astro2.png","./texture/astro3.png"].forEach((e=>{ge.load(e,(e=>we.push(e)),void 0,(t=>console.error("Nebula load error",e,t)))})),new n.NRn;const ve=new n.Pq0,Pe=new n.Pq0,Me=new n.Pq0,be=new n.Pq0,Ie=new n.Pq0(0,-1.6,0),Se=new n.Pq0,qe={},xe=[],Ce=[],Ae=new n.Pq0(0,0,5);window.addEventListener("keydown",(e=>qe[e.key]=!0)),window.addEventListener("keyup",(e=>qe[e.key]=!1));const Oe=new n.tBo;window.addEventListener("mousemove",(function(e){Te.x=e.clientX/window.innerWidth*2-1,Te.y=-e.clientY/window.innerHeight*2+1}));let Ee=!1,ke=!1,ze=!1;document.addEventListener("DOMContentLoaded",(()=>{const e=new ue({app:{token:"F3s1rJugVHrXdNRN"},mediaElement:document.querySelector("#media")});function t(e,t){let o=e;for(;o;){if(o===t)return!0;o=o.parent}return!1}window.addEventListener("click",(d=>{const c=Oe.intersectObjects(w.children,!0);if(c.length>0){const d=c[0].object;if(console.log(d),"init"===se&&!Ee&&U&&t(d,U))console.log("„Éû„Ç§„ÇØ„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü"),Ee=!0,s.Ay.to(Q,{opacity:0,duration:.6,onComplete:()=>{X.visible=!1,function(){const t=document.querySelector(".slider-wrapper");function n(e){const t=Math.floor(e/1e3);return`${Math.floor(t/60).toString().padStart(2,"0")}:${(t%60).toString().padStart(2,"0")}`}t.innerHTML="",e._holoSliderTimeUpdateRegistered||(e._holoSliderTimeUpdateRegistered=!0,e.on("timeupdate",(t=>{i&&a&&function(t){const o=e.player.video;if(!o)return;const r=o.duration,s=t/r*100;i.value=s,a.textContent=`${n(t)} / ${n(r)}`}(t)}))),l.forEach(((e,o)=>{const n=document.createElement("div");n.className="slide",n.dataset.index=o,n.innerHTML=`\n      <div class="slide-content">\n        <img class="jacket" src="${e.image}" alt="${e.title}" />\n        <div class="song-info">\n          <h3 class="song-title">${e.title}</h3>\n          <p class="song-artist">${e.artist}</p>\n          <img src="./texture/barlines.png" class="barlines" alt="bars" />\n        </div>\n      </div>\n      <div class="player-controls">\n        <button class="play-btn">‚ñ∂</button>\n        <input type="range" class="seek-bar" min="0" max="100" value="0" />\n        <span class="time-display">00:00 / 00:00</span>\n      </div>\n    `,t.appendChild(n)}));const d=document.getElementById("slidePrev"),c=document.getElementById("slideNext");async function p(p){r=(r+p+l.length)%l.length;const u=t.querySelector(".slide").offsetWidth;s.Ay.to(t,{x:-u*r,duration:.3,ease:"power2.out"});const h=t.children[r];o=h.querySelector(".play-btn"),i=h.querySelector(".seek-bar"),a=h.querySelector(".time-display"),d.classList.add("disabled"),c.classList.add("disabled"),o.classList.add("disabled"),o.textContent="...",i.classList.add("disabled"),i.value=0,a.textContent="Ë™≠„ÅøËæº„Åø‰∏≠...",await e.loadSong(l[r]),d.classList.remove("disabled"),c.classList.remove("disabled"),o.classList.remove("disabled"),o.textContent="‚ñ∂",i.value=0;const m=e.player.video?.duration||0;a.textContent=`00:00 / ${n(m)}`,o.onclick=async()=>{e.videoReady&&(e.isPlaying?(await e.safePause(),o.textContent="‚ñ∂",i.classList.add("disabled"),console.log("[play button] Paused.")):(await e.safePlay(),o.textContent="‚è∏",i.classList.remove("disabled"),console.log("[play button] Playing.")))},i.oninput=()=>{const t=e.player.video;if(!t)return;const o=i.value/100*t.duration;console.log(`[seekBar.input] Requesting seek to: ${o.toFixed(0)}ms`),e.player.requestMediaSeek(o)}}d.addEventListener("click",(()=>p(-1))),c.addEventListener("click",(()=>p(1))),p(0)}(),function(){const e=new n.Pq0;U.getWorldPosition(e),e.y+=2.1,K.position.copy(e),K.visible=!0,K.scale.set(1e-4,1e-4,1e-4);const t=document.getElementById("hologramBillboard");t.style.opacity=0,s.Ay.to(K.scale,{x:.005,y:.005,z:.005,duration:.8,ease:"expo.out"}),s.Ay.to(t,{opacity:1,duration:.8,ease:"power2.out"})}(),setTimeout((()=>{ee=ae,X.visible=!0,Q.textContent="Click Telescope",Q.style.opacity=0,s.Ay.to(Q,{opacity:1,duration:.6,onComplete:()=>{ke=!0}})}),3e3)}});else if("init"===se&&ae&&t(d,ae)){if(!e.player.video||!ke)return;console.log("ÊúõÈÅ†Èè°„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü"),function(){if("init"!==se)return;if(!e.songReady)return;e.safePause(),s.Ay.to(Q,{opacity:0,duration:.6,onComplete:()=>{X.visible=!1}}),se="telescopeZooming";const t=ae.position.clone(),o=g.position.clone(),i=new n.ubm;i.position.copy(o),i.lookAt(t.x+1,t.y,t.z);const a=i.quaternion.clone(),r=g.quaternion.clone();s.Ay.to(g.position,{x:t.x,y:t.y+1.2,z:t.z+.6,duration:2,ease:"power2.inOut"}),s.Ay.to({t:0},{t:1,duration:2,ease:"power2.inOut",onUpdate(){let e=this.targets()[0].t;g.quaternion.copy(r).slerp(a,e);const t=new n.Pq0(0,0,-.01).applyQuaternion(g.quaternion).add(g.position);te.target.copy(t)},onComplete(){const t=new n.Pq0(0,0,-.01);t.applyQuaternion(g.quaternion).add(g.position),te.target.copy(t),se="fadingOut",de((async()=>{ae&&(ae.visible=!1),K.visible=!1,pe(),te.enabled=!0,te.enableZoom=!1,te.enablePan=!1,te.enableRotate=!0,te.minPolarAngle=3*Math.PI/7,te.maxPolarAngle=7*Math.PI/8,g.position.set(ae.position.x,2,ae.position.z),te.target.set(ae.position.x,2,ae.position.z-.1),te.update(),document.getElementById("vignetteOverlay").style.opacity="1",E.visible=!1,$(),D(!0),setTimeout((()=>{s.Ay.to(z.material,{opacity:0,duration:1.2,onComplete:()=>{z.visible=!1}}),s.Ay.to(L.material,{opacity:0,duration:1.2,onComplete:()=>{L.visible=!1}})}),1e4),ce((()=>{se="exploringStars"})),await e._sleep(1500),e.restartCurrentSong(),ze=!0}))}})}()}else"init"===se&&F&&t(d,F)&&console.log("„Ç¢„É≥„Éó„Åå„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åæ„Åó„Åü")}}));let o=null,i=null,a=null,r=0;e.on("appready",(()=>{console.log("‚úÖ „Ç¢„Éó„É™Ê∫ñÂÇôÂÆå‰∫Ü")})),e.on("videoready",(()=>{console.log("‚úÖ „Éì„Éá„Ç™Ê∫ñÂÇôÂÆå‰∫Ü")})),e.on("play",(()=>{const t=e.getCurrentSong();t&&console.log(`‚ñ∂Ô∏è ÂÜçÁîü‰∏≠: ${t.name} by ${t.artist?.name??"‰∏çÊòé"}`)})),e.on("pause",(()=>{console.warn("üõë safePause Âëº„Å≥Âá∫„ÅóÔºà„Çπ„Çø„ÉÉ„ÇØ„Éà„É¨„Éº„ÇπÔºâ"),console.trace(),console.log("pause")})),e.on("stop",(()=>{console.log("stop")}));const l=[{title:"„Çπ„Éà„É™„Éº„Éà„É©„Ç§„Éà",artist:"Âä†Ë≥Ä(„Éç„ÇÆ„Ç∑„É£„ÉØ„ÉºP)",url:"https://piapro.jp/t/ULcJ/20250205120202",image:"./Model/cover.png",beatId:4694275,chordId:2830730,repetitiveSegmentId:2946478,lyricId:67810,lyricDiffId:20654},{title:"„Ç¢„É™„Éï„É¨„Éº„Ç∑„Éß„É≥",artist:"Èõ®ËâØ Amala",url:"https://piapro.jp/t/SuQO/20250127235813",image:"./Model/cover.png",beatId:4694276,chordId:2830731,repetitiveSegmentId:2946479,lyricId:67811,lyricDiffId:20655},{title:"„Ç§„É≥„Éï„Ç©„Éº„Éû„É´„ÉÄ„Ç§„Éñ",artist:"99piano",url:"https://piapro.jp/t/Ppc9/20241224135843",image:"./Model/cover.png",beatId:4694277,chordId:2830732,repetitiveSegmentId:2946480,lyricId:67812,lyricDiffId:20656},{title:"„Éè„É≠„Éº„ÄÅ„Éï„Çß„É´„Éü„ÄÇ",artist:"„Å©ÔΩû„Å±„Åø„Çì",url:"https://piapro.jp/t/oTaJ/20250204234235",image:"./Model/cover.png",beatId:4694278,chordId:2830733,repetitiveSegmentId:2946481,lyricId:67813,lyricDiffId:20657},{title:"„Éë„É¨„Éº„Éâ„É¨„Ç≥„Éº„Éâ",artist:"„Åç„Åï„Çâ",url:"https://piapro.jp/t/GCgy/20250202202635",image:"./Model/cover.png",beatId:4694279,chordId:2830734,repetitiveSegmentId:2946482,lyricId:67814,lyricDiffId:20658},{title:"„É≠„É≥„É™„Éº„É©„É≥",artist:"Êµ∑È¢®Â§™ÈôΩ",url:"https://piapro.jp/t/CyPO/20250128183915",image:"./Model/cover.png",beatId:4694280,chordId:2830735,repetitiveSegmentId:2946483,lyricId:67815,lyricDiffId:20659}]}));const Te=new n.I9Y;new n.V9B({color:"black"}),new Map,function e(){if(requestAnimationFrame(e),function(){g.getWorldDirection(Me),Me.y=0,Me.normalize(),be.crossVectors(Me,g.up).normalize(),Se.set(0,0,0),(qe.ArrowUp||qe.w)&&Se.add(ve.copy(Me).multiplyScalar(.05)),(qe.ArrowDown||qe.s)&&Se.add(ve.copy(Me).multiplyScalar(-.05)),(qe.ArrowLeft||qe.a)&&Se.add(ve.copy(be).multiplyScalar(-.05)),(qe.ArrowRight||qe.d)&&Se.add(ve.copy(be).multiplyScalar(.05));const e=Pe.copy(g.position).add(Se).add(Ie);if(!(e.distanceTo(Ae)>4)){for(const t of Ce)if(t.containsPoint(e))return;g.position.add(Se),te.target.add(Se)}}(),B(),function(){if(!X.visible||!ee)return;const e=new n.Pq0;ee.getWorldPosition(e),X.position.set(e.x,e.y+2,e.z),X.lookAt(g.position)}(),Oe.setFromCamera(Te,g),U&&ae&&F){const e=[];U&&!Ee&&e.push(U),ae&&Ee&&ke&&e.push(ae),Oe.intersectObjects(e,!0).length>0?document.body.style.cursor="pointer":document.body.style.cursor="grab"}const t=w.getObjectByName("starSphere");t&&(t.rotation.y+=2e-5),K.visible&&K.lookAt(g.position),he.children.forEach((e=>{e.lookAt(g.position)})),ye.children.forEach((e=>{e.userData.lookAtCamera&&e.lookAt(g.position)})),le||te.update(),m.clear(),m.render(w,g),m.clearDepth(),m.render(M,b),y.render(w,g)}(),setInterval((()=>{const e=Math.random()<.3?2:1;for(let t=0;t<e;t++)fe()}),2e3+1e4*Math.random()),window.addEventListener("resize",(()=>{g.aspect=window.innerWidth/window.innerHeight,g.updateProjectionMatrix(),y.setSize(window.innerWidth,window.innerHeight),b.left=-window.innerWidth/2,b.right=window.innerWidth/2,b.top=window.innerHeight/2,b.bottom=-window.innerHeight/2,b.updateProjectionMatrix(),m.setSize(window.innerWidth,window.innerHeight),_&&($(),D("center"===H))})),window.onerror=function(e,t,o,n,i){console.error("üåç „Ç∞„É≠„Éº„Éê„É´„Ç®„É©„Éº„Ç≠„É£„ÉÉ„ÉÅ:",{message:e,source:t,lineno:o,colno:n,error:i})},window.addEventListener("unhandledrejection",(e=>{e.reason&&"AbortError"===e.reason.name&&e.preventDefault()}))}},e=>{e.O(0,[695],(()=>e(e.s=866))),e.O()}]);